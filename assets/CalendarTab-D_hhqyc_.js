import{c as q,r as d,i as o,j as e,az as z,au as B,e as y,Y as E,G as C,X as _,d as I,h as J}from"./index-DETpqC_j.js";import{P as V}from"./plus-B0pu8I4w.js";import{T as K}from"./trash-2-BpDurroK.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),se=({featureCosts:r})=>{const[g,M]=d.useState([]),[i,N]=d.useState(new Date),[u,D]=d.useState(0),[Z,k]=d.useState(!1),[T,p]=d.useState(!1),[s,x]=d.useState({title:"",date:"",type:"ACADEMIC",description:""}),[h,v]=d.useState(null);d.useEffect(()=>{f()},[]);const f=async()=>{k(!0);const[t,a]=await Promise.all([o.getCalendarEvents(),o.getSchoolConfig()]);M(t),a!=null&&a.hijriAdjustment&&D(a.hijriAdjustment),k(!1)},S=async t=>{const a=u+t;D(a),await o.updateSchoolSettings({hijriAdjustment:a})},F=t=>{const a=new Date(t);return a.setDate(a.getDate()+u),new Intl.DateTimeFormat("en-u-ca-islamic-umalqura-nu-latn",{day:"numeric",month:"short"}).format(a)},O=(t,a)=>new Date(t,a+1,0).getDate(),$=(t,a)=>new Date(t,a,1).getDay(),Y=()=>{const t=i.getFullYear(),a=i.getMonth(),l=O(t,a),m=$(t,a),j=Array(m).fill(null),R=Array.from({length:l},(n,b)=>b+1),U=[...j,...R];return e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(n=>e.jsx("div",{className:"text-center text-xs font-bold text-slate-500 uppercase py-2",children:n},n)),U.map((n,b)=>{if(!n)return e.jsx("div",{className:"h-24 bg-transparent"},b);const w=`${t}-${String(a+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`,X=g.filter(c=>c.date===w),A=new Date().toISOString().split("T")[0]===w,W=b%7===5;return e.jsxs("div",{onClick:()=>{x({...s,date:w}),p(!0)},className:`h-28 border border-slate-200 dark:border-slate-700 rounded-lg p-2 relative hover:border-blue-400 cursor-pointer transition-colors bg-white dark:bg-slate-800 ${A?"ring-2 ring-blue-500":""} ${W?"bg-slate-50 dark:bg-slate-800/50":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:`text-sm font-bold ${A?"text-blue-600":"text-slate-700 dark:text-slate-300"}`,children:n}),e.jsx("span",{className:"text-[9px] text-emerald-600 dark:text-emerald-400 font-mono",children:F(new Date(t,a,n))})]}),e.jsx("div",{className:"mt-2 space-y-1 overflow-y-auto max-h-16 custom-scrollbar",children:X.map(c=>e.jsx("div",{className:`text-[9px] px-1.5 py-0.5 rounded truncate font-medium ${c.type==="HOLIDAY"?"bg-red-100 text-red-700":c.type==="EXAM"?"bg-orange-100 text-orange-700":c.type==="RELIGIOUS"?"bg-emerald-100 text-emerald-700":"bg-blue-100 text-blue-700"}`,children:c.title},c.id))})]},b)})]})},L=async()=>{if(!s.title||!s.date)return alert("Title and Date required");const a=new Date(s.date).getDay();if(s.type==="EXAM"&&a===5&&!confirm("⚠️ Warning: Scheduling an Exam on Friday. This might conflict with Jumu'ah. Continue?"))return;const l=(r==null?void 0:r.calendar)||0;if(l>0){const j=await o.useFeatureWithTrial("create_event",l,0,`Calendar Event: ${s.title}`);if(!j.success){alert(j.message||"Insufficient Credits to add event.");return}}(await o.createCalendarEvent(s)).success?(p(!1),x({title:"",date:"",type:"ACADEMIC",description:""}),f(),l>0&&alert(`Event Added! ${l} Credits Deducted.`)):alert("Failed")},H=async t=>{confirm("Delete event?")&&(await o.deleteCalendarEvent(t),f())},P=()=>{const t=new Date;t.setFullYear(t.getFullYear()-1);const a=t.toISOString().split("T")[0],l=g.find(m=>m.date<a);if(l){const m=o.predictNextYearEvent(l);v({title:l.title,oldDate:l.date,newDate:m})}else alert("No historical data found to predict from.")},G=()=>{h&&(x({title:h.title,date:h.newDate,type:"ACADEMIC",description:"Auto-predicted based on last year"}),v(null),p(!0))};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white dark:bg-slate-900 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>N(new Date(i.setMonth(i.getMonth()-1))),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-black text-slate-800 dark:text-white uppercase w-40 text-center",children:i.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>N(new Date(i.setMonth(i.getMonth()+1))),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1.5 rounded-lg border border-emerald-100 dark:border-emerald-800",children:[e.jsx(B,{className:"w-4 h-4 text-emerald-600 mr-2"}),e.jsxs("span",{className:"text-xs font-bold text-emerald-700 dark:text-emerald-400 mr-2",children:["Hijri: ",u>0?`+${u}`:u]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>S(-1),className:"w-5 h-5 bg-white dark:bg-slate-800 rounded text-xs font-bold hover:bg-emerald-100",children:"-"}),e.jsx("button",{onClick:()=>S(1),className:"w-5 h-5 bg-white dark:bg-slate-800 rounded text-xs font-bold hover:bg-emerald-100",children:"+"})]})]}),e.jsxs(y,{onClick:P,variant:"secondary",className:"text-xs flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 text-purple-500"})," Smart Predict"]}),e.jsxs(y,{onClick:()=>p(!0),className:"flex items-center gap-1 text-xs",children:[e.jsx(V,{className:"w-3 h-3"})," Add Event"]})]})]}),h&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 p-4 rounded-xl flex justify-between items-center animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-purple-800 dark:text-purple-300 text-sm flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"})," Prediction Found"]}),e.jsxs("p",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:["Based on pattern, ",e.jsx("b",{children:h.title})," might be on ",e.jsx("b",{children:h.newDate}),"."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(null),className:"px-3 py-1.5 text-xs text-slate-500 font-bold",children:"Dismiss"}),e.jsx("button",{onClick:G,className:"px-3 py-1.5 bg-purple-600 text-white rounded-lg text-xs font-bold shadow-md hover:bg-purple-700",children:"Use Date"})]})]}),e.jsx(C,{className:"p-4",children:Y()}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsx("h3",{className:"font-bold text-sm text-slate-500 uppercase mb-3",children:"Upcoming Events"}),e.jsxs("div",{className:"space-y-2",children:[g.filter(t=>new Date(t.date)>=new Date).slice(0,5).map(t=>e.jsxs("div",{className:"flex justify-between items-center p-3 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg border border-transparent hover:border-slate-200 dark:hover:border-slate-700 group transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-8 rounded-full ${t.type==="HOLIDAY"?"bg-red-500":t.type==="EXAM"?"bg-orange-500":"bg-blue-500"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white",children:t.title}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(t.date).toDateString()," • ",t.type]})]})]}),e.jsx("button",{onClick:()=>H(t.id),className:"text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(K,{className:"w-4 h-4"})})]},t.id)),g.length===0&&e.jsx("p",{className:"text-center text-xs text-slate-400 py-4",children:"No events scheduled."})]})]}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(C,{className:"w-full max-w-sm relative border-t-4 border-t-blue-500",children:[e.jsx("button",{onClick:()=>p(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-white",children:"Add Event"}),((r==null?void 0:r.calendar)||0)>0&&e.jsxs("div",{className:"mb-4 bg-yellow-50 text-yellow-700 px-3 py-1.5 rounded text-xs font-bold border border-yellow-200",children:["Cost: ",r==null?void 0:r.calendar," Credits"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Event Title"}),e.jsx(I,{placeholder:"e.g. Annual Day",value:s.title,onChange:t=>x({...s,title:t.target.value}),autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Date"}),e.jsx(I,{type:"date",value:s.date,onChange:t=>x({...s,date:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Type"}),e.jsxs(J,{value:s.type,onChange:t=>x({...s,type:t.target.value}),children:[e.jsx("option",{value:"ACADEMIC",children:"Academic"}),e.jsx("option",{value:"EXAM",children:"Exam"}),e.jsx("option",{value:"HOLIDAY",children:"Holiday"}),e.jsx("option",{value:"RELIGIOUS",children:"Religious"}),e.jsx("option",{value:"ACTIVITY",children:"Activity"})]})]}),e.jsx(y,{onClick:L,className:"w-full bg-blue-600 hover:bg-blue-700",children:"Save Event"})]})]})})]})};export{se as default};
