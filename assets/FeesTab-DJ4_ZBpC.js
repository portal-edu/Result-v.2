import{c as K,r as n,j as e,G as v,X as R,d as h,h as T,C as Q,W as E,n as L,P as V,b as p}from"./index-E6X91Rqg.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=K("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),J=({feeStructures:m,classes:k,schoolConfig:w,onRefresh:C,onShowReceipt:Y})=>{const[d,F]=n.useState(""),[u,g]=n.useState([]),[s,r]=n.useState({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),[D,P]=n.useState(!1),[U,I]=n.useState(!1),[A,b]=n.useState(""),B=async t=>{t.preventDefault(),P(!0);const a=parseFloat(s.amount);if(!s.name||isNaN(a))return alert("Invalid Input");const l=await p.createFeeStructure(s.name,a,s.dueDate,s.targetClassIds,s.collectedBy,s.isRecurring?{frequency:s.recurrenceFrequency,count:s.recurrenceCount}:void 0);P(!1),l.success?(b("Fee Category Created!"),r({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),C(),setTimeout(()=>b(""),2e3)):alert("Error: "+l.message)},S=async t=>{F(t),g([]);const a=m.find(c=>c.id===t);if(!a)return;const l=!a.targetClassIds||a.targetClassIds.length===0?k.map(c=>c.id):a.targetClassIds;let x=[];I(!0);for(const c of l){const M=k.find(y=>y.id===c);if(!M)continue;const $=(await p.getFeeCollectionStats(t,c)).map(y=>({...y,className:M.name}));x=[...x,...$]}g(x),I(!1)},q=t=>{var l,x;const a=m.find(c=>c.id===d);a&&Y({schoolName:w.schoolName,place:w.place,studentName:t.student.name,regNo:t.student.regNo,className:t.className,feeName:a.name,amount:a.amount,date:new Date((l=t.paymentDetails)==null?void 0:l.paid_date).toLocaleDateString(),txnId:((x=t.paymentDetails)==null?void 0:x.transaction_id)||"N/A"})},[H,j]=n.useState(!1),[i,G]=n.useState(null),[N,f]=n.useState(""),O=t=>{G(t),f(t.balance>0?t.balance.toString():""),j(!0)},W=async t=>{if(t.preventDefault(),!i||!N)return;const a=parseFloat(N);if(isNaN(a)||a<=0)return alert("Invalid Amount");if(a>i.balance&&!window.confirm("Amount exceeds balance ("+i.balance+"). Continue?"))return;const l=await p.recordFeePayment(d,i.student.id,a,"Admin");l.success?(b("Payment Recorded!"),j(!1),f(""),S(d),setTimeout(()=>b(""),2e3)):alert("Error: "+l.message)},z=async t=>{if(!window.confirm("Delete this fee structure? Payments will be unlinked."))return;(await p.deleteFeeStructure(t)).success&&(C(),d===t&&(F(""),g([])))},o=m.find(t=>t.id===d);return e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 animate-fade-in-up",children:[H&&i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(v,{className:"w-full max-w-md animate-scale-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Record Payment"}),e.jsx("button",{onClick:()=>j(!1),children:e.jsx(R,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Student"}),e.jsx("p",{className:"font-bold text-lg",children:i.student.name}),e.jsxs("div",{className:"flex justify-between mt-2 text-sm",children:[e.jsxs("span",{children:["Total Fee: ",e.jsxs("b",{children:["₹",o==null?void 0:o.amount]})]}),e.jsxs("span",{className:"text-red-500",children:["Balance: ",e.jsxs("b",{children:["₹",i.balance]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Amount Collecting Today (₹)"}),e.jsx(h,{type:"number",autoFocus:!0,value:N,onChange:t=>f(t.target.value),placeholder:"Enter Amount"})]}),e.jsx(T,{type:"submit",className:"w-full",children:"Confirm Payment"})]})]})}),e.jsx("div",{className:"md:col-span-1 space-y-6",children:e.jsxs(v,{className:"border-t-4 border-t-green-500 relative overflow-hidden",children:[A&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(Q,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:A})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(E,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"New Fee"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Define amount & due date"})]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Fee Name"}),e.jsx(h,{placeholder:"e.g. Bus Fee / Term 1",value:s.name,onChange:t=>r({...s,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount (₹)"}),e.jsx(h,{type:"number",placeholder:"0.00",value:s.amount,onChange:t=>r({...s,amount:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Due Date"}),e.jsx(h,{type:"date",value:s.dueDate,onChange:t=>r({...s,dueDate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Who Collects?"}),e.jsxs(L,{value:s.collectedBy,onChange:t=>r({...s,collectedBy:t.target.value}),children:[e.jsx("option",{value:"ADMIN",children:"Admin Only"}),e.jsx("option",{value:"TEACHER",children:"Class Teacher Only"}),e.jsx("option",{value:"BOTH",children:"Both (Hybrid)"})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"recurringCheck",className:"w-4 h-4 accent-green-600",checked:s.isRecurring,onChange:t=>r({...s,isRecurring:t.target.checked})}),e.jsx("label",{htmlFor:"recurringCheck",className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Recurring Payment?"})]}),s.isRecurring&&e.jsxs("div",{className:"space-y-3 mt-3 p-3 bg-slate-50 dark:bg-slate-800 rounded-lg animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Frequency"}),e.jsxs(L,{value:s.recurrenceFrequency,onChange:t=>r({...s,recurrenceFrequency:t.target.value}),children:[e.jsx("option",{value:"WEEKLY",children:"Weekly"}),e.jsx("option",{value:"BIWEEKLY",children:"Every 2 Weeks"}),e.jsx("option",{value:"MONTHLY",children:"Monthly"}),e.jsx("option",{value:"BIMONTHLY",children:"Every 2 Months"}),e.jsx("option",{value:"QUARTERLY",children:"Quarterly (3 Months)"}),e.jsx("option",{value:"HALFYEARLY",children:"Half-Yearly (6 Months)"}),e.jsx("option",{value:"YEARLY",children:"Yearly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Total Installments"}),e.jsx(h,{type:"number",min:"2",max:"24",placeholder:"e.g. 12",value:s.recurrenceCount,onChange:t=>r({...s,recurrenceCount:parseInt(t.target.value)})})]})]})]}),e.jsx(T,{type:"submit",disabled:D,className:"w-full flex items-center justify-center gap-2",children:D?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"})," Create Fee"]})})]})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:[m.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>S(t.id),className:`px-4 py-2 rounded-lg border text-sm font-bold whitespace-nowrap transition-all ${d===t.id?"bg-green-100 border-green-500 text-green-800":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[t.name," (₹",t.amount,")"]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),z(t.id)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-10",title:"Delete Fee",children:e.jsx(R,{className:"w-3 h-3"})})]},t.id)),m.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No fees created yet."})]}),d&&o?e.jsxs(v,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-white",children:["Collection Status: ",o.name]}),e.jsxs("div",{className:"flex gap-4 text-xs",children:[e.jsxs("span",{className:"text-green-600 font-bold",children:["Paid: ",u.filter(t=>t.status==="PAID").length]}),e.jsxs("span",{className:"text-amber-500 font-bold",children:["Partial: ",u.filter(t=>t.status==="PARTIAL").length]}),e.jsxs("span",{className:"text-red-500 font-bold",children:["Pending: ",u.filter(t=>t.status==="PENDING").length]})]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 text-xs uppercase sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Class"}),e.jsx("th",{className:"p-3 text-center",children:"Paid / Total"}),e.jsx("th",{className:"p-3 text-center",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[u.map(t=>{const a=Math.min(100,Math.round(t.totalPaid/o.amount*100));return e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"p-3 font-bold text-slate-800 dark:text-white",children:t.student.name}),e.jsx("td",{className:"p-3 text-slate-500",children:t.className}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("div",{className:"w-24 mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsxs("span",{children:["₹",t.totalPaid]}),e.jsxs("span",{className:"text-slate-400",children:["₹",o.amount]})]}),e.jsx("div",{className:"h-1.5 w-full bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.status==="PAID"?"bg-green-500":"bg-amber-500"}`,style:{width:`${a}%`}})}),t.balance>0&&e.jsxs("p",{className:"text-[10px] text-red-500 mt-1",children:["Due: ₹",t.balance]})]})}),e.jsxs("td",{className:"p-3 text-center flex justify-center gap-2",children:[t.status!=="PAID"&&e.jsx("button",{onClick:()=>O(t),className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded font-bold shadow-sm",children:"Pay"}),t.totalPaid>0&&e.jsx("button",{onClick:()=>q(t),className:"text-xs bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 px-2 py-1 rounded font-bold flex items-center gap-1",title:"Download Receipt",children:e.jsx(_,{className:"w-3 h-3"})})]})]},t.student.id)}),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-8 text-center text-slate-400",children:"No students found for this fee."})})]})]})})]}):e.jsxs("div",{className:"text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-xl border-2 border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx(E,{className:"w-12 h-12 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Select a fee category above to manage collection."})]})]})]})};export{J as default};
