import{c as v,r as l,a as c,j as e,b as o,Z as x,Q as R,aj as F,P as T,Y as M,g as D,p as G}from"./index-CGGgVCBT.js";import{P as B}from"./plus-BxNUQjGg.js";import{R as L}from"./settings-BsFwcmxV.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=v("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=v("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Z=({schoolConfig:m})=>{var k,y;const[O,C]=l.useState([]),[r,S]=l.useState(null),[P,N]=l.useState(m.walletBalance||0),[I,w]=l.useState(!1),[E,h]=l.useState(!1),[d,u]=l.useState(""),[b,n]=l.useState("INIT"),[p,i]=l.useState("");l.useEffect(()=>{f()},[]);const f=async()=>{w(!0);const[t,s]=await Promise.all([c.getWalletHistory(),c.getWalletAnalytics()]);C(t),S(s);const a=await c.getSchoolConfig();a&&N(a.walletBalance||0),w(!1)},A=async()=>{if(!d)return;const t=parseInt(d),s=t;if(s<50){i("Minimum purchase is 50 Credits");return}n("PROCESSING"),i("");try{const a=await c.initializePayment(s,m.phone||"9999999999",m.schoolName,m.adminEmail);if(a.success){const j=await c.rechargeWallet(t,"Credit Pack Purchase",a.transactionId);j.success?(N(j.newBalance),n("SUCCESS"),f()):(i(j.message||"Payment Successful but Credit Update Failed. Contact Support."),n("FAILED"))}else i(a.message||"Transaction Failed"),n("FAILED")}catch(a){i(a.message||"Unknown error occurred"),n("FAILED")}},g=({amount:t,bonus:s,popular:a})=>e.jsxs("button",{onClick:()=>u(t.toString()),className:`relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${d===t.toString()?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:border-blue-300"}`,children:[a&&e.jsx("div",{className:"absolute -top-3 bg-blue-600 text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Most Popular"}),e.jsx("div",{className:`p-2 rounded-full mb-2 ${d===t.toString()?"bg-blue-100 text-blue-600":"bg-slate-100 dark:bg-slate-700 text-slate-400"}`,children:e.jsx(x,{className:"w-5 h-5 fill-current"})}),e.jsx("div",{className:"text-lg font-black text-slate-800 dark:text-white",children:t}),e.jsx("div",{className:"text-[10px] text-slate-500 font-bold uppercase mb-1",children:"Credits"}),e.jsxs("div",{className:"text-xs font-bold text-slate-600 dark:text-slate-400",children:["₹",t]}),s&&e.jsxs("div",{className:"text-[9px] text-green-600 font-bold mt-1",children:["+",s," Free"]})]});return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"bg-gradient-to-br from-slate-900 to-indigo-900 text-white relative overflow-hidden flex flex-col justify-between min-h-[220px]",children:[e.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:e.jsx(x,{className:"w-40 h-40 fill-white"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 uppercase tracking-wider mb-1",children:"Feature Credits"}),e.jsxs("h2",{className:"text-5xl font-black tracking-tight flex items-baseline gap-1",children:[P," ",e.jsx("span",{className:"text-lg font-bold text-slate-400",children:"CR"})]})]}),e.jsx("div",{className:"bg-white/10 p-2 rounded-lg backdrop-blur-md border border-white/10",children:e.jsx(x,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"})})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Use these credits for AI Generation & SMS Alerts."})]}),e.jsxs("div",{className:"relative z-10 mt-6 pt-6 border-t border-white/10 flex gap-3",children:[e.jsxs("button",{onClick:()=>{h(!0),n("INIT"),u(""),i("")},className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2 transition-all",children:[e.jsx(B,{className:"w-4 h-4"})," Buy Credits"]}),e.jsx("button",{onClick:f,className:"bg-white/10 hover:bg-white/20 text-white p-3 rounded-xl transition-all",children:e.jsx(L,{className:`w-5 h-5 ${I?"animate-spin":""}`})})]})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"})," Current Plan"]}),e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold uppercase",children:"Starter Free"})]}),e.jsxs("div",{className:"space-y-3 relative z-10 text-sm flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-800/30",children:[e.jsxs("span",{className:"text-slate-700 dark:text-slate-200 font-bold flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-green-600"})," 50 Students Free"]}),e.jsx("span",{className:"font-bold text-green-600 text-xs",children:"FOREVER"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"Publish Result (51+)"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"1 Credit / student"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"AI Question Gen"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"5 Credits / request"})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"md:col-span-2",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-red-500"})," Top Spenders"]}),((k=r==null?void 0:r.spenders)==null?void 0:k.length)>0?e.jsx("div",{className:"space-y-2",children:r.spenders.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-50 dark:bg-slate-800 rounded border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-500",children:s+1}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300 block",children:t.user_role}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:["ID: ",t.user_id.substring(0,8)]})]})]}),e.jsxs("div",{className:"text-red-500 font-mono font-bold",children:["-",t.total," CR"]})]},s))}):e.jsx("p",{className:"text-center text-sm text-slate-400 py-8",children:"No usage data."})]}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-500"})," Expense Type"]}),e.jsx("div",{className:"space-y-3",children:(y=r==null?void 0:r.categories)==null?void 0:y.map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300 font-medium",children:t.category}),e.jsxs("span",{className:"font-bold text-slate-800 dark:text-white",children:[t.total," CR"]})]},s))})]})]}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(o,{className:"w-full max-w-md relative overflow-hidden bg-white dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>h(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 font-bold",children:"✕"}),b==="INIT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-100 dark:border-blue-800",children:e.jsx(x,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 fill-current"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Credit Store"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Choose a pack to top up."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(g,{amount:100}),e.jsx(g,{amount:500,popular:!0}),e.jsx(g,{amount:1e3,bonus:100})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Or Enter Custom Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400 fill-slate-400"}),e.jsx("input",{type:"number",className:"w-full pl-9 pr-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg font-bold text-slate-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"50+",value:d,onChange:t=>u(t.target.value)}),e.jsx("div",{className:"absolute right-3 top-3 text-xs font-bold text-slate-400",children:"Credits"})]}),p&&e.jsx("p",{className:"text-xs text-red-500 font-bold mt-2",children:p})]}),e.jsxs("button",{onClick:A,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-xl rounded-xl font-bold text-lg flex items-center justify-center gap-2",children:["Buy ",d||"0"," Credits"]}),e.jsxs("p",{className:"text-[10px] text-slate-400 text-center mt-3 flex items-center justify-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"})," Secured Payment Gateway"]})]}),b==="PROCESSING"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-16 h-16 text-blue-600 animate-spin mx-auto mb-6"}),e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:"Connecting Gateway..."}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Please complete the payment in the popup."})]}),b==="SUCCESS"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce",children:e.jsx(D,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"font-bold text-2xl text-slate-800 dark:text-white",children:"Success!"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Credits added to your wallet."}),e.jsx("button",{onClick:()=>h(!1),className:"mt-8 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold",children:"Continue"})]}),b==="FAILED"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-16 h-16 text-red-500 mx-auto mb-6"}),e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:"Payment Failed"}),e.jsx("p",{className:"text-sm text-red-500 mt-2 font-bold",children:p}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 py-3 text-slate-500 font-bold text-sm bg-slate-100 dark:bg-slate-800 rounded-xl",children:"Close"}),e.jsx("button",{onClick:()=>n("INIT"),className:"flex-1 py-3 bg-slate-900 text-white rounded-xl font-bold text-sm",children:"Retry"})]})]})]})})]})};export{Z as default};
