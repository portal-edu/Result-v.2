import{r,a as d,j as e,b as f,S as V,G as W,ad as K,d as u,B as me,V as A,L as be,g as P,U as he,aj as ue,X as Y,w as pe,ak as q,z as J}from"./index-CAgeZUTc.js";import{L as ge}from"./layout-grid-Ds9Q_Yb9.js";import{P as X}from"./plus-circle-DBUqNMgh.js";import{T as _}from"./trash-2-C9uBVfXZ.js";import{T as je}from"./thumbs-up-BfXvb8C5.js";const ye=({classes:p,onRefresh:g,onShowShare:fe})=>{const[N,$]=r.useState("BATCH"),[x,B]=r.useState(""),[w,k]=r.useState(""),[v,M]=r.useState(""),[G,C]=r.useState(""),[D,I]=r.useState(!1),[b,h]=r.useState([]),[L,Q]=r.useState([]),[c,E]=r.useState(null),[j,O]=r.useState({}),[U,z]=r.useState(!1),[y,S]=r.useState(null),[m,Z]=r.useState(null),[ee,F]=r.useState(!1),[i,se]=r.useState(null);r.useEffect(()=>{te();const s=d.getGlobalSyllabi();Q(s)},[]);const te=async()=>{const s=await d.getSchoolConfig();if(Z(s),s!=null&&s.syllabusProviderId){const t=d.getGlobalSyllabi().find(a=>a.id===s.syllabusProviderId);t&&E(t)}h([{name:"Subject 1",maxMarks:50,passMarks:18},{name:"Subject 2",maxMarks:50,passMarks:18}])};r.useEffect(()=>{if(!(!x||!m)&&m.syllabusProviderId){const s=d.getSubjectsFromSyllabus(m.syllabusProviderId,x);s.length>0&&h(s)}},[x,m]);const ae=async s=>{if(s.preventDefault(),!x){alert("Please enter Class/Course Name.");return}const t=w?w.trim():"",a=t?`${x} ${t}`:x;if(p.some(n=>n.name===a)){alert(`Class "${a}" already exists!`);return}let l=G;l||(l=Math.random().toString(36).slice(-6)),I(!0);const o=await d.createClass(a,l,v,b);if(I(!1),o.success){const n=`${window.location.origin}${window.location.pathname}#/login?invite=${o.id}`;se({className:a,teacher:v||"Class Teacher",password:l,link:n}),F(!0),B(""),k(""),M(""),C(""),h([{name:"Subject 1",maxMarks:50,passMarks:18}]),g()}else{const n=o.message;alert("Failed: "+(typeof n=="string"?n:JSON.stringify(n)))}},le=(s,t)=>{O(a=>{const l=a[s]||[];if(l.includes(t)){const o=l.filter(n=>n!==t);if(o.length===0){const n={...a};return delete n[s],n}return{...a,[s]:o}}else return{...a,[s]:[...l,t].sort()}})},re=async()=>{if(!c)return;const s=[];if(Object.entries(j).forEach(([a,l])=>{const o=d.getSubjectsFromSyllabus(c.id,a);l.forEach(n=>{const T=`${a} ${n}`;p.some(xe=>xe.name===T)||s.push({className:T,subjects:o})})}),s.length===0)return alert("No new classes selected or all selected classes already exist.");z(!0);const t=await d.createBulkClasses(s);z(!1),t.success&&t.created?(S(t.created.map(a=>({name:a.name,id:a.id,link:`${window.location.origin}${window.location.pathname}#/login?invite=${a.id}`}))),O({}),g()):alert("Batch creation failed: "+t.message)},ne=async s=>{if(!window.confirm("Delete this class? All students and marks will be lost."))return;(await d.deleteClass(s)).success?g():alert("Could not delete class.")},de=async s=>{if(!confirm("Approve results for this class? They will be published."))return;(await d.updateClassStatus(s,"APPROVED")).success?(alert("Class Approved!"),g()):alert("Failed")},ce=s=>{const t=`${window.location.origin}${window.location.pathname}#/login?invite=${s}`;navigator.clipboard.writeText(t),alert("Invite Link Copied!")},H=s=>{const t=`*Class Setup Invitation*

Hello Teacher,

You have been invited to manage *${s.className}* on SchoolResult Pro.

ðŸ‘‡ *Click to Setup & Claim Class:*
${s.link}

(You can set your own password)`;window.open(`https://wa.me/?text=${encodeURIComponent(t)}`,"_blank")},R=(s,t,a)=>{const l=[...b];l[s]={...l[s],[t]:a},h(l)},ie=()=>{h([...b,{name:"",maxMarks:50,passMarks:18}])},oe=s=>{const t=[...b];t.splice(s,1),h(t)};return e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-1 rounded-xl flex gap-1 border border-slate-200 dark:border-slate-700",children:[e.jsxs("button",{onClick:()=>$("BATCH"),className:`px-6 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all ${N==="BATCH"?"bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-white":"text-slate-500"}`,children:[e.jsx(ge,{className:"w-4 h-4"})," Smart Batch Generator"]}),e.jsxs("button",{onClick:()=>$("SINGLE"),className:`px-6 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all ${N==="SINGLE"?"bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-white":"text-slate-500"}`,children:[e.jsx(X,{className:"w-4 h-4"})," Manual Create"]})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:N==="BATCH"?e.jsxs(f,{className:"border-t-4 border-t-purple-500 sticky top-24 max-h-[85vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(V,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Batch Wizard"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Generate multiple classes"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Syllabus Standard"}),e.jsxs("select",{className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:ring-2 focus:ring-purple-500",value:(c==null?void 0:c.id)||"",onChange:s=>E(L.find(t=>t.id===s.target.value)||null),children:[e.jsx("option",{value:"",children:"Select Syllabus"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Select Classes & Divisions"}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:c.classRanges.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsxs("span",{className:"font-bold text-sm text-slate-700 dark:text-slate-300 w-12",children:["Cls ",s]}),e.jsx("div",{className:"flex gap-1",children:["A","B","C","D"].map(t=>{var l;const a=(l=j[s])==null?void 0:l.includes(t);return e.jsx("button",{onClick:()=>le(s,t),className:`w-8 h-8 rounded-md text-xs font-bold transition-all ${a?"bg-purple-600 text-white shadow-md":"bg-white dark:bg-slate-800 text-slate-400 border border-slate-200 dark:border-slate-700"}`,children:t},t)})})]},s))})]}),e.jsx(W,{onClick:re,disabled:U||!c||Object.keys(j).length===0,className:"w-full bg-purple-600 hover:bg-purple-700 shadow-lg shadow-purple-500/20",children:U?"Generating...":`Create ${Object.values(j).flat().length} Classes`})]})]}):e.jsxs(f,{className:"border-t-4 border-t-blue-500 sticky top-24 max-h-[85vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(K,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"New Class"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Add a single batch"})]})]}),e.jsxs("form",{onSubmit:ae,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1 uppercase",children:"Class / Course"}),e.jsx(u,{placeholder:"e.g. 10 / BCA",value:x,onChange:s=>B(s.target.value),required:!0,list:"grade-suggestions",className:"font-bold"}),e.jsx("datalist",{id:"grade-suggestions",children:["Pre-KG","LKG","UKG","1","2","3","4","5","6","7","8","9","10","+1","+2"].map(s=>e.jsx("option",{value:s},s))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1 uppercase",children:"Batch"}),e.jsx(u,{placeholder:"A",value:w,className:"text-center font-bold",onChange:s=>{const t=s.target.value;t.length===1?k(t.toUpperCase()):k(t)}})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-3 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[10px] font-bold text-slate-500 uppercase flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"})," Subjects (",b.length,")"]}),e.jsx("button",{type:"button",onClick:ie,className:"text-[10px] font-bold text-blue-600 hover:underline",children:"+ Add"})]}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto custom-scrollbar",children:[b.map((s,t)=>e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(u,{className:"h-7 text-xs px-2",placeholder:"Subject",value:s.name,onChange:a=>R(t,"name",a.target.value),list:"master-subjects"}),e.jsx(u,{type:"number",className:"h-7 text-xs px-1 w-12 text-center",placeholder:"Max",value:s.maxMarks,onChange:a=>R(t,"maxMarks",a.target.value)}),e.jsx("button",{type:"button",onClick:()=>oe(t),className:"text-slate-400 hover:text-red-500",children:e.jsx(_,{className:"w-3 h-3"})})]},t)),e.jsx("datalist",{id:"master-subjects",children:((m==null?void 0:m.masterSubjects)||[]).map(s=>e.jsx("option",{value:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1",children:"Teacher Name (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),e.jsx(u,{className:"pl-9",placeholder:"e.g. Mrs. Smith",value:v,onChange:s=>M(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1",children:"Access Password"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),e.jsx(u,{className:"pl-9",placeholder:"Set Password",value:G,onChange:s=>C(s.target.value)})]}),e.jsx("button",{type:"button",onClick:()=>C(Math.random().toString(36).slice(-6)),className:"bg-purple-50 dark:bg-purple-900/20 px-3 rounded-lg text-xs font-bold hover:bg-purple-100 text-purple-600 border border-purple-200",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1.5 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3 text-green-500"})," Leave blank to auto-generate link."]})]}),e.jsx(W,{type:"submit",disabled:D,className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/20",children:D?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4"})," Create Class"]})})]})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[p.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-black text-slate-500 dark:text-slate-400 text-sm",children:s.name.substring(0,2)}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[s.name,s.submissionStatus==="SUBMITTED"&&e.jsx("span",{className:"bg-orange-100 text-orange-700 text-[10px] px-2 py-0.5 rounded-full flex items-center gap-1 animate-pulse",children:"Waiting Approval"}),s.submissionStatus==="APPROVED"&&e.jsx("span",{className:"bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full flex items-center gap-1",children:"Published"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1 flex flex-wrap gap-2 items-center",children:[e.jsxs("span",{className:"flex items-center gap-1 font-bold bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded",children:[e.jsx(he,{className:"w-3 h-3"})," ",s.studentCount||0," Total"]}),e.jsxs("span",{className:"flex items-center gap-1 text-blue-600 bg-blue-50 px-2 py-0.5 rounded",children:[e.jsx(A,{className:"w-3 h-3"})," ",s.boysCount||0," Boys"]}),e.jsxs("span",{className:"flex items-center gap-1 text-pink-600 bg-pink-50 px-2 py-0.5 rounded",children:[e.jsx(A,{className:"w-3 h-3"})," ",s.girlsCount||0," Girls"]})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 mt-1.5 flex items-center gap-2",children:[e.jsxs("span",{children:["Teacher: ",s.teacherName||"Not Assigned"]}),e.jsx("span",{className:"w-1 h-1 bg-slate-300 rounded-full"}),e.jsxs("span",{className:"font-mono",children:["Pass: ",s.password?s.password:e.jsx("span",{className:"text-orange-500 italic",children:"Not Set (Link Only)"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[s.submissionStatus==="SUBMITTED"&&e.jsxs("button",{onClick:()=>de(s.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg text-xs font-bold hover:bg-green-700 shadow-md flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3"})," Approve"]}),e.jsxs("button",{onClick:()=>ce(s.id),className:"flex-1 sm:flex-none px-4 py-2 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg text-xs font-bold hover:bg-indigo-100 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"w-3 h-3"})," Share"]}),e.jsx("button",{onClick:()=>ne(s.id),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(_,{className:"w-4 h-4"})})]})]},s.id)),p.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center py-12 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx(K,{className:"w-8 h-8 text-blue-500"})}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-300",children:"No classes yet"}),e.jsx("p",{className:"text-slate-500 text-sm max-w-xs mx-auto mt-1",children:"Create classes using the manual form or batch wizard."})]})]})]}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(f,{className:"w-full max-w-2xl bg-white dark:bg-slate-900 border-t-4 border-t-green-500 max-h-[90vh] flex flex-col p-0",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Batch Created!"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[y.length," classes generated successfully."]})]})]}),e.jsx("button",{onClick:()=>S(null),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Y,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950/50",children:[e.jsxs("p",{className:"text-xs font-bold text-slate-500 uppercase mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"w-3 h-3"})," Invite Links"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:y.map((s,t)=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white",children:s.name}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"Invite teacher to claim"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>navigator.clipboard.writeText(s.link),className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-slate-600",title:"Copy Link",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H({className:s.name,link:s.link}),className:"p-2 bg-[#25D366] hover:bg-[#20bd5a] text-white rounded-lg",title:"WhatsApp",children:e.jsx(J,{className:"w-4 h-4"})})]})]},t))})]}),e.jsx("div",{className:"p-4 border-t border-slate-100 dark:border-slate-700 text-center",children:e.jsx("button",{onClick:()=>S(null),className:"text-sm text-blue-600 font-bold hover:underline",children:"Done"})})]})}),ee&&i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(f,{className:"w-full max-w-md bg-white dark:bg-slate-900 text-center relative border-t-4 border-t-green-500",children:[e.jsx("button",{onClick:()=>F(!1),className:"absolute top-3 right-3 text-slate-400 hover:text-slate-600",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(P,{className:"w-10 h-10 text-green-600 dark:text-green-400 animate-bounce"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:"Class Created!"}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 text-sm mb-6",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white",children:i.className})," is ready. Share details with the teacher."]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 mb-6 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Class Password"}),e.jsx("span",{className:"font-mono font-black text-lg text-blue-600 dark:text-blue-400",children:i.password})]}),e.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 my-2"}),e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Invite Link:"}),e.jsx("div",{className:"bg-white dark:bg-slate-900 p-2 rounded border border-slate-200 dark:border-slate-700 text-[10px] text-slate-500 font-mono break-all",children:i.link})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>H(i),className:"flex-1 bg-[#25D366] hover:bg-[#20bd5a] text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-green-500/20",children:[e.jsx(J,{className:"w-5 h-5"})," WhatsApp"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`Class: ${i.className}
Link: ${i.link}
Password: ${i.password}`),alert("Copied details!")},className:"flex-1 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-200",children:[e.jsx(q,{className:"w-5 h-5"})," Copy All"]})]})]})})]})};export{ye as default};
