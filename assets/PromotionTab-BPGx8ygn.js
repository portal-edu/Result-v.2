import{c as M,r,j as e,b as k,a3 as R,l as T,G as g,A as $,g as y,a as S}from"./index-CAgeZUTc.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=M("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),B=({classes:n,onRefresh:v})=>{const[l,c]=r.useState(1),[x,o]=r.useState(!1),[j,w]=r.useState({}),[i,A]=r.useState([]),[d,m]=r.useState([]),[f,C]=r.useState({promoted:0,retained:0,alumni:0});r.useEffect(()=>{const t={};n.forEach(s=>{var h;const a=(h=s.name.match(/\d+/))==null?void 0:h[0];if(a){const u=parseInt(a)+1,b=s.name.replace(a,"").trim(),N=`${u} ${b}`.trim(),p=n.find(D=>D.name===N);p?t[s.id]=p.id:t[s.id]="ALUMNI"}else t[s.id]="RETAIN"}),w(t)},[n]);const P=async()=>{o(!0);const t=[];for(const s of n){const a=await S.getStudentsByClass(s.id),h=j[s.id],u=Math.random()>.8?"DUE":"PAID",b=Math.random()>.9?"FAILED":"PASSED",N=a.map(p=>({...p,currentClassName:s.name,targetAction:h,feeStatus:u,resultStatus:b,isEligible:u==="PAID"&&b==="PASSED"}));t.push(...N)}A(t),m(t.filter(s=>s.isEligible).map(s=>s.id)),c(2),o(!1)},E=async()=>{if(!confirm("Are you sure? This will move students to new classes and archive old data."))return;o(!0);const t=i.filter(a=>d.includes(a.id)).map(a=>({studentId:a.id,targetClassId:a.targetAction,currentClassId:a.classId})),s=await S.promoteStudentsBatch(t);o(!1),s.success?(C(s.stats),c(3),v()):alert("Promotion Failed: "+s.message)},I=t=>{d.includes(t)?m(s=>s.filter(a=>a!==t)):m(s=>[...s,t])};return e.jsxs("div",{className:"max-w-5xl mx-auto animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Year-End Promotion"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Move students to the next academic year."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${l>=1?"bg-blue-600 text-white":"bg-slate-200 text-slate-500"}`,children:"1"}),e.jsx("div",{className:"w-8 h-1 bg-slate-200",children:e.jsx("div",{className:`h-full bg-blue-600 transition-all ${l>1?"w-full":"w-0"}`})}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${l>=2?"bg-blue-600 text-white":"bg-slate-200 text-slate-500"}`,children:"2"}),e.jsx("div",{className:"w-8 h-1 bg-slate-200",children:e.jsx("div",{className:`h-full bg-blue-600 transition-all ${l>2?"w-full":"w-0"}`})}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${l>=3?"bg-green-600 text-white":"bg-slate-200 text-slate-500"}`,children:"3"})]})]}),l===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-500"})," Class Progression Mapping"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300",children:t.name.substring(0,3)}),e.jsx(R,{className:"w-4 h-4 text-slate-400"})]}),e.jsx("div",{className:"flex-1 ml-4",children:e.jsxs(T,{value:j[t.id],onChange:s=>w({...j,[t.id]:s.target.value}),className:"text-sm py-2",children:[e.jsxs("option",{value:"RETAIN",children:["Retain in ",t.name," (Fail)"]}),e.jsx("option",{value:"ALUMNI",children:"ðŸŽ“ Promote to Alumni (TC)"}),n.filter(s=>s.id!==t.id).map(s=>e.jsxs("option",{value:s.id,children:["Promote to ",s.name]},s.id))]})})]},t.id))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:P,disabled:x,className:"px-8 bg-blue-600 hover:bg-blue-700",children:x?"Analyzing...":"Next: Verify Candidates"})})]}),l===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{className:"flex flex-col h-[600px] p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Student Eligibility"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[d.length," selected for promotion."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded",children:[e.jsx($,{className:"w-3 h-3"})," Fee Dues"]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded",children:[e.jsx(y,{className:"w-3 h-3"})," Eligible"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-xs font-bold text-slate-500 uppercase sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10 text-center",children:e.jsx("input",{type:"checkbox",className:"accent-blue-600",checked:d.length===i.length,onChange:()=>m(d.length===i.length?[]:i.map(t=>t.id))})}),e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Current Class"}),e.jsx("th",{className:"p-3",children:"Action"}),e.jsx("th",{className:"p-3 text-center",children:"Fee Status"}),e.jsx("th",{className:"p-3 text-center",children:"Result"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:i.map(t=>{var s;return e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-800/50 ${t.isEligible?"":"bg-red-50/50 dark:bg-red-900/10"}`,children:[e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",className:"accent-blue-600 w-4 h-4",checked:d.includes(t.id),onChange:()=>I(t.id)})}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-slate-200",children:t.name}),e.jsx("td",{className:"p-3 text-xs text-slate-500",children:t.currentClassName}),e.jsx("td",{className:"p-3 text-xs font-bold text-blue-600",children:t.targetAction==="ALUMNI"?"ðŸŽ“ Alumni":t.targetAction==="RETAIN"?"ðŸš« Retain":(s=n.find(a=>a.id===t.targetAction))==null?void 0:s.name}),e.jsx("td",{className:"p-3 text-center",children:t.feeStatus==="PAID"?e.jsx("span",{className:"text-green-600 font-bold text-[10px]",children:"No Dues"}):e.jsx("span",{className:"text-red-500 font-bold text-[10px]",children:"Due Pending"})}),e.jsx("td",{className:"p-3 text-center",children:t.resultStatus==="PASSED"?e.jsx("span",{className:"text-green-600 font-bold text-[10px]",children:"Passed"}):e.jsx("span",{className:"text-orange-500 font-bold text-[10px]",children:"Failed"})})]},t.id)})})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(g,{variant:"secondary",onClick:()=>c(1),children:"Back"}),e.jsx(g,{onClick:E,disabled:x||d.length===0,className:"px-8 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:x?"Processing...":`Promote ${d.length} Students`})]})]}),l===3&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-6",children:e.jsx(y,{className:"w-12 h-12 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white mb-2",children:"Promotion Complete!"}),e.jsx("p",{className:"text-slate-500 mb-8 max-w-md",children:"The academic year has been updated. Old records are archived."}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-8 w-full max-w-lg",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Promoted"}),e.jsx("h3",{className:"text-3xl font-black text-blue-600",children:f.promoted})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Retained"}),e.jsx("h3",{className:"text-3xl font-black text-orange-500",children:f.retained})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Alumni (TC)"}),e.jsx("h3",{className:"text-3xl font-black text-purple-600",children:f.alumni})]})]}),e.jsx(g,{onClick:()=>{c(1),v()},className:"px-8",children:"Return to Dashboard"})]})]})};export{B as default};
