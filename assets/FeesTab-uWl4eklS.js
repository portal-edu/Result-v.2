import{c as ce,r as i,j as e,G as j,a as ie,W as J,d as N,e as X,X as oe,i as y}from"./index-DTK6V_wT.js";import{P as xe}from"./plus-DWqlxpEn.js";import{H as me}from"./history-56zgURlb.js";import{P as K}from"./printer-C135XOqO.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]),Ne=({feeStructures:x,classes:D,schoolConfig:F,onRefresh:P,onShowReceipt:he})=>{var z,B,q,G,H;const[o,C]=i.useState(""),[u,v]=i.useState([]),[d,f]=i.useState({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),[S,w]=i.useState(!1),[pe,I]=i.useState(!1),[A,T]=i.useState(""),[Q,k]=i.useState(!1),[m,V]=i.useState(null),[R,L]=i.useState(""),[M,$]=i.useState(!1),[_,Z]=i.useState([]);i.useEffect(()=>{},[]);const ee=async t=>{t.preventDefault(),w(!0);const a=parseFloat(d.amount.toString());if(!d.name||isNaN(a))return w(!1),alert("Invalid Input. Please check Name and Amount.");const r=await y.createFeeStructure(d.name,a,d.dueDate,d.targetClassIds||[],d.collectedBy,d.isRecurring?{frequency:d.recurrenceFrequency,count:d.recurrenceCount}:void 0);w(!1),r.success?(T("Fee Category Created!"),f({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),P(),setTimeout(()=>T(""),2e3)):alert("Error: "+r.message)},E=async t=>{C(t),v([]);const a=x.find(n=>n.id===t);if(!a)return;const r=!a.targetClassIds||a.targetClassIds.length===0?D.map(n=>n.id):a.targetClassIds;let s=[];I(!0);for(const n of r){const c=D.find(g=>g.id===n);if(!c)continue;const b=(await y.getFeeCollectionStats(t,n)).map(g=>({...g,className:c.name}));s=[...s,...b]}v(s),I(!1)},te=t=>{var n;V(t);const a=x.find(c=>c.id===o),r=(a==null?void 0:a.amount)||0,s=((n=t.paymentDetails)==null?void 0:n.amount_paid)||0;L((r-s).toString()),k(!0)},se=async t=>{if(t.preventDefault(),!o||!m)return;const a=parseFloat(R);if(isNaN(a)||a<=0)return alert("Please enter valid amount");$(!0);const r=x.find(n=>n.id===o),s=await y.recordFeePayment(o,m.student.id,a,(r==null?void 0:r.amount)||0,"Admin");$(!1),k(!1),s.success?(Z(n=>[{id:Date.now(),student:m.student.name,amount:a,time:"Just now"},...n]),E(o)):alert("Failed to record payment: "+s.message)},ae=t=>{var W,Y,O,U;const a=x.find(de=>de.id===o),r=(W=window.jspdf)==null?void 0:W.jsPDF;if(!a||!r){alert("PDF Library not loaded");return}const s=new r,n=((Y=t.paymentDetails)==null?void 0:Y.amount_paid)||0,c=a.amount||0,p=Math.max(0,c-n),b=new Date((O=t.paymentDetails)==null?void 0:O.paid_date).toLocaleDateString(),g=((U=t.paymentDetails)==null?void 0:U.transaction_id)||"N/A";s.setFontSize(18),s.text(F.schoolName,105,20,{align:"center"}),s.setFontSize(10),s.text(F.place||"",105,26,{align:"center"}),s.setLineWidth(.5),s.line(20,32,190,32),s.setFontSize(14),s.text("FEE RECEIPT",105,42,{align:"center"}),s.setFontSize(12);let l=60;s.text(`Receipt No: ${g}`,20,l),s.text(`Date: ${b}`,140,l),l+=10,s.text(`Student Name: ${t.student.name}`,20,l),l+=10,s.text(`Class: ${t.className}`,20,l),s.text(`Reg No: ${t.student.regNo}`,140,l),l+=20,s.setFillColor(240,240,240),s.rect(20,l,170,10,"F"),s.setFont("helvetica","bold"),s.text("Description",25,l+7),s.text("Amount (Rs)",160,l+7),l+=10,s.setFont("helvetica","normal"),s.text(a.name,25,l+7),s.text(n.toFixed(2),160,l+7),l+=20,s.setFont("helvetica","bold"),s.text(`Total Paid: Rs. ${n.toFixed(2)}`,140,l),p>0?(l+=7,s.setTextColor(200,0,0),s.text(`Balance Due: Rs. ${p.toFixed(2)}`,140,l),s.setTextColor(0,0,0)):(l+=7,s.setTextColor(0,150,0),s.text("Status: FULLY PAID",140,l),s.setTextColor(0,0,0)),l+=30,s.setFontSize(10),s.setFont("helvetica","italic"),s.text("This is a computer generated receipt.",105,l,{align:"center"}),l+=10,s.setFontSize(8),s.setTextColor(100,100,100),s.text("Powered by ResultMate.com - Smart Campus OS",105,l,{align:"center"}),s.save(`Receipt_${t.student.name}_${a.name}.pdf`)},le=async t=>{if(!window.confirm("Delete this fee structure? Payments will be unlinked."))return;(await y.deleteFeeStructure(t)).success&&(P(),o===t&&(C(""),v([])))},h=()=>x.find(t=>t.id===o),ne=()=>u.filter(t=>t.status!=="PAID"),re=()=>{var s,n;const t=(s=window.jspdf)==null?void 0:s.jsPDF;if(!t)return alert("PDF Library not ready");const a=new t;a.text(`Defaulters List: ${(n=h())==null?void 0:n.name}`,14,20);const r=ne().map(c=>{var p,b;return[c.student.name,c.className,`${(((p=h())==null?void 0:p.amount)||0)-(((b=c.paymentDetails)==null?void 0:b.amount_paid)||0)}`]});a.autoTable({head:[["Student","Class","Balance Due"]],body:r,startY:30}),a.save("Defaulters_List.pdf")};return e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(j,{className:"border-t-4 border-t-green-500 relative overflow-hidden",children:[A&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(ie,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:A})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(J,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"New Fee"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Define amount & due date"})]})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Fee Name"}),e.jsx(N,{placeholder:"e.g. Bus Fee / Term 1",value:d.name,onChange:t=>f({...d,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount (₹)"}),e.jsx(N,{type:"number",placeholder:"0.00",value:d.amount,onChange:t=>f({...d,amount:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Due Date"}),e.jsx(N,{type:"date",value:d.dueDate,onChange:t=>f({...d,dueDate:t.target.value})})]}),e.jsx(X,{type:"submit",disabled:S,className:"w-full flex items-center justify-center gap-2",children:S?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4"})," Create Fee"]})})]})]}),e.jsxs(j,{className:"bg-slate-900 text-white border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(me,{className:"w-4 h-4 text-green-400 animate-pulse"}),e.jsx("h4",{className:"text-sm font-bold uppercase tracking-wider",children:"Live Ledger"})]}),e.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto custom-scrollbar",children:[_.map((t,a)=>e.jsxs("div",{className:"flex justify-between items-center text-xs p-2 bg-white/5 rounded border border-white/10 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:t.student}),e.jsx("p",{className:"text-slate-400",children:t.time})]}),e.jsxs("span",{className:"font-mono text-green-400",children:["+₹",t.amount]})]},a)),_.length===0&&e.jsx("p",{className:"text-xs text-slate-500 text-center italic",children:"Waiting for new payments..."})]})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:[x.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>E(t.id),className:`px-4 py-2 rounded-lg border text-sm font-bold whitespace-nowrap transition-all ${o===t.id?"bg-green-100 border-green-500 text-green-800":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[t.name," (₹",t.amount,")"]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),le(t.id)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm",children:e.jsx(oe,{className:"w-3 h-3"})})]},t.id)),x.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No fees created yet."})]}),o?e.jsxs(j,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-white",children:"Collection Status"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-green-600 font-bold bg-green-50 px-2 py-1 rounded",children:["Paid: ",u.filter(t=>t.status==="PAID").length]}),e.jsxs("span",{className:"text-orange-600 font-bold bg-orange-50 px-2 py-1 rounded",children:["Partial: ",u.filter(t=>t.status==="PARTIAL").length]}),e.jsxs("span",{className:"text-red-500 font-bold bg-red-50 px-2 py-1 rounded",children:["Due: ",u.filter(t=>t.status==="PENDING").length]}),e.jsxs("button",{onClick:re,className:"ml-2 text-slate-500 hover:text-slate-800 underline flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"})," Defaulters"]})]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 text-xs uppercase sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Class"}),e.jsx("th",{className:"p-3 text-right",children:"Paid / Total"}),e.jsx("th",{className:"p-3 text-center",children:"Status"}),e.jsx("th",{className:"p-3 text-center",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[u.map(t=>{var n,c;const a=((n=t.paymentDetails)==null?void 0:n.amount_paid)||0,r=((c=h())==null?void 0:c.amount)||0;let s=t.status;return a>0&&a<r&&(s="PARTIAL"),e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"p-3 font-bold text-slate-800 dark:text-white",children:t.student.name}),e.jsx("td",{className:"p-3 text-slate-500",children:t.className}),e.jsxs("td",{className:"p-3 text-right font-mono",children:[e.jsxs("span",{className:a>0?"text-green-600 font-bold":"text-slate-400",children:["₹",a]}),e.jsxs("span",{className:"text-slate-400",children:[" / ₹",r]})]}),e.jsx("td",{className:"p-3 text-center",children:s==="PAID"?e.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded font-bold",children:"PAID"}):s==="PARTIAL"?e.jsx("span",{className:"text-[10px] bg-orange-100 text-orange-700 px-2 py-1 rounded font-bold",children:"PARTIAL"}):e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded font-bold",children:"DUE"})}),e.jsxs("td",{className:"p-3 text-center flex justify-center gap-2",children:[s!=="PAID"&&e.jsx("button",{onClick:()=>te(t),className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded font-bold shadow-sm",children:"Pay"}),a>0&&e.jsx("button",{onClick:()=>ae(t),className:"text-xs bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 px-2 py-1.5 rounded font-bold flex items-center gap-1",title:"Download PDF",children:e.jsx(K,{className:"w-3 h-3"})})]})]},t.student.id)}),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-400",children:"No students found."})})]})]})})]}):e.jsxs("div",{className:"text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-xl border-2 border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx(J,{className:"w-12 h-12 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Select a fee category above."})]})]}),Q&&m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(j,{className:"w-full max-w-sm relative border-t-4 border-t-blue-500 bg-white dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>k(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:"✕"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[m.student.name," - ",(z=h())==null?void 0:z.name]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl mb-6 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Total Fee:"}),e.jsxs("span",{className:"font-bold",children:["₹",(B=h())==null?void 0:B.amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Already Paid:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["₹",((q=m.paymentDetails)==null?void 0:q.amount_paid)||0]})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 my-2"}),e.jsxs("div",{className:"flex justify-between font-black text-slate-800 dark:text-white",children:[e.jsx("span",{children:"Balance Due:"}),e.jsxs("span",{children:["₹",(((G=h())==null?void 0:G.amount)||0)-(((H=m.paymentDetails)==null?void 0:H.amount_paid)||0)]})]})]}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount Paying Now"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),e.jsx(N,{type:"number",className:"pl-9 font-bold text-lg",placeholder:"0.00",value:R,onChange:t=>L(t.target.value),autoFocus:!0,required:!0})]})]}),e.jsx(X,{type:"submit",disabled:M,className:"w-full bg-blue-600 hover:bg-blue-700",children:M?"Processing...":"Confirm Payment"})]})]})})]})};export{Ne as default};
