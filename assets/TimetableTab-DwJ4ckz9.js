import{c as K,r as n,a as S,j as e,z as de,g as I,b as j,ab as ce,B as ie,V as oe,d as C,G as b,a3 as L,U as xe,a2 as R,X as me,Z as he,l as be}from"./index-Bk8qI69N.js";import{C as ue}from"./DashboardAdmin-BPmfHoqW.js";import{P as U}from"./plus-Cyc8gION.js";import{T as z}from"./trash-2-DUIWYlGW.js";import{P as ge}from"./printer-DOwIcr3q.js";import{S as pe}from"./settings-B8-grqyY.js";import"./clipboard-list-Da1jz0-f.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=K("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=K("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),Te=({classes:i,schoolName:V,onRefresh:Ne})=>{var q,F,_;const[o,x]=n.useState(1),[r,u]=n.useState({workingDays:["MON","TUE","WED","THU","FRI"],dayStartsAt:"09:30",dayEndsAt:"15:30",periodDuration:45,breaks:[{name:"Lunch",start:"12:45",end:"13:30"}]}),[Z,X]=n.useState("SCHOOL"),[g,A]=n.useState([]),[N,M]=n.useState(""),[f,T]=n.useState([]),[D,O]=n.useState(""),[w,k]=n.useState({}),[d,J]=n.useState(((q=i[0])==null?void 0:q.id)||""),[Q,G]=n.useState(!1),[P,Y]=n.useState([]),[$,ee]=n.useState(((F=i[0])==null?void 0:F.id)||"");n.useEffect(()=>{B()},[]);const B=async()=>{const s=await S.getTimetableConfig();s&&u(s);const a=await S.getTimetableEntries();Y(a);const t=new Set;i.forEach(l=>{l.teacherName&&!["class teacher","admin","staff","teacher"].includes(l.teacherName.toLowerCase().trim())&&t.add(l.teacherName)});const c=Array.from(t).map((l,p)=>({id:`t_${l.replace(/\s+/g,"_")}`,name:l,subjects:[],maxLoad:28}));A(c);const h=new Set;i.forEach(l=>{l.subjects.forEach(p=>h.add(p.name))}),["Library","PET","Arts","Moral Science","Arabic","IT Lab"].forEach(l=>h.add(l)),T(Array.from(h));const m={};i.forEach(l=>{m[l.id]=l.subjects.map(p=>({subject:p.name,count:5,isDouble:!1,teacherId:""}))}),k(m)},se=s=>{X(s),u(s==="MADRASSA"?{workingDays:["SAT","SUN","MON","TUE","WED","THU"],dayStartsAt:"06:30",dayEndsAt:"08:30",periodDuration:40,breaks:[]}:s==="SCHOOL"?{workingDays:["MON","TUE","WED","THU","FRI"],dayStartsAt:"09:30",dayEndsAt:"15:30",periodDuration:45,breaks:[{name:"Lunch",start:"12:45",end:"13:30"}]}:{workingDays:["SAT","SUN"],dayStartsAt:"09:00",dayEndsAt:"13:00",periodDuration:60,breaks:[{name:"Break",start:"11:00",end:"11:15"}]})},H=()=>{if(N.trim()){if(g.some(s=>s.name.toLowerCase()===N.toLowerCase())){alert("Teacher already exists!");return}A([...g,{id:`t_${Date.now()}`,name:N,subjects:[],maxLoad:30}]),M("")}},te=s=>{confirm("Remove this teacher? Allocations will be cleared.")&&A(a=>a.filter(t=>t.id!==s))},W=s=>{s.trim()&&(f.includes(s)||(T([...f,s]),O("")))},v=(s,a,t,c)=>{k(h=>{const m=[...h[s]||[]];return m[a]={...m[a],[t]:c},{...h,[s]:m}})},ae=s=>{k(a=>{const t=[...a[s]||[]];return t.push({subject:"",count:3,isDouble:!1,teacherId:""}),{...a,[s]:t}})},le=(s,a)=>{k(t=>{const c=[...t[s]||[]];return c.splice(a,1),{...t,[s]:c}})},re=async()=>{G(!0),await S.saveTimetableConfig(r);const s=await S.autoGenerateTimetable(r,g,w);setTimeout(()=>{G(!1),s.success?(B(),x(5)):alert("Generation failed: "+s.message)},1500)},E=()=>Array.from({length:8},(s,a)=>a+1),ne=(s,a)=>P.find(t=>t.classId===$&&t.day===s&&t.periodIndex===a);return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 mb-6 sticky top-0 z-30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-lg font-black text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"hidden md:inline",children:"Scheduler AI"})]}),e.jsx("div",{className:"flex items-center gap-1 md:gap-2",children:[{s:1,l:"Setup"},{s:2,l:"Staff"},{s:3,l:"Subjects"},{s:4,l:"Map"},{s:5,l:"Result"}].map((s,a)=>e.jsxs(de.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center cursor-pointer",onClick:()=>x(s.s),children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs transition-all ${o===s.s?"bg-blue-600 text-white shadow-lg scale-110":o>s.s?"bg-green-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-400"}`,children:o>s.s?e.jsx(I,{className:"w-4 h-4"}):s.s}),e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase mt-1 hidden md:block",children:s.l})]}),a<4&&e.jsx("div",{className:`h-0.5 w-4 md:w-8 ${o>s.s?"bg-green-500":"bg-slate-200 dark:bg-slate-700"}`})]},s.s))})]})}),o===1&&e.jsxs(j,{className:"max-w-2xl mx-auto",children:[e.jsxs("h3",{className:"font-bold text-lg mb-6 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500"})," Institution Structure"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3 mb-8",children:["SCHOOL","MADRASSA","TUITION"].map(s=>e.jsxs("button",{onClick:()=>se(s),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${Z===s?"border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-600":"border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[s==="SCHOOL"&&e.jsx(ce,{className:"w-6 h-6"}),s==="MADRASSA"&&e.jsx(ie,{className:"w-6 h-6"}),s==="TUITION"&&e.jsx(oe,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-xs",children:s})]},s))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Start Time"}),e.jsx(C,{type:"time",value:r.dayStartsAt,onChange:s=>u({...r,dayStartsAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"End Time"}),e.jsx(C,{type:"time",value:r.dayEndsAt,onChange:s=>u({...r,dayEndsAt:s.target.value})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Working Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(s=>e.jsx("button",{onClick:()=>{const a=r.workingDays.includes(s)?r.workingDays.filter(t=>t!==s):[...r.workingDays,s];u({...r,workingDays:a})},className:`px-3 py-2 rounded-lg text-xs font-bold border ${r.workingDays.includes(s)?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-slate-800 text-slate-500 border-slate-200 dark:border-slate-700"}`,children:s},s))})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsxs(b,{onClick:()=>x(2),className:"bg-blue-600 hover:bg-blue-700 px-8",children:["Next Step ",e.jsx(L,{className:"w-4 h-4 ml-2"})]})})]}),o===2&&e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-500"})," Staff Room"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{placeholder:"Add New Teacher...",value:N,onChange:s=>M(s.target.value),className:"h-9 text-sm w-48",onKeyDown:s=>s.key==="Enter"&&H()}),e.jsx("button",{onClick:H,className:"bg-green-600 text-white p-2 rounded-lg hover:bg-green-700",children:e.jsx(U,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-[400px] overflow-y-auto custom-scrollbar p-1",children:[g.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700 flex items-center justify-between shadow-sm group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 font-bold text-xs",children:s.name.substring(0,2).toUpperCase()}),e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white truncate max-w-[100px]",children:s.name})]}),e.jsx("button",{onClick:()=>te(s.id),className:"text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(z,{className:"w-4 h-4"})})]},s.id)),g.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-slate-400 text-sm",children:"No teachers found. Add manually or create classes first."})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{variant:"secondary",onClick:()=>x(1),children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsxs(b,{onClick:()=>x(3),className:"bg-blue-600 hover:bg-blue-700 px-8",children:["Next Step ",e.jsx(L,{className:"w-4 h-4 ml-2"})]})]})]}),o===3&&e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-500"})," Subject Library"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{placeholder:"Add Subject...",value:D,onChange:s=>O(s.target.value),className:"h-9 text-sm w-48",onKeyDown:s=>s.key==="Enter"&&W(D)}),e.jsx("button",{onClick:()=>W(D),className:"bg-purple-600 text-white p-2 rounded-lg hover:bg-purple-700",children:e.jsx(U,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.map(s=>e.jsxs("span",{className:"px-3 py-1.5 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-700 dark:text-slate-300 flex items-center gap-2",children:[s,e.jsx("button",{onClick:()=>T(a=>a.filter(t=>t!==s)),className:"text-slate-400 hover:text-red-500",children:e.jsx(z,{className:"w-3 h-3"})})]},s)),f.length===0&&e.jsx("p",{className:"text-slate-400 text-sm w-full text-center py-4",children:"No subjects. Add common subjects like Maths, English, Arabic etc."})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{variant:"secondary",onClick:()=>x(2),children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsxs(b,{onClick:()=>x(4),className:"bg-blue-600 hover:bg-blue-700 px-8",children:["Next Step ",e.jsx(L,{className:"w-4 h-4 ml-2"})]})]})]}),o===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"md:w-64 space-y-2",children:e.jsxs(j,{className:"p-3 bg-white dark:bg-slate-900 sticky top-24",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase mb-3",children:"Select Class"}),e.jsx("div",{className:"space-y-1 max-h-[400px] overflow-y-auto custom-scrollbar",children:i.map(s=>{const t=(w[s.id]||[]).every(c=>c.teacherId);return e.jsxs("button",{onClick:()=>J(s.id),className:`w-full text-left px-3 py-2 rounded-lg text-sm font-bold flex justify-between items-center transition-all ${d===s.id?"bg-blue-600 text-white shadow-md":"text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:[s.name,t&&e.jsx(I,{className:`w-3 h-3 ${d===s.id?"text-blue-200":"text-green-500"}`})]},s.id)})})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs(j,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-100 dark:border-slate-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:(_=i.find(s=>s.id===d))==null?void 0:_.name}),e.jsx("p",{className:"text-xs text-slate-500",children:"Assign teachers to subjects. No typing required."})]}),e.jsxs("button",{onClick:()=>ae(d),className:"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-slate-200 dark:hover:bg-slate-700 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"})," Add Row"]})]}),e.jsxs("div",{className:"space-y-3",children:[(w[d]||[]).map((s,a)=>e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 items-center bg-slate-50 dark:bg-slate-800/50 p-2 rounded-xl border border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"flex-1 w-full",children:e.jsxs("select",{className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500",value:s.subject,onChange:t=>v(d,a,"subject",t.target.value),children:[e.jsx("option",{value:"",children:"Select Subject"}),f.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"flex items-center bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 mr-2",children:"Periods"}),e.jsx("input",{type:"number",className:"w-10 py-2 text-center text-sm font-bold bg-transparent outline-none",value:s.count,onChange:t=>v(d,a,"count",parseInt(t.target.value))})]}),e.jsxs("label",{className:`cursor-pointer px-3 py-2 rounded-lg border text-xs font-bold transition-all select-none ${s.isDouble?"bg-purple-100 border-purple-300 text-purple-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-400"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:s.isDouble,onChange:t=>v(d,a,"isDouble",t.target.checked)}),"2x"]})]}),e.jsx("div",{className:"flex-1 w-full",children:e.jsxs("select",{className:`w-full border rounded-lg px-3 py-2 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 ${s.teacherId?"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500"}`,value:s.teacherId||"",onChange:t=>v(d,a,"teacherId",t.target.value),children:[e.jsx("option",{value:"",children:"-- Assign Teacher --"}),g.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})}),e.jsx("button",{onClick:()=>le(d,a),className:"p-2 text-slate-300 hover:text-red-500 transition-colors",children:e.jsx(me,{className:"w-4 h-4"})})]},a)),(w[d]||[]).length===0&&e.jsx("p",{className:"text-center text-sm text-slate-400 py-8",children:'No subjects assigned. Click "Add Row".'})]})]})})]}),e.jsxs("div",{className:"flex justify-between pt-6 border-t border-slate-200 dark:border-slate-800",children:[e.jsxs(b,{variant:"secondary",onClick:()=>x(3),children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsx(b,{onClick:re,className:"bg-gradient-to-r from-purple-600 to-indigo-600 hover:to-indigo-700 px-8 py-3 shadow-xl",children:Q?"AI Building Schedule...":e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4 mr-2 fill-white"})," Generate Timetable"]})})]})]}),o===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-2 rounded-lg text-green-600",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Timetable Ready"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Generated successfully."})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx(be,{value:$,onChange:s=>ee(s.target.value),className:"w-full md:w-48 py-2 text-sm font-bold",children:i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsxs(b,{onClick:()=>window.print(),className:"bg-slate-900 text-white flex items-center gap-2 text-xs whitespace-nowrap",children:[e.jsx(ge,{className:"w-4 h-4"})," Print All"]})]})]}),e.jsx(j,{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-center border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-700 w-20 text-xs font-bold text-slate-500 uppercase",children:"Day"}),E().map(s=>e.jsxs("th",{className:"p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-700 min-w-[100px] text-xs font-bold text-slate-500 uppercase",children:["Period ",s]},s))]})}),e.jsx("tbody",{children:r.workingDays.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 font-bold bg-slate-50 dark:bg-slate-900 border dark:border-slate-700 text-slate-700 dark:text-slate-300",children:s}),E().map(a=>{const t=ne(s,a);return e.jsx("td",{className:"p-2 border dark:border-slate-700 h-20 align-middle hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:t?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-white text-xs mb-1 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded",children:t.subjectName}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:t.teacherId})]}):e.jsx("span",{className:"text-slate-300 text-xs",children:"-"})},a)})]},s))})]})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs("button",{onClick:()=>x(4),className:"text-slate-500 hover:text-blue-600 text-xs font-bold flex items-center gap-1 underline",children:[e.jsx(pe,{className:"w-3 h-3"})," Modify Allocations"]})}),e.jsx("div",{className:"hidden print:block space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.map(s=>{const a=P.filter(t=>t.teacherId===s.name);return a.length===0?null:e.jsxs("div",{className:"border-2 border-black rounded-xl p-4 break-inside-avoid bg-white text-black w-[85mm] h-[55mm] flex flex-col justify-between relative overflow-hidden page-break-inside-avoid",children:[e.jsxs("div",{className:"flex justify-between items-start border-b-2 border-black pb-1 mb-1",children:[e.jsx("div",{children:e.jsx("h3",{className:"font-black text-xs uppercase tracking-tighter",children:V})}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"font-black text-sm",children:s.name})})]}),e.jsx("div",{className:"flex-1 text-[6px] leading-none mt-1",children:r.workingDays.map(t=>e.jsxs("div",{className:"flex gap-0.5 mb-0.5 items-center",children:[e.jsx("div",{className:"font-bold w-4 text-[5px]",children:t.substring(0,2)}),E().map(c=>{var l,p;const h=(l=a.find(y=>y.day===t&&y.periodIndex===c))==null?void 0:l.classId,m=(p=i.find(y=>y.id===h))==null?void 0:p.name;return e.jsx("div",{className:"flex-1 text-center border border-black h-3 flex items-center justify-center font-bold bg-slate-50",children:m?m.replace("Class ","").replace("Standard ",""):"-"},c)})]},t))}),e.jsx("div",{className:"text-[5px] text-center mt-1 font-bold",children:"Powered by ResultMate"})]},s.id)})})})]})]})};export{Te as default};
