import{c as Ne,r as t,a as N,j as e,G as V,b as H,d as A,A as De,S as ve,Z as Ie,C as Te,F as Fe,e as Ue,T as de,f as Le,U as ke,L as Ae,g as pe,h as ye,i as Oe,k as Se,X as Ce,l as Ee,m as $e,R as Be,M as Ge,n as Ye,B as He,o as Ve,p as ze,u as _e,H as Qe,q as We}from"./index-BbFP9mZ6.js";import{T as we}from"./trash-2-BJvm3PC3.js";import{P as Me}from"./plus-CbcI9svQ.js";import{H as qe}from"./hard-drive-DxY5uiIX.js";import{P as Je}from"./printer-Dof97X9n.js";import{P as Xe}from"./pen-square-B1gDATRO.js";import{A as Ze}from"./arrow-right-left-CqaFNKs4.js";import{C as Ke,a as et}from"./clipboard-check-C4n582tC.js";import{S as Re}from"./save-CmdTa-a8.js";import{U as tt,a as st}from"./user-cog-8lpIwxK_.js";import{C as at}from"./clock-DOcut-Un.js";import{P as lt}from"./pen-Bmx6AF63.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=Ne("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=Ne("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=Ne("ScanSearch",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=Ne("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),it=({imageSrc:o,onCrop:S,onCancel:p})=>{const u=t.useRef(null),r=t.useRef(null),[T,E]=t.useState(!1),[d,w]=t.useState(null),[j,F]=t.useState({x:0,y:0}),[x,f]=t.useState(!0),B=c=>{var i;const m=(i=r.current)==null?void 0:i.getBoundingClientRect();if(!m)return{x:0,y:0};const l=c.touches?c.touches[0].clientX:c.clientX,h=c.touches?c.touches[0].clientY:c.clientY;return{x:l-m.left,y:h-m.top}},y=c=>{const m=B(c);F(m),w({x:m.x,y:m.y,w:0,h:0}),E(!0)},G=c=>{if(!T)return;const m=B(c);w({x:Math.min(j.x,m.x),y:Math.min(j.y,m.y),w:Math.abs(m.x-j.x),h:Math.abs(m.y-j.y)})},$=()=>E(!1);t.useEffect(()=>{o&&f(!0)},[o]);const U=()=>{if(r.current&&u.current){const c=u.current.naturalWidth/u.current.naturalHeight;let m=Math.min(window.innerWidth*.9,600),l=m/c;r.current.width=m,r.current.height=l,w(null);const h=r.current.getContext("2d");h&&(h.drawImage(u.current,0,0,m,l),h.fillStyle="rgba(0, 0, 0, 0.3)",h.fillRect(0,0,m,l)),setTimeout(()=>f(!1),600)}};t.useEffect(()=>{if(!r.current||!u.current||x)return;const c=r.current.getContext("2d");c&&(c.clearRect(0,0,r.current.width,r.current.height),c.drawImage(u.current,0,0,r.current.width,r.current.height),c.fillStyle="rgba(0, 0, 0, 0.5)",c.fillRect(0,0,r.current.width,r.current.height),d&&d.w>0?(c.clearRect(d.x,d.y,d.w,d.h),c.drawImage(u.current,0,0,u.current.width,u.current.height,0,0,r.current.width,r.current.height),c.fillStyle="rgba(0, 0, 0, 0.7)",c.fillRect(0,0,r.current.width,d.y),c.fillRect(0,d.y+d.h,r.current.width,r.current.height-(d.y+d.h)),c.fillRect(0,d.y,d.x,d.h),c.fillRect(d.x+d.w,d.y,r.current.width-(d.x+d.w),d.h),c.strokeStyle="#00ff00",c.lineWidth=2,c.setLineDash([6]),c.strokeRect(d.x,d.y,d.w,d.h)):(c.font="bold 14px sans-serif",c.fillStyle="white",c.textAlign="center",c.fillText("Drag to select text",r.current.width/2,r.current.height/2)))},[d,x]);const P=()=>{if(!d||!u.current||d.w<10){if(u.current&&r.current){u.current.naturalWidth/r.current.width,u.current.naturalHeight/r.current.height,w({x:0,y:0,w:r.current.width,h:r.current.height}),setTimeout(()=>P(),100);return}return}const c=r.current,m=u.current;if(!c)return;const l=m.naturalWidth/c.width,h=m.naturalHeight/c.height,i=document.createElement("canvas");i.width=d.w*l,i.height=d.h*h;const M=i.getContext("2d");M==null||M.drawImage(m,d.x*l,d.y*h,d.w*l,d.h*h,0,0,i.width,i.height),i.toBlob(L=>{L&&S(L)},"image/jpeg")};return e.jsxs("div",{className:"fixed inset-0 z-[70] bg-black/95 flex flex-col items-center justify-center p-4 backdrop-blur-sm",children:[x?e.jsxs("div",{className:"flex flex-col items-center animate-fade-in-up",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ot,{className:"w-16 h-16 text-green-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-green-500/20 blur-xl rounded-full animate-ping"})]}),e.jsx("h3",{className:"text-white font-bold text-lg tracking-widest",children:"SCANNING PAGE..."}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Analyzing text structure"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800 px-6 py-2 rounded-full mb-4 flex items-center gap-2 shadow-lg border border-slate-700 animate-fade-in-up",children:[e.jsx(rt,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-white text-sm font-bold",children:"Select the area to read"})]}),e.jsx("div",{className:"relative max-h-[70vh] overflow-hidden border-2 border-slate-700 rounded-lg bg-black shadow-2xl",children:e.jsx("canvas",{ref:r,onMouseDown:y,onMouseMove:G,onMouseUp:$,onTouchStart:y,onTouchMove:G,onTouchEnd:$,className:"cursor-crosshair block touch-none"})}),e.jsxs("div",{className:"flex gap-4 mt-6 w-full max-w-sm",children:[e.jsx(V,{variant:"secondary",onClick:p,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-800",children:"Discard"}),e.jsxs(V,{onClick:P,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-900/20",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"})," ",d&&d.w>10?"Crop Selection":"Use Full Page"]})]})]}),e.jsx("img",{ref:u,src:o,className:"hidden",onLoad:U})]})},ct=({classId:o})=>{const[S,p]=t.useState([]),[u,r]=t.useState(!1),[T,E]=t.useState(!1),[d,w]=t.useState(null),[j,F]=t.useState([]),[x,f]=t.useState(!1),[B,y]=t.useState(!1),[G,$]=t.useState(!1),[U,P]=t.useState("SCAN"),[c,m]=t.useState(""),[l,h]=t.useState(5),[i,M]=t.useState("From Book Only"),[L,ce]=t.useState("Malayalam"),[_,se]=t.useState([]),[k,Y]=t.useState(!1),[X,K]=t.useState(null),[be,Q]=t.useState([]),[ee,ae]=t.useState(""),[z,ge]=t.useState("CLASS_TEST"),[xe,fe]=t.useState(""),[le,me]=t.useState(""),[re,he]=t.useState(""),[ne,oe]=t.useState(30),[je,a]=t.useState({shuffleQuestions:!1,showResultImmediately:!0}),[v,s]=t.useState([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}]);t.useEffect(()=>{D()},[]);const b=n=>{if(n.target.files&&n.target.files.length>0){const R=new FileReader;R.onload=C=>{var O;(O=C.target)!=null&&O.result&&(K(C.target.result),y(!1))},R.readAsDataURL(n.target.files[0])}},g=async()=>{if(U==="TOPIC"&&!c)return alert("Please enter a topic.");if(U==="SCAN"&&_.length===0)return alert("Please upload at least one page.");Y(!0);const n=await N.useFeatureWithTrial("ai_gen",5,2,"AI Question Generation",void 0,"TEACHER");if(!n.success){Y(!1),alert("Request Denied: "+n.message);return}const R=n.transactionId;try{const C=new Ue({apiKey:void 0}),O="gemini-2.5-flash",W=l+3,q=[];let J=`Generate ${W} multiple choice questions. Language: ${L}. Provide JSON output with 'text', 'options' (array of 4 strings), 'correctOptionIndex' (0-3 number), and 'marks' (default 1).`;i==="From Book Only"?J+=" STRICT INSTRUCTION: Generate questions ONLY using the text content found in the provided images.":J+=` The questions should be appropriate for ${i} level students.`,U==="SCAN"?(_.forEach(ue=>{q.push({inlineData:{mimeType:"image/jpeg",data:ue.split(",")[1]}})}),J+=" Analyze the images thoroughly. Focus on key facts."):J+=` The topic is: "${c}".`,q.push({text:J});const te=await C.models.generateContent({model:O,contents:{parts:q},config:{responseMimeType:"application/json",responseSchema:{type:de.ARRAY,items:{type:de.OBJECT,properties:{text:{type:de.STRING},options:{type:de.ARRAY,items:{type:de.STRING}},correctOptionIndex:{type:de.INTEGER},marks:{type:de.INTEGER}}}}}}),Z=JSON.parse(te.text||"[]");if(Array.isArray(Z)&&Z.length>0){const ue=Z.map(ie=>({id:Math.random().toString(36).substr(2,9),text:ie.text,options:ie.options,correctOptionIndex:ie.correctOptionIndex,marks:ie.marks||1}));s(ie=>[...ie,...ue]),y(!1),se([]),m("");const Pe=n.isTrial?` (Free Trial Used - ${n.remaining} left)`:" (5 Credits Deducted)";alert(`${ue.length} AI Questions Added!${Pe}`)}else throw new Error("Invalid AI Response (Empty)")}catch{R?(await N.refundCredits(R,"AI Generation Failed"),alert("AI Generation failed. Credits have been refunded.")):alert("AI Failed. No credits deducted (Trial mode).")}finally{Y(!1)}},D=async()=>{const n=await N.getExamsForClass(o);p(n)},I=async()=>{if(!ee||!le||!re)return alert("Please fill all details");E(!0);const n=await N.createExam({classId:o,title:ee,examType:z,description:xe,startTime:new Date(le).toISOString(),endTime:new Date(re).toISOString(),durationMinutes:ne,questions:v,settings:je});E(!1),n.success?(r(!1),D(),ae(""),s([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}])):alert(n.message)};return u?e.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create Exam"}),e.jsx(V,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"})]}),e.jsxs(H,{className:"mb-6 border-t-4 border-t-blue-600",children:[e.jsx(A,{placeholder:"Exam Title",value:ee,onChange:n=>ae(n.target.value)}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Start Time"}),e.jsx(A,{type:"datetime-local",value:le,onChange:n=>me(n.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"End Time"}),e.jsx(A,{type:"datetime-local",value:re,onChange:n=>he(n.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Duration (Mins)"}),e.jsx(A,{type:"number",value:ne,onChange:n=>oe(parseInt(n.target.value))})]})]}),e.jsxs("p",{className:"text-[10px] text-orange-500 mt-2 flex items-center gap-1 font-bold",children:[e.jsx(De,{className:"w-3 h-3"})," Warning: V9 System prevents scheduling two exams at the same time."]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-slate-300",children:["Questions (",v.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>y(!0),className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition-transform",children:[e.jsx(ve,{className:"w-4 h-4 text-yellow-300"})," AI Generator ",e.jsx("span",{className:"bg-white/20 px-1 rounded text-[9px]",children:"Try Free"})]})})]}),e.jsx("div",{className:"space-y-4 mb-6",children:v.map((n,R)=>e.jsxs(H,{className:"relative",children:[e.jsx("button",{onClick:()=>{const C=[...v];C.splice(R,1),s(C)},className:"absolute top-2 right-2 text-slate-300 hover:text-red-500",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-1 block",children:["Question ",R+1]}),e.jsx(A,{className:"mb-3 font-bold",value:n.text,onChange:C=>{const O=[...v];O[R].text=C.target.value,s(O)},placeholder:"Question Text"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.options.map((C,O)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"radio",name:`q-${n.id}`,checked:n.correctOptionIndex===O,onChange:()=>{const W=[...v];W[R].correctOptionIndex=O,s(W)},className:"w-4 h-4 accent-green-600 cursor-pointer"}),e.jsx(A,{className:"text-sm h-9",value:C,onChange:W=>{const q=[...v];q[R].options[O]=W.target.value,s(q)},placeholder:`Option ${O+1}`})]},O))})]},n.id))}),e.jsxs("div",{className:"flex gap-4 sticky bottom-4 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur p-2 rounded-2xl border shadow-xl",children:[e.jsx("button",{onClick:()=>s([...v,{id:Date.now().toString(),text:"",options:["","","",""],correctOptionIndex:0,marks:1}]),className:"flex-1 py-3 border-2 border-dashed rounded-xl font-bold text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:"Add Question"}),e.jsx(V,{onClick:I,disabled:T,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/30",children:T?"Saving...":"Save Exam"})]}),B&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4",children:e.jsxs(H,{className:"max-w-md w-full",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-500"})," AI Question Generator"]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg border border-purple-200 dark:border-purple-800 mb-4 flex items-center gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-purple-800 dark:text-purple-200",children:"Try Before You Pay"}),e.jsx("p",{className:"text-[10px] text-purple-700 dark:text-purple-300",children:"First 2 generations are FREE. Then 5 Credits/use."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>P("SCAN"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${U==="SCAN"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Scan Page"}),e.jsx("button",{onClick:()=>P("TOPIC"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${U==="TOPIC"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Topic"})]}),U==="TOPIC"&&e.jsx(A,{placeholder:"Enter Topic (e.g. Photosynthesis)",value:c,onChange:n=>m(n.target.value)}),U==="SCAN"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block p-4 border-2 border-dashed rounded-xl text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors",children:[e.jsx(Te,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),e.jsx("span",{className:"text-xs text-slate-500 font-bold block",children:"Take Photo / Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:b})]}),_.length>0&&e.jsxs("p",{className:"text-center text-xs text-green-500 font-bold",children:[_.length," images scanned"]})]}),e.jsx(V,{onClick:g,disabled:k,className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-xl",children:k?"Processing...":"Generate Now"}),e.jsx("button",{onClick:()=>y(!1),className:"w-full text-xs text-slate-500 mt-2 hover:text-slate-700",children:"Cancel"})]})]})}),X&&e.jsx(it,{imageSrc:X,onCancel:()=>{K(null),y(!0)},onCrop:n=>{const R=new FileReader;R.readAsDataURL(n),R.onloadend=()=>{R.result&&(se(C=>[...C,R.result]),K(null),y(!0))}}})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Exams"}),e.jsxs(V,{onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"})," New Exam"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[S.map(n=>e.jsxs(H,{className:"relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(Fe,{className:"w-16 h-16"})}),e.jsx("h4",{className:"font-bold text-lg text-slate-800 dark:text-white",children:n.title}),e.jsxs("p",{className:"text-xs text-slate-500 mb-3",children:[n.questions.length," Questions â€¢ ",n.durationMinutes," Mins"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"text-[10px] font-bold px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 text-slate-500",children:new Date(n.startTime)>new Date?"Scheduled":new Date(n.endTime)<new Date?"Ended":"Live"})})]},n.id)),S.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-slate-400",children:"No exams created yet."})]})]})},xt=({user:o,students:S,pendingAdmissions:p,stats:u,sortingMethod:r,onRefresh:T,onDeleteStudent:E,onAdmissionAction:d,onCleanJunk:w})=>{const[j,F]=t.useState(!1),[x,f]=t.useState({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),[B,y]=t.useState(!1),[G,$]=t.useState({name:!1,dob:!1,gender:!1}),[U,P]=t.useState(""),[c,m]=t.useState(""),[l,h]=t.useState(!1),[i,M]=t.useState(!1),[L,ce]=t.useState(null),[_,se]=t.useState(!1),[k,Y]=t.useState({}),[X,K]=t.useState(""),[be,Q]=t.useState([]),[ee,ae]=t.useState(!1),z=o.submissionStatus==="SUBMITTED"||o.submissionStatus==="APPROVED";t.useEffect(()=>{(async()=>{const v=await N.getClasses();Q(v.filter(s=>s.id!==o.id))})()},[o.id]);const ge=t.useMemo(()=>{const a=r||"BOYS_FIRST";if(a==="BOYS_FIRST"||a==="GIRLS_FIRST"){const v=S.filter(b=>b.gender==="Male").sort((b,g)=>(b.rollNo||9999)-(g.rollNo||9999)),s=S.filter(b=>b.gender!=="Male").sort((b,g)=>(b.rollNo||9999)-(g.rollNo||9999));return a==="BOYS_FIRST"?[...v,...s]:[...s,...v]}return[...S].sort((v,s)=>a==="ROLL_ONLY"?(v.rollNo||9999)-(s.rollNo||9999):a==="NAME_ONLY"?v.name.localeCompare(s.name):0)},[S,r]),xe=a=>{x[a]?$(v=>({...v,[a]:!1})):$(v=>({...v,[a]:!0}))},fe=async a=>{if(!a.target.files||a.target.files.length===0)return;if(!o.isPro){alert("Photo upload is an Elite/Pro feature.");return}M(!0);const v=a.target.files[0],s=await N.uploadImage(v,"students");M(!1),s.success&&s.publicUrl?(f(b=>({...b,photoUrl:s.publicUrl})),h(!1)):alert("Upload failed: "+s.message)},le=async a=>{if(a.preventDefault(),z){alert("Class is locked/submitted. Ask admin to unlock before adding students.");return}m(""),P(""),$({name:!1,dob:!1,gender:!1});let v=!1;if(x.name||($(g=>({...g,name:!0})),v=!0),x.dob||($(g=>({...g,dob:!0})),v=!0),x.gender||($(g=>({...g,gender:!0})),v=!0),v){m("âš ï¸ Please fill Name, DOB & Gender!");return}y(!0);const s={...x,fatherName:x.fatherName||"Not Entered",motherName:x.motherName||"Not Entered",addedBy:o.teacherName||"Class Teacher"};if(!s.photoUrl){const g=s.name||"Felix";s.photoUrl=`https://api.dicebear.com/7.x/avataaars/svg?seed=${g}&gender=${s.gender==="Female"?"female":"male"}`}const b=await N.createStudent(o.id,s);y(!1),b.success?(P(`âœ… ${x.name} Added!`),f({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),T(),setTimeout(()=>P(""),2500)):alert("Failed: "+b.message)},me=a=>{ce(a),Y({...a}),se(!1),K("")},re=async()=>{if(z)return alert("Class is locked.");await N.updateStudentDetails(L.id,k),d(L.id,"APPROVE"),ne(null)},he=async()=>{if(!X||!L)return;ae(!0);const a=await N.transferStudentAdmission(L.id,X);ae(!1),a.success?(alert("Student Transferred Successfully!"),ce(null),T()):alert("Transfer failed: "+a.message)},ne=a=>{ce(a),se(!1),Y({})},oe=`${window.location.origin}/#/register?schoolId=${o.schoolId}&classId=${o.id}`,je=`Dear Parents,

Admission for *${o.name}* is now open.
Please register your child using the link below:

ðŸ”— ${oe}

Thank you,
${o.teacherName||"Class Teacher"}`;return e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(H,{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white border-none relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:e.jsx(ke,{className:"w-24 h-24"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Smart Invite"}),e.jsx("p",{className:"text-xs text-indigo-200 mb-4",children:"Share this link with parents for self-registration."}),e.jsx("div",{className:"bg-black/20 p-2 rounded-lg text-[10px] font-mono mb-4 break-all truncate border border-white/10",children:oe}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>window.open(`https://wa.me/?text=${encodeURIComponent(je)}`,"_blank"),className:"flex-1 bg-[#25D366] hover:bg-[#20bd5a] text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 shadow-lg",children:"WhatsApp"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(oe),className:"flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:"Copy Link"})]})]}),e.jsxs(H,{className:"bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-white flex items-center gap-2 text-sm mb-3",children:[e.jsx(qe,{className:"w-4 h-4 text-orange-500"})," Class Health"]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-slate-500",children:"Verified Students"}),e.jsx("span",{className:"font-bold text-green-600",children:u.total})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-3",children:[e.jsx("span",{className:"text-slate-500",children:"Pending/Ghost"}),e.jsx("span",{className:"font-bold text-red-500",children:p.length})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mb-3",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full",style:{width:`${u.total/(u.total+p.length||1)*100}%`}})}),e.jsxs("button",{onClick:w,disabled:p.length===0||z,className:"w-full text-xs flex items-center justify-center gap-1 bg-white dark:bg-slate-800 border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 py-2 rounded hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-50",children:[e.jsx(dt,{className:"w-3 h-3"})," Delete All Unverified"]})]}),e.jsxs(H,{className:`border-t-4 ${z?"border-t-slate-400 opacity-80":"border-t-blue-500"} relative overflow-hidden`,children:[z&&e.jsxs("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-950/60 backdrop-blur-[1px] z-10 flex flex-col items-center justify-center text-center",children:[e.jsx(Ae,{className:"w-8 h-8 text-slate-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Class Locked"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Results submitted. Cannot add students."})]}),U&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(pe,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:U})]}),c&&e.jsx("div",{className:"mb-4 bg-red-50 text-red-600 p-2 rounded text-xs text-center border border-red-100",children:c}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(ye,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Add Student"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Manual Entry"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"mb-4 flex gap-4 items-center bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"relative w-16 h-16 shrink-0 rounded-full overflow-hidden border-2 border-slate-200 shadow-sm",children:x.photoUrl?e.jsx("img",{src:x.photoUrl,className:"w-full h-full object-cover"}):e.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${x.name||"Felix"}&gender=${x.gender==="Female"?"female":"male"}`,className:"w-full h-full opacity-80"})}),e.jsx("div",{className:"flex-1 space-y-2",children:l?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"cursor-pointer bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded text-[10px] font-bold text-center block",children:[i?"Uploading...":"Choose File",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:fe,disabled:i})]}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"text-[10px] text-red-500",children:"Cancel"})]}):e.jsxs("div",{children:[e.jsx(A,{className:"text-xs h-8",placeholder:"Paste Image URL...",value:x.photoUrl,onChange:a=>f({...x,photoUrl:a.target.value})}),o.isPro&&e.jsx("button",{type:"button",onClick:()=>h(!0),className:"text-[10px] text-blue-600 font-bold underline mt-1 block",children:"Or Upload File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"FULL NAME *"}),e.jsx("input",{value:x.name,onChange:a=>f({...x,name:a.target.value.toUpperCase()}),onBlur:()=>xe("name"),className:`w-full bg-white dark:bg-slate-800 font-bold rounded-lg px-4 py-2.5 outline-none border-2 ${G.name?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"Gender *"}),e.jsxs("select",{className:"w-full bg-white dark:bg-slate-800 px-3 py-2.5 outline-none font-medium border-2 rounded-lg",value:x.gender,onChange:a=>f({...x,gender:a.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Boy"}),e.jsx("option",{value:"Female",children:"Girl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"DOB *"}),e.jsx("input",{type:"date",value:x.dob,onChange:a=>f({...x,dob:a.target.value}),className:`w-full bg-white dark:bg-slate-800 font-medium rounded-lg px-3 py-2 outline-none border-2 ${G.dob?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(A,{className:"text-sm font-mono",placeholder:"Reg No (Auto)",value:x.regNo,onChange:a=>f({...x,regNo:a.target.value})}),e.jsx(A,{type:"number",className:"text-sm font-mono",placeholder:"Roll No",value:x.rollNo,onChange:a=>f({...x,rollNo:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(A,{className:"text-sm",placeholder:"Father",value:x.fatherName,onChange:a=>f({...x,fatherName:a.target.value})}),e.jsx(A,{className:"text-sm",placeholder:"Mother",value:x.motherName,onChange:a=>f({...x,motherName:a.target.value})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(V,{onClick:le,disabled:B,className:"w-full py-3 text-sm font-bold",children:B?"Saving...":"Save & Add Next"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[p.length>0&&e.jsxs(H,{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"})," Pending Admissions (",p.length,")"]}),e.jsx("span",{className:"text-[10px] bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-2 py-1 rounded",children:"Action Required"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:p.map(a=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center justify-between group hover:border-orange-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${a.name}`,className:"w-10 h-10 rounded-full object-cover bg-slate-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["Applied: ",new Date().toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>me(a),className:"bg-white dark:bg-slate-800 border border-blue-200 dark:border-blue-800 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors",children:"Review"})]},a.id))})]}),e.jsxs(H,{className:"p-0 overflow-hidden min-h-[400px] relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-500"})," Class List (",S.length,")"]}),e.jsxs(V,{variant:"secondary",onClick:()=>F(!0),className:"text-xs flex items-center gap-1",disabled:z,children:[e.jsx(Je,{className:"w-3 h-3"})," Register"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:"Roll"}),e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3 w-24",children:"Reg No"}),e.jsx("th",{className:"p-3 w-24",children:"DOB"}),e.jsx("th",{className:"p-3 w-20 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:ge.map(a=>e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-center text-slate-500",children:a.rollNo||"-"}),e.jsx("td",{className:"p-3 text-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[a.photoUrl&&e.jsx("img",{src:a.photoUrl,className:"w-6 h-6 rounded-full object-cover"}),a.name,a.isPremium&&e.jsx(Oe,{className:"w-3 h-3 text-yellow-500"})]})}),e.jsx("td",{className:"p-3 font-mono text-slate-600 dark:text-slate-300",children:a.regNo}),e.jsx("td",{className:"p-3 text-slate-500 font-mono",children:Se(a.dob)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>E(a.id,a.name),disabled:z,className:"p-2 text-slate-400 hover:text-red-500 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(we,{className:"w-4 h-4"})})})]},a.id))})]})})]})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(H,{className:"w-full max-w-2xl bg-white dark:bg-slate-900 border-t-4 border-t-blue-600 max-h-[90vh] overflow-y-auto flex flex-col p-0",children:[e.jsxs("div",{className:"p-6 pb-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Review Application"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Verify details before approving."})]}),e.jsx("button",{onClick:()=>ne(null),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Ce,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"p-6 grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:L.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${L.name}`,className:"w-32 h-32 rounded-full object-cover mx-auto border-4 border-white dark:border-slate-800 shadow-lg bg-slate-100"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Applicant Photo"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm",children:"Student Details"}),e.jsxs("button",{onClick:()=>se(!_),className:"text-xs text-blue-600 underline flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"})," ",_?"Cancel Edit":"Edit"]})]}),e.jsx("div",{className:"space-y-2 text-sm",children:_?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-8 text-xs",value:k.name,onChange:a=>Y({...k,name:a.target.value.toUpperCase()}),placeholder:"Name"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(A,{className:"h-8 text-xs",value:k.regNo,onChange:a=>Y({...k,regNo:a.target.value}),placeholder:"Reg No"}),e.jsx("input",{type:"date",className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:k.dob,onChange:a=>Y({...k,dob:a.target.value})})]}),e.jsxs("select",{className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:k.gender,onChange:a=>Y({...k,gender:a.target.value}),children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Name:"})," ",e.jsx("span",{className:"font-bold",children:k.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Reg No:"})," ",e.jsx("span",{className:"font-mono",children:k.regNo||"-"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"DOB:"})," ",e.jsx("span",{children:Se(k.dob)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Gender:"})," ",e.jsx("span",{children:k.gender})]})]})})]})]}),e.jsxs("div",{className:"space-y-6 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm mb-3",children:"Parent Information"}),e.jsx("div",{className:"space-y-2 text-sm",children:_?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-8 text-xs",value:k.fatherName,onChange:a=>Y({...k,fatherName:a.target.value}),placeholder:"Father's Name"}),e.jsx(A,{className:"h-8 text-xs",value:k.motherName,onChange:a=>Y({...k,motherName:a.target.value}),placeholder:"Mother's Name"}),e.jsx(A,{className:"h-8 text-xs",value:k.phone,onChange:a=>Y({...k,phone:a.target.value}),placeholder:"Phone"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Father:"})," ",e.jsx("span",{className:"font-bold",children:k.fatherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Mother:"})," ",e.jsx("span",{children:k.motherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Phone:"})," ",e.jsx("span",{children:k.phone})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Address:"})," ",e.jsx("span",{className:"text-xs",children:k.address||"-"})]})]})})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Wrong Class? Transfer Request"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ee,{className:"h-9 text-xs py-0",value:X,onChange:a=>K(a.target.value),children:[e.jsx("option",{value:"",children:"Select Target Class"}),be.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("button",{onClick:he,disabled:!X||ee,className:"bg-purple-100 text-purple-700 px-3 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors whitespace-nowrap",children:ee?"Moving...":e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-3 h-3 inline mr-1"})," Move"]})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>d(L.id,"REJECT"),className:"flex-1 py-3 border border-red-200 text-red-600 rounded-xl font-bold text-sm hover:bg-red-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"})," Reject"]}),e.jsxs("button",{onClick:re,disabled:z,className:"flex-[2] py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 shadow-lg shadow-green-500/30 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(pe,{className:"w-4 h-4"})," Approve Admission"]})]})]})]})]})]})})]})},mt=({students:o,marks:S,subjects:p,isSubmitted:u,loading:r,onMarkChange:T,onSaveAll:E,onSubmitResults:d})=>{const w=[...o].sort((m,l)=>(m.rollNo||9999)-(l.rollNo||9999)),[j,F]=t.useState("TERM"),[x,f]=t.useState(!1),[B,y]=t.useState(!1),[G,$]=t.useState(null);t.useEffect(()=>{(async()=>{const l=await N.getSchoolConfig();l!=null&&l.allowTeacherDirectPublish&&f(!0)})()},[]);const U=["CLASS_TEST","REVISION"].includes(j),P=async()=>{if(U&&x){if(!confirm(`Directly publish ${j} results? Parents will see this immediately.`))return;y(!0),d()}else d()},c=(m,l,h)=>{if($(null),h===""||h.toUpperCase()==="AB"||h.toUpperCase()==="A"){T(m,l,h);return}const i=parseFloat(h);if(isNaN(i))return;const M=p.find(L=>L.name===l);if(M){if(i>M.maxMarks){$(`Cannot enter ${i} for ${l}. Max is ${M.maxMarks}.`);return}if(i<0)return}T(m,l,h)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm relative",children:[G&&e.jsxs("div",{className:"absolute top-full left-0 right-0 bg-red-100 text-red-700 text-xs font-bold p-2 text-center border-b border-red-200 z-20 animate-fade-in-up",children:[e.jsx($e,{className:"w-3 h-3 inline mr-1"})," ",G]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Assessment Type"}),e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>F("TERM"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${j==="TERM"?"bg-white dark:bg-slate-800 text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Ke,{className:"w-4 h-4"})," Term Exam"]}),e.jsxs("button",{onClick:()=>F("CLASS_TEST"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${j==="CLASS_TEST"?"bg-white dark:bg-slate-800 text-purple-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(et,{className:"w-4 h-4"})," Class Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white hidden md:block",children:"Marks Entry"}),u&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"})," Locked"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(V,{onClick:E,variant:"secondary",disabled:r||u,className:"flex-1 md:flex-none",children:[e.jsx(Re,{className:"w-4 h-4 mr-2 inline"})," Save Draft"]}),U&&x?e.jsxs(V,{onClick:P,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-500/20 flex-1 md:flex-none",disabled:u,children:[e.jsx(Be,{className:"w-4 h-4 mr-2 inline"})," Publish Result"]}):e.jsx(V,{onClick:d,className:u?"bg-orange-500 hover:bg-orange-600 flex-1 md:flex-none":"bg-blue-600 hover:bg-blue-700 flex-1 md:flex-none",children:u?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4 mr-2 inline"})," Request Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 mr-2 inline"})," Submit to Admin"]})})]})]}),e.jsx(H,{className:"overflow-x-auto p-0",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-xs uppercase font-bold text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-3 w-48 sticky left-0 bg-slate-100 dark:bg-slate-800 z-10",children:"Student Name"}),p.map(m=>e.jsxs("th",{className:"p-3 text-center min-w-[80px]",children:[m.name.substring(0,10),e.jsxs("span",{className:"block text-[9px] opacity-60",children:["Max: ",m.maxMarks]})]},m.name)),e.jsx("th",{className:"p-3 w-24 text-center font-black",children:"Total"}),e.jsx("th",{className:"p-3 w-16 text-center",children:"Grade"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:w.map(m=>{const l=S[m.id];return l?e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-3 text-center font-mono text-slate-500",children:m.rollNo||"-"}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-slate-200 sticky left-0 bg-white dark:bg-slate-900 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:m.name}),p.map(h=>e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"text",className:`w-12 text-center p-1.5 rounded border outline-none font-bold transition-all focus:ring-2 focus:ring-blue-500 ${u?"bg-slate-100 text-slate-500 cursor-not-allowed":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700"}`,value:l.subjects[h.name]||"",onChange:i=>c(m.id,h.name,i.target.value),disabled:u,placeholder:"-"})},h.name)),e.jsx("td",{className:"p-3 text-center font-black text-blue-600 dark:text-blue-400",children:l.total}),e.jsx("td",{className:`p-3 text-center font-bold ${l.grade==="F"?"text-red-500":"text-green-600"}`,children:l.grade})]},m.id):null})})]})})]})},ht=({onPostNotice:o})=>{const[S,p]=t.useState(""),[u,r]=t.useState(""),[T,E]=t.useState(""),[d,w]=t.useState(!1),[j,F]=t.useState(!1);t.useEffect(()=>{if(d){const f=setTimeout(()=>w(!1),2e3);return()=>clearTimeout(f)}},[d]);const x=async()=>{if(!S||!u){alert("Please enter title and message");return}F(!0);const f=await o(S,u,T);F(!1),f&&(p(""),r(""),E(""),w(!0))};return e.jsx("div",{className:"max-w-md mx-auto animate-fade-in-up",children:e.jsxs(H,{className:"border-t-4 border-t-blue-500 relative overflow-hidden",children:[d&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(pe,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:T?"Scheduled!":"Notice Posted!"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(Ge,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Post Notice"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Inform students & parents"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Title"}),e.jsx(A,{placeholder:"e.g. Exam Schedule",value:S,onChange:f=>p(f.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Message"}),e.jsx("textarea",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-sm h-32 resize-none",placeholder:"Type here...",value:u,onChange:f=>r(f.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Schedule for Later (Optional)"}),e.jsx(A,{type:"datetime-local",value:T,onChange:f=>E(f.target.value)})]}),e.jsxs(V,{onClick:x,disabled:j,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),j?"Posting...":T?"Schedule Post":"Post Notice"]})]})]})})},ut=({subjects:o,onAddSubject:S,onDeleteSubject:p,canEdit:u})=>{const[r,T]=t.useState({name:"",max:"50",pass:"18"}),[E,d]=t.useState(!1),w=async()=>{if(!r.name)return;d(!0);const j=parseInt(r.max)||50,F=parseInt(r.pass)||18,x=await S(r.name,j,F);d(!1),x&&T({name:"",max:"50",pass:"18"})};return e.jsx("div",{className:"max-w-2xl mx-auto animate-fade-in-up",children:e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-lg text-purple-600 dark:text-purple-400",children:e.jsx(He,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Manage Subjects"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Add or remove subjects for this class."})]})]}),e.jsxs("div",{className:"space-y-3 mb-8",children:[o.map((j,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-700 dark:text-slate-200",children:j.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Max: ",j.maxMarks," | Pass: ",j.passMarks]})]}),u&&e.jsx("button",{onClick:()=>p(F),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(we,{className:"w-4 h-4"})})]},F)),o.length===0&&e.jsx("p",{className:"text-center text-slate-400 text-sm",children:"No subjects added."})]}),u?e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-900 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:"Add New Subject"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(A,{placeholder:"Subject Name (e.g. Maths)",value:r.name,onChange:j=>T({...r,name:j.target.value}),className:"flex-[2]"}),e.jsx("div",{className:"flex-1",children:e.jsx(A,{type:"number",placeholder:"Max",value:r.max,onChange:j=>T({...r,max:j.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(A,{type:"number",placeholder:"Pass",value:r.pass,onChange:j=>T({...r,pass:j.target.value})})})]}),e.jsx(V,{onClick:w,disabled:E,className:"w-full flex justify-center items-center gap-2",children:E?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4"})," Add Subject"]})})]}):e.jsx("div",{className:"text-center p-4 bg-yellow-50 text-yellow-700 text-sm rounded-lg border border-yellow-200",children:"Subject editing is disabled by Admin."})]})})},pt=({students:o,classId:S})=>{const[p,u]=t.useState("DAILY"),[r,T]=t.useState(new Date().toISOString().split("T")[0]),[E,d]=t.useState("Term 1"),[w,j]=t.useState({}),[F,x]=t.useState(!1),[f,B]=t.useState(!1),[y,G]=t.useState(50);t.useEffect(()=>{$()},[p,r,E]);const $=async()=>{x(!0);const l={};p==="DAILY"?((await N.getAttendanceByDate(S,r)).forEach(i=>{l[i.studentId]=i.status}),o.forEach(i=>{l[i.id]||(l[i.id]="PRESENT")})):((await N.getAttendanceByTerm(S,E)).forEach(i=>{l[i.studentId]={present:i.presentDays,total:i.workingDays},i.workingDays&&G(i.workingDays)}),o.forEach(i=>{l[i.id]||(l[i.id]={present:0,total:y})})),j(l),x(!1)},U=l=>{j(h=>{const i=h[l],M=i==="PRESENT"?"ABSENT":i==="ABSENT"?"LATE":"PRESENT";return{...h,[l]:M}})},P=(l,h)=>{const i=parseInt(h)||0;j(M=>({...M,[l]:{present:i,total:y}}))},c=async()=>{B(!0);const l=o.map(i=>({studentId:i.id,classId:S,date:r,status:w[i.id],type:"DAILY"})),h=await N.markDailyAttendance(l);B(!1),h.success?alert("Daily Attendance Saved!"):alert("Failed to save.")},m=async()=>{B(!0);const l=o.map(i=>{var M;return{studentId:i.id,classId:S,term:E,workingDays:y,presentDays:((M=w[i.id])==null?void 0:M.present)||0,status:"PRESENT",type:"SUMMARY"}}),h=await N.saveSummaryAttendance(l);B(!1),h.success?alert("Term Attendance Saved!"):alert("Failed to save.")};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 gap-4",children:[e.jsxs("div",{className:"flex items-center bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("button",{onClick:()=>u("DAILY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${p==="DAILY"?"bg-white dark:bg-slate-800 shadow text-blue-600 dark:text-blue-400":"text-slate-500"}`,children:[e.jsx(Ve,{className:"w-4 h-4"})," Daily Tracker"]}),e.jsxs("button",{onClick:()=>u("SUMMARY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${p==="SUMMARY"?"bg-white dark:bg-slate-800 shadow text-purple-600 dark:text-purple-400":"text-slate-500"}`,children:[e.jsx(nt,{className:"w-4 h-4"})," Term Summary"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[p==="DAILY"?e.jsx(A,{type:"date",value:r,onChange:l=>T(l.target.value),className:"font-bold text-sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{value:E,onChange:l=>d(l.target.value),className:"w-32 text-sm py-2",children:[e.jsx("option",{children:"Term 1"}),e.jsx("option",{children:"Term 2"}),e.jsx("option",{children:"Finals"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase whitespace-nowrap",children:"Total Days:"}),e.jsx("input",{type:"number",className:"w-12 bg-transparent text-sm font-bold text-center outline-none",value:y,onChange:l=>G(parseInt(l.target.value)||0)})]})]}),e.jsx(V,{onClick:p==="DAILY"?c:m,disabled:f,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:f?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"})," Save"]})})]})]}),e.jsx(H,{className:"p-0 overflow-hidden min-h-[400px]",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Status / Days Present"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:o.map(l=>{var h,i,M;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center text-slate-500 font-mono",children:l.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700 dark:text-slate-200",children:l.name}),e.jsx("td",{className:"p-4 text-center",children:F?e.jsx("div",{className:"h-8 w-24 bg-slate-100 dark:bg-slate-800 rounded animate-pulse mx-auto"}):p==="DAILY"?e.jsxs("button",{onClick:()=>U(l.id),className:`w-32 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${w[l.id]==="PRESENT"?"bg-green-100 text-green-700 border border-green-200":w[l.id]==="ABSENT"?"bg-red-100 text-red-700 border border-red-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[w[l.id]==="PRESENT"&&e.jsx(pe,{className:"w-4 h-4"}),w[l.id]==="ABSENT"&&e.jsx(ze,{className:"w-4 h-4"}),w[l.id]==="LATE"&&e.jsx(at,{className:"w-4 h-4"}),w[l.id]||"PRESENT"]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",className:"w-16 p-2 text-center font-bold bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none",value:((h=w[l.id])==null?void 0:h.present)||0,onChange:L=>P(l.id,L.target.value)})}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["/ ",y]}),e.jsxs("span",{className:`text-xs font-bold ml-2 ${((i=w[l.id])==null?void 0:i.present)/y<.75?"text-red-500":"text-green-500"}`,children:[y>0?Math.round(((M=w[l.id])==null?void 0:M.present)/y*100):0,"%"]})]})})]},l.id)})})]})})]})},At=({user:o})=>{const S=_e(),[p,u]=t.useState("students"),[r,T]=t.useState([]),[E,d]=t.useState([]),[w,j]=t.useState({}),[F,x]=t.useState(!1),[f,B]=t.useState(o.subjects),[y,G]=t.useState(o.submissionStatus==="SUBMITTED"),[$,U]=t.useState(!1),[P,c]=t.useState({name:o.teacherName||"",photo:o.teacherPhoto||""}),[m,l]=t.useState(!1),[h,i]=t.useState(null),[M,L]=t.useState(!1),[ce,_]=t.useState(""),[se,k]=t.useState([]),[Y,X]=t.useState([]),[K,be]=t.useState(!1);t.useEffect(()=>{Q(),ee()},[]);const Q=async()=>{x(!0);const s=await N.getSchoolConfig();i(s),U((s==null?void 0:s.allowTeacherSubjectEdit)??!1);const b=(s==null?void 0:s.feeManagerRole)||"ADMIN",D=(await N.getFeeStructures(o.id)).filter(C=>C.collectedBy==="TEACHER"||C.collectedBy==="BOTH"||b==="TEACHER"||b==="HYBRID");X(D),be(D.length>0);const I=await N.getStudentsByClass(o.id);T(I);const n={};for(const C of I){const O=await N.getMarks(C.id,"Term 1");O?n[C.id]=O:n[C.id]={studentId:C.id,subjects:f.reduce((W,q)=>({...W,[q.name]:0}),{}),total:0,grade:"F",term:"Term 1"}}j(n);const R=await N.getPendingAdmissions(o.id);d(R),R.length>0&&((s==null?void 0:s.admissionApprover)==="TEACHER"||(s==null?void 0:s.admissionApprover)==="BOTH"||!(s!=null&&s.admissionApprover))&&u("students"),x(!1)},ee=async()=>{const s=await N.getAssessmentPrograms("TEACHER",o.id);k(s)},ae=(s,b,g)=>{if(y)return;let D="";if(g!==""){const I=g.toUpperCase(),n=parseInt(g);if(isNaN(n)&&I!=="A"&&I!=="AB")return;I==="A"||I==="AB"?D=I:D=n}j(I=>{const n={...I[s]};n.subjects={...n.subjects,[b]:D};const R=Object.values(n.subjects).reduce((J,te)=>J+(typeof te=="number"?te:0),0);n.total=R;let C=0,O=!1;Object.keys(n.subjects).forEach(J=>{const te=f.find(Z=>Z.name===J);if(te){C+=te.maxMarks;const Z=n.subjects[J];(typeof Z=="number"?Z:0)<te.passMarks&&(O=!0)}});const{grade:W,resultStatus:q}=We(R,C,O);return n.grade=W,n.resultStatus=q,{...I,[s]:n}})},z=async()=>{x(!0);for(const s of Object.values(w))await N.saveMarks(s);x(!1),alert("All marks saved successfully!")},ge=async()=>{if(y){const b=prompt("Request Admin to unlock this class? (Optional: Enter reason)");b!==null&&((await N.createSystemFeedback(`Unlock Request for Class ${o.name}. Reason: ${b}`,"SUPPORT",o.teacherName||"Teacher")).success?alert("Unlock Request Sent to Admin!"):alert("Failed to send request."));return}if(!window.confirm("Verify & Submit to Admin?"))return;(await N.toggleClassSubmission(o.id,!0)).success&&(G(!0),alert("Submitted Successfully!"))},xe=async(s,b)=>{if(b==="APPROVE"){const g=await N.verifyStudent(s,o.teacherName||"Teacher");g.success?(Q(),d(D=>D.filter(I=>I.id!==s))):alert(g.message)}else{if(!window.confirm("Reject this admission?"))return;(await N.rejectAdmission(s)).success&&d(D=>D.filter(I=>I.id!==s))}},fe=async(s,b)=>{if(!window.confirm(`Delete ${b}?`))return;const g=await N.deleteStudent(s);g.success?Q():alert("Failed: "+g.message)},le=async()=>{if(!window.confirm("Warning: This will delete all Unverified (Ghost) students in your class. Continue?"))return;(await N.deleteUnverifiedStudents(o.id)).success?(alert("Cleaned successfully!"),Q()):alert("Failed to clean.")},me=async(s,b,g)=>{const D=[...f,{name:s,maxMarks:b,passMarks:g}];return(await N.updateClassSubjects(o.id,D)).success?(B(D),Q(),!0):(alert("Failed to add subject"),!1)},re=async s=>{if(!window.confirm("Delete this subject? Existing marks will be hidden."))return;const b=[...f];b.splice(s,1),(await N.updateClassSubjects(o.id,b)).success&&(B(b),Q())},he=async(s,b,g)=>{const D=o.teacherName||o.name||"Teacher",I=g?new Date(g).toISOString():void 0,n=await N.createCampusPost(o.schoolId||"",D,b,"TEACHER","NOTICE",s,I);return n.success?!0:(alert("Failed: "+n.message),!1)},ne=async()=>{(await N.updateClassDetails(o.id,{teacherName:P.name,teacherPhoto:P.photo})).success?l(!1):alert("Failed update")},oe=async s=>{if(!s.target.files||s.target.files.length===0)return;if(!o.isPro){alert("Photo upload is an Elite/Pro feature.");return}const b=s.target.files[0],g=await N.uploadImage(b,"teachers");g.success&&g.publicUrl?c(D=>({...D,photo:g.publicUrl})):alert("Upload failed: "+g.message)},a={total:r.length,male:r.filter(s=>s.gender==="Male").length,female:r.filter(s=>s.gender==="Female").length},v=()=>{if(p==="students")return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-1 bg-blue-50 dark:bg-blue-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[a.male," B"]})}),e.jsx("div",{className:"flex items-center gap-1 bg-pink-50 dark:bg-pink-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-pink-700 dark:text-pink-300",children:[a.female," G"]})})]});if(p==="marks"){const s=Object.values(w).filter(b=>b.total>0).length;return e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-700 px-3 py-1 rounded text-xs",children:[e.jsx("span",{className:"text-slate-500 font-bold uppercase",children:"Progress:"}),e.jsxs("span",{className:`font-bold ${s===a.total?"text-green-600":"text-slate-800"}`,children:[s," / ",a.total]})]})}return null};return e.jsxs("div",{className:"pb-20 relative animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-3 mb-4 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs("div",{className:"relative group shrink-0",children:[P.photo?e.jsx("img",{src:P.photo,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900 rounded-lg flex items-center justify-center text-blue-600 dark:text-blue-300",children:e.jsx(st,{className:"w-6 h-6"})}),m&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:oe}),e.jsx(Te,{className:"w-4 h-4 text-white"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-black text-blue-600 dark:text-blue-400",children:o.name}),m?e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{className:"bg-slate-50 border rounded px-1 text-xs",value:P.name,onChange:s=>c({...P,name:s.target.value})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:ne,className:"text-[10px] bg-green-100 text-green-700 px-2 rounded",children:"Save"}),e.jsx("button",{onClick:()=>L(!0),className:"text-[10px] bg-yellow-100 text-yellow-700 px-2 rounded",children:"Pass"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500",children:P.name||"Class Teacher"}),e.jsx("button",{onClick:()=>l(!0),className:"text-slate-400",children:e.jsx(lt,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S(`/school/${o.schoolId}`),className:"p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600",title:"Visit School Home",children:e.jsx(Qe,{className:"w-4 h-4"})}),v()]})]}),e.jsx("div",{className:"flex justify-between items-center mb-6 overflow-x-auto pb-2",children:e.jsx("div",{className:"flex bg-slate-200 dark:bg-slate-700 p-1 rounded-lg max-w-full",children:["students","subjects","marks","attendance","exams","assessments","reports","fees"].filter(s=>s!=="fees"||K).map(s=>e.jsx("button",{onClick:()=>u(s),className:`px-4 py-2 rounded-md text-sm font-bold capitalize whitespace-nowrap ${p===s?"bg-white dark:bg-slate-800 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:s},s))})}),e.jsxs("div",{className:"mt-4",children:[p==="students"&&e.jsx(xt,{user:o,students:r,pendingAdmissions:E,stats:a,sortingMethod:h==null?void 0:h.sortingMethod,onRefresh:Q,onDeleteStudent:fe,onAdmissionAction:xe,onCleanJunk:le}),p==="subjects"&&e.jsx(ut,{subjects:f,onAddSubject:me,onDeleteSubject:re,canEdit:$}),p==="marks"&&e.jsx(mt,{students:r,marks:w,subjects:f,isSubmitted:y,loading:F,onMarkChange:ae,onSaveAll:z,onSubmitResults:ge}),p==="attendance"&&e.jsx(pt,{students:r,classId:o.id}),p==="exams"&&e.jsx(ct,{classId:o.id}),p==="reports"&&e.jsx(ht,{onPostNotice:he}),p==="assessments"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Assessments Module coming soon."}),p==="fees"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Fees Module coming soon."})]})]})};export{At as default};
