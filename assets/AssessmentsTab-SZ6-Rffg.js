import{r as p,j as e,e as x,a6 as K,G as w,d as b,h as D,n as W,p as G,q as J,i as j}from"./index-DTK6V_wT.js";import{C as S}from"./clipboard-list-CV1jrgm_.js";import{T as E}from"./trash-2-W_nNfUXu.js";import{P as I}from"./plus-DWqlxpEn.js";import{P as Q}from"./pen-square-CF8oQgHZ.js";import{T as U}from"./target-VdTmM5ap.js";import{T as _,a as X,S as Z,M as ee}from"./thumbs-up-C71m0Oa0.js";import{F as se}from"./frown-Cgh2Vrdq.js";const oe=({assessments:C,classes:m,onRefresh:y,featureCosts:i})=>{const[q,h]=p.useState(!1),[k,f]=p.useState(!1),[P,N]=p.useState(!1),[o,g]=p.useState(null),[l,d]=p.useState({name:"",type:"STAR",frequency:"WEEKLY",assignee:"TEACHER",targetClassIds:[],questions:[{id:"q1",text:"Homework",maxVal:5}],sessionCount:1,schedules:[{name:"Term 1",startDate:new Date().toISOString().split("T")[0],endDate:"",startTime:"09:00",endTime:"16:00"}]}),R=s=>{d(t=>{const a=t.targetClassIds.includes(s);let r;return a?r=t.targetClassIds.filter(n=>n!==s):r=[...t.targetClassIds,s],{...t,targetClassIds:r}})},O=()=>{d(s=>s.targetClassIds.length===m.length?{...s,targetClassIds:[]}:{...s,targetClassIds:m.map(t=>t.id)})},H=()=>{d(s=>({...s,questions:[...s.questions,{id:`q${Date.now()}`,text:"",maxVal:s.type==="STAR"?5:s.type==="EMOJI"?3:10,assignee:"TEACHER"}]}))},v=(s,t,a)=>{const r=[...l.questions];r[s]={...r[s],[t]:a},d(n=>({...n,questions:r}))},M=s=>{const t=[...l.questions];t.splice(s,1),d(a=>({...a,questions:t}))},A=(s,t,a)=>{d(r=>{const n=[...r.schedules];return n[s]={...n[s],[t]:a},{...r,schedules:n}})},$=()=>{if(!l.name)return alert("Please enter a program name");if(l.questions.some(t=>!t.text))return alert("Please fill all questions");if(l.schedules.some(t=>!t.startDate||!t.endDate))return alert("Please fill start and end dates for all sessions.");N(!0)},L=async()=>{var r,n;f(!0);const s=(i==null?void 0:i.assessments)||0;if(!o&&s>0){const c=await j.useFeatureWithTrial("create_assessment",s,0,`Create Assessment: ${l.name}`);if(!c.success){f(!1),alert(c.message||"Insufficient Credits to create assessment.");return}}const t={...l,targetClassIds:l.targetClassIds.length===0?m.map(c=>c.id):l.targetClassIds,startDate:(r=l.schedules[0])==null?void 0:r.startDate,endDate:(n=l.schedules[l.schedules.length-1])==null?void 0:n.endDate};let a;o?a=await j.updateAssessmentProgram(o,t):a=await j.createAssessmentProgram(t),f(!1),N(!1),a.success?(h(!1),g(null),y(),d({name:"",type:"STAR",frequency:"WEEKLY",assignee:"TEACHER",targetClassIds:[],questions:[{id:"q1",text:"Homework",maxVal:5}],sessionCount:1,schedules:[{name:"Term 1",startDate:new Date().toISOString().split("T")[0],endDate:"",startTime:"09:00",endTime:"16:00"}]}),!o&&s>0&&alert(`Assessment Created! ${s} Credits Deducted.`)):alert("Failed: "+(typeof a.message=="string"?a.message:JSON.stringify(a.message)))},Y=s=>{var t,a;g(s.id),d({name:s.name,type:s.type,frequency:s.frequency,assignee:s.assignee,targetClassIds:s.targetClassIds||[],questions:s.questions,sessionCount:((t=s.schedules)==null?void 0:t.length)||1,schedules:(a=s.schedules)!=null&&a.length?s.schedules:[{name:"Term 1",startDate:s.startDate||"",endDate:s.endDate||""}]}),h(!0)},F=async s=>{if(!window.confirm("Unpublish this assessment? Data will be deleted."))return;(await j.deleteAssessmentProgram(s)).success?y():alert("Failed to delete.")},V=s=>{if(s.schedules&&s.schedules.length>0){const t=new Date,a=s.schedules.find(n=>{const c=new Date(n.startDate),u=new Date(n.endDate);return u.setHours(23,59,59),t>=c&&t<=u});if(a)return{label:`ACTIVE: ${a.name}`,color:"text-green-600 bg-green-100",active:!0};const r=s.schedules.find(n=>new Date(n.startDate)>t);return r?{label:`STARTS IN ${Math.ceil((new Date(r.startDate).getTime()-t.getTime())/864e5)} DAYS`,color:"text-yellow-600 bg-yellow-100",active:!1}:{label:"ENDED",color:"text-slate-500 bg-slate-100",active:!1}}return{label:"ACTIVE",color:"text-green-600 bg-green-100",active:!0}},z=s=>{switch(s){case"STAR":return e.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((t,a)=>e.jsx(J,{size:14,className:a<3?"fill-yellow-400 text-yellow-400":"text-slate-200"},a))});case"EMOJI":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{size:20,className:"text-green-500"}),e.jsx(ee,{size:20,className:"text-slate-300"}),e.jsx(se,{size:20,className:"text-slate-300"})]});case"YESNO":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"bg-green-500 text-white p-1 rounded-md shadow-sm",children:e.jsx(_,{size:12})}),e.jsx("div",{className:"bg-slate-100 text-slate-400 p-1 rounded-md",children:e.jsx(X,{size:12})})]});case"MARK":return e.jsx("div",{className:"border border-slate-300 rounded px-2 py-1 text-xs font-bold w-12 text-center text-slate-700 bg-white",children:"45"});default:return null}};return e.jsxs("div",{className:"animate-fade-in-up",children:[q?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(x,{variant:"secondary",onClick:()=>{h(!1),g(null)},className:"mb-6 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," Back to List"]}),e.jsxs(w,{className:"mb-6 border-t-4 border-t-purple-600",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(S,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:o?"Edit Assessment":"New Assessment"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Configure program details"})]}),!o&&((i==null?void 0:i.assessments)||0)>0&&e.jsxs("div",{className:"ml-auto bg-yellow-100 text-yellow-700 text-xs font-bold px-3 py-1 rounded-full border border-yellow-200",children:["Cost: ",i==null?void 0:i.assessments," Credits"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Program Name"}),e.jsx(b,{placeholder:"e.g. Daily Hygiene Check",value:l.name,onChange:s=>d({...l,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Evaluation Type"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["STAR","EMOJI","YESNO","MARK"].map(s=>e.jsxs("div",{onClick:()=>d({...l,type:s}),className:`cursor-pointer p-3 rounded-xl border-2 flex flex-col items-center justify-center gap-2 transition-all ${l.type===s?"border-purple-600 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-slate-200 dark:border-slate-700 hover:border-purple-300"}`,children:[z(s),e.jsx("span",{className:"text-[10px] font-bold",children:s})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Frequency"}),e.jsxs(D,{value:l.frequency,onChange:s=>d({...l,frequency:s.target.value}),children:[e.jsx("option",{value:"DAILY",children:"Daily"}),e.jsx("option",{value:"WEEKLY",children:"Weekly"}),e.jsx("option",{value:"BIWEEKLY",children:"Bi-Weekly"}),e.jsx("option",{value:"MONTHLY",children:"Monthly"}),e.jsx("option",{value:"ONETIME",children:"One Time"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Assignee"}),e.jsxs(D,{value:l.assignee,onChange:s=>d({...l,assignee:s.target.value}),children:[e.jsx("option",{value:"TEACHER",children:"Teacher Only"}),e.jsx("option",{value:"PARENT",children:"Parent Only"}),e.jsx("option",{value:"BOTH",children:"Both"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Target Classes"}),e.jsx("button",{onClick:O,className:"text-[10px] font-bold text-blue-600 hover:underline",children:l.targetClassIds.length===m.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-2 border border-slate-100 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-800/50",children:m.map(s=>e.jsx("button",{onClick:()=>R(s.id),className:`text-[10px] font-bold px-2 py-1 rounded-md transition-all ${l.targetClassIds.includes(s.id)?"bg-purple-600 text-white shadow-md":"bg-white dark:bg-slate-700 text-slate-500 border border-slate-200 dark:border-slate-600"}`,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Assessment Criteria"}),e.jsxs("div",{className:"space-y-2",children:[l.questions.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-center bg-slate-50 dark:bg-slate-800/50 p-2 rounded-lg border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"bg-slate-200 dark:bg-slate-700 w-6 h-6 flex items-center justify-center rounded text-xs font-bold text-slate-500 shrink-0",children:t+1}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(b,{className:"h-8 text-sm",placeholder:"Question / Criteria",value:s.text,onChange:a=>v(t,"text",a.target.value)}),l.assignee==="BOTH"&&e.jsxs("select",{className:"text-[10px] bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded px-1 py-0.5 w-full",value:s.assignee||"TEACHER",onChange:a=>v(t,"assignee",a.target.value),children:[e.jsx("option",{value:"TEACHER",children:"For Teacher"}),e.jsx("option",{value:"PARENT",children:"For Parent"})]})]}),l.type==="MARK"&&e.jsx(b,{type:"number",className:"w-16 text-center h-8 text-sm",placeholder:"Max",value:s.maxVal,onChange:a=>v(t,"maxVal",parseInt(a.target.value))}),e.jsx("button",{onClick:()=>M(t),className:"p-1.5 text-red-400 hover:bg-red-50 rounded",children:e.jsx(E,{className:"w-4 h-4"})})]},t)),e.jsxs("button",{onClick:H,className:"text-xs font-bold text-blue-600 flex items-center gap-1 hover:bg-blue-50 px-3 py-2 rounded",children:[e.jsx(I,{className:"w-3 h-3"})," Add Criteria"]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Visual Schedule"}),l.schedules.map((s,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(b,{type:"date",value:s.startDate,onChange:a=>A(t,"startDate",a.target.value)}),e.jsx("span",{className:"self-center text-slate-400",children:"to"}),e.jsx(b,{type:"date",value:s.endDate,onChange:a=>A(t,"endDate",a.target.value)})]},t))]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3",children:[e.jsx(x,{variant:"secondary",onClick:()=>{h(!1),g(null)},children:"Cancel"}),e.jsx(x,{onClick:$,className:"bg-purple-600 hover:bg-purple-700 w-40",children:o?"Update Program":"Review & Create"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:"Assessment Programs"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Manage behavioral and skill-based assessments."})]}),e.jsxs(x,{onClick:()=>h(!0),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700",children:[e.jsx(I,{className:"w-4 h-4"})," Create New"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[C.map(s=>{var a,r,n,c;const t=V(s);return e.jsxs(w,{className:"relative group border-l-4 border-l-purple-500 hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:`text-[10px] font-black px-2 py-1 rounded uppercase ${t.color}`,children:t.label}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Y(s),className:"p-1.5 text-slate-400 hover:text-blue-500",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(s.id),className:"p-1.5 text-slate-400 hover:text-red-500",children:e.jsx(E,{className:"w-4 h-4"})})]})]}),e.jsx("h4",{className:"font-bold text-lg text-slate-800 dark:text-white mb-1",children:s.name}),e.jsxs("div",{className:"my-3 flex items-center gap-1 bg-slate-50 dark:bg-slate-900 p-1.5 rounded-lg border border-slate-100 dark:border-slate-800 overflow-x-auto no-scrollbar",children:[e.jsx(W,{className:"w-3 h-3 text-slate-400 shrink-0"}),(a=s.schedules)==null?void 0:a.map((u,T)=>{const B=new Date>=new Date(u.startDate)&&new Date<=new Date(u.endDate||"2099-01-01");return e.jsx("div",{className:`flex-shrink-0 text-[9px] font-bold px-2 py-0.5 rounded border ${B?"bg-purple-100 text-purple-700 border-purple-200":"bg-white dark:bg-slate-800 text-slate-500 border-slate-200 dark:border-slate-700"}`,children:u.name||`Session ${T+1}`},T)}),!((r=s.schedules)!=null&&r.length)&&e.jsx("span",{className:"text-[10px] text-slate-400",children:"Continuous"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"})," ",s.frequency]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"})," ",s.questions.length," Criteria"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex-1 text-center border-r border-slate-100 dark:border-slate-700",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Type"}),e.jsx("p",{className:"text-sm font-bold text-purple-600",children:s.type})]}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Target"}),e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:(((n=s.targetClassIds)==null?void 0:n.length)||0)===m.length?"All Classes":`${(c=s.targetClassIds)==null?void 0:c.length} Classes`})]})]})]},s.id)}),C.length===0&&e.jsxs("div",{className:"col-span-full py-12 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-50 dark:bg-purple-900/20 rounded-full flex items-center justify-center mx-auto mb-4 text-purple-400",children:e.jsx(S,{className:"w-8 h-8"})}),e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-300",children:"No Assessments Yet"}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:'Create programs like "Daily Hygiene", "Reading Log", or "Prayer Tracker".'}),e.jsx(x,{onClick:()=>h(!0),variant:"secondary",children:"Create First Program"})]})]})]}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:e.jsxs(w,{className:"max-w-md w-full",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:o?"Update Assessment":"Confirm Assessment"}),e.jsxs("div",{className:"space-y-2 mb-6 text-sm text-slate-600 dark:text-slate-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",l.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",l.type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Schedules:"})," ",l.sessionCount," Sessions"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-slate-50 dark:bg-slate-900 p-2 rounded",children:l.schedules.map((s,t)=>e.jsxs("p",{className:"text-xs",children:[s.name||`Session ${t+1}`,": ",s.startDate," to ",s.endDate]},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:L,disabled:k,className:"flex-1",children:k?"Saving...":"Confirm & Save"}),e.jsx(x,{variant:"secondary",onClick:()=>N(!1),className:"flex-1",children:"Cancel"})]})]})})]})};export{oe as default};
