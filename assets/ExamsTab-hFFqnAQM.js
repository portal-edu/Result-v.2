import{c as oe,r as n,i as v,j as e,e as R,G as W,d as C,h as Ne,J as ve,Y as ie,Z as ye,t as Se,F as Ce,aA as ke,aB as k,m as Te,q as Ie}from"./index-DETpqC_j.js";import{T as Ee}from"./trash-2-BpDurroK.js";import{P as Ae}from"./plus-B0pu8I4w.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=oe("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=oe("ScanSearch",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]]),De=({targetDate:h})=>{const[b,j]=n.useState("");return n.useEffect(()=>{const c=setInterval(()=>{const l=new Date().getTime(),p=new Date(h).getTime()-l;if(p<0){j("LIVE NOW"),clearInterval(c);return}const t=Math.floor(p/(1e3*60*60*24)),f=Math.floor(p%(1e3*60*60*24)/(1e3*60*60)),y=Math.floor(p%(1e3*60*60)/(1e3*60)),L=Math.floor(p%(1e3*60)/1e3);t>0?j(`${t}d ${f}h left`):j(`${f}h ${y}m ${L}s`)},1e3);return()=>clearInterval(c)},[h]),e.jsxs("span",{className:`text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1 ${b==="LIVE NOW"?"bg-green-100 text-green-700 animate-pulse":"bg-blue-50 text-blue-600 border border-blue-100"}`,children:[e.jsx(Ie,{className:"w-3 h-3"})," ",b||"Calculating..."]})},Ge=({imageSrc:h,onCrop:b,onCancel:j})=>{const c=n.useRef(null),l=n.useRef(null),[O,p]=n.useState(!1),[t,f]=n.useState(null),[y,L]=n.useState({x:0,y:0}),[P,Y]=n.useState(!0),z=a=>{var g;const o=(g=l.current)==null?void 0:g.getBoundingClientRect();if(!o)return{x:0,y:0};const x=a.touches?a.touches[0].clientX:a.clientX,m=a.touches?a.touches[0].clientY:a.clientY;return{x:x-o.left,y:m-o.top}},H=a=>{const o=z(a);L(o),f({x:o.x,y:o.y,w:0,h:0}),p(!0)},$=a=>{if(!O)return;const o=z(a);f({x:Math.min(y.x,o.x),y:Math.min(y.y,o.y),w:Math.abs(o.x-y.x),h:Math.abs(o.y-y.y)})},F=()=>p(!1);n.useEffect(()=>{h&&Y(!0)},[h]);const V=()=>{if(l.current&&c.current){const a=c.current.naturalWidth/c.current.naturalHeight;let o=Math.min(window.innerWidth*.9,600),x=o/a;l.current.width=o,l.current.height=x,f(null);const m=l.current.getContext("2d");m&&(m.drawImage(c.current,0,0,o,x),m.fillStyle="rgba(0, 0, 0, 0.3)",m.fillRect(0,0,o,x)),setTimeout(()=>Y(!1),600)}};n.useEffect(()=>{if(!l.current||!c.current||P)return;const a=l.current.getContext("2d");a&&(a.clearRect(0,0,l.current.width,l.current.height),a.drawImage(c.current,0,0,l.current.width,l.current.height),a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(0,0,l.current.width,l.current.height),t&&t.w>0?(a.clearRect(t.x,t.y,t.w,t.h),a.drawImage(c.current,0,0,c.current.width,c.current.height,0,0,l.current.width,l.current.height),a.fillStyle="rgba(0, 0, 0, 0.7)",a.fillRect(0,0,l.current.width,t.y),a.fillRect(0,t.y+t.h,l.current.width,l.current.height-(t.y+t.h)),a.fillRect(0,t.y,t.x,t.h),a.fillRect(t.x+t.w,t.y,l.current.width-(t.x+t.w),t.h),a.strokeStyle="#00ff00",a.lineWidth=2,a.setLineDash([6]),a.strokeRect(t.x,t.y,t.w,t.h)):(a.font="bold 14px sans-serif",a.fillStyle="white",a.textAlign="center",a.fillText("Drag to select text",l.current.width/2,l.current.height/2)))},[t,P]);const w=()=>{if(!t||!c.current||t.w<10){if(c.current&&l.current){c.current.naturalWidth/l.current.width,c.current.naturalHeight/l.current.height,f({x:0,y:0,w:l.current.width,h:l.current.height}),setTimeout(()=>w(),100);return}return}const a=l.current,o=c.current;if(!a)return;const x=o.naturalWidth/a.width,m=o.naturalHeight/a.height,g=document.createElement("canvas");g.width=t.w*x,g.height=t.h*m;const T=g.getContext("2d");T==null||T.drawImage(o,t.x*x,t.y*m,t.w*x,t.h*m,0,0,g.width,g.height),g.toBlob(Q=>{Q&&b(Q)},"image/jpeg")};return e.jsxs("div",{className:"fixed inset-0 z-[70] bg-black/95 flex flex-col items-center justify-center p-4 backdrop-blur-sm",children:[P?e.jsxs("div",{className:"flex flex-col items-center animate-fade-in-up",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Me,{className:"w-16 h-16 text-green-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-green-500/20 blur-xl rounded-full animate-ping"})]}),e.jsx("h3",{className:"text-white font-bold text-lg tracking-widest",children:"SCANNING PAGE..."}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Analyzing text structure"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800 px-6 py-2 rounded-full mb-4 flex items-center gap-2 shadow-lg border border-slate-700 animate-fade-in-up",children:[e.jsx(Re,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-white text-sm font-bold",children:"Select the area to read"})]}),e.jsx("div",{className:"relative max-h-[70vh] overflow-hidden border-2 border-slate-700 rounded-lg bg-black shadow-2xl",children:e.jsx("canvas",{ref:l,onMouseDown:H,onMouseMove:$,onMouseUp:F,onTouchStart:H,onTouchMove:$,onTouchEnd:F,className:"cursor-crosshair block touch-none"})}),e.jsxs("div",{className:"flex gap-4 mt-6 w-full max-w-sm",children:[e.jsx(R,{variant:"secondary",onClick:j,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-800",children:"Discard"}),e.jsxs(R,{onClick:w,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-900/20",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"})," ",t&&t.w>10?"Crop Selection":"Use Full Page"]})]})]}),e.jsx("img",{ref:c,src:h,className:"hidden",onLoad:V})]})},He=({classId:h,featureCosts:b={ai:5},aiTrialLimit:j=2})=>{const[c,l]=n.useState([]),[O,p]=n.useState(!1),[t,f]=n.useState(!1),[y,L]=n.useState(null),[P,Y]=n.useState([]),[z,H]=n.useState(!1),[$,F]=n.useState([]),[V,w]=n.useState(!1),[a,o]=n.useState(!1),[x,m]=n.useState("SCAN"),[g,T]=n.useState(""),[Q,Oe]=n.useState(5),[ee,Le]=n.useState("From Book Only"),[ce,Pe]=n.useState("Malayalam"),[U,te]=n.useState([]),[se,X]=n.useState(!1),[ae,J]=n.useState(null),[$e,Fe]=n.useState([]),[M,ne]=n.useState(""),[Z,le]=n.useState(""),[de,Qe]=n.useState("CLASS_TEST"),[ue,Ue]=n.useState(""),[D,xe]=n.useState(""),[_,he]=n.useState(""),[q,me]=n.useState(30),[ge,Be]=n.useState({shuffleQuestions:!1,showResultImmediately:!0}),[N,S]=n.useState([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}]);n.useEffect(()=>{re(),h&&v.getClassBasicInfo(h).then(async r=>{const i=(await v.getClasses()).find(d=>d.id===h);i&&F(i.subjects||[])})},[h]);const pe=r=>{if(r.target.files&&r.target.files.length>0){const s=new FileReader;s.onload=i=>{var d;(d=i.target)!=null&&d.result&&(J(i.target.result),w(!1))},s.readAsDataURL(r.target.files[0])}},fe=async()=>{if(x==="TOPIC"&&!g)return alert("Please enter a topic.");if(x==="SCAN"&&U.length===0)return alert("Please upload at least one page.");X(!0);const r=b.ai!==void 0?b.ai:5,s=await v.useFeatureWithTrial("ai_gen",r,j,"AI Question Generation",void 0,"TEACHER");if(!s.success){X(!1),alert("Request Denied: "+s.message);return}const i=s.transactionId;try{const d=new ke({apiKey:void 0}),u="gemini-2.5-flash",I=Q+3,E=[];let G=`Generate ${I} multiple choice questions. Language: ${ce}. Provide JSON output with 'text', 'options' (array of 4 strings), 'correctOptionIndex' (0-3 number), and 'marks' (default 1).`;ee==="From Book Only"?G+=" STRICT INSTRUCTION: Generate questions ONLY using the text content found in the provided images.":G+=` The questions should be appropriate for ${ee} level students.`,x==="SCAN"?(U.forEach(B=>{E.push({inlineData:{mimeType:"image/jpeg",data:B.split(",")[1]}})}),G+=" Analyze the images thoroughly. Focus on key facts."):G+=` The topic is: "${g}".`,E.push({text:G});const we=await d.models.generateContent({model:u,contents:{parts:E},config:{responseMimeType:"application/json",responseSchema:{type:k.ARRAY,items:{type:k.OBJECT,properties:{text:{type:k.STRING},options:{type:k.ARRAY,items:{type:k.STRING}},correctOptionIndex:{type:k.INTEGER},marks:{type:k.INTEGER}}}}}}),K=JSON.parse(we.text||"[]");if(Array.isArray(K)&&K.length>0){const B=K.map(A=>({id:Math.random().toString(36).substr(2,9),text:A.text,options:A.options,correctOptionIndex:A.correctOptionIndex,marks:A.marks||1}));S(A=>[...A,...B]),w(!1),te([]),T("");const je=s.isTrial?` (Free Trial Used - ${s.remaining} left)`:` (${r} Credits Deducted)`;alert(`${B.length} AI Questions Added!${je}`)}else throw new Error("Invalid AI Response (Empty)")}catch{i?(await v.refundCredits(i,"AI Generation Failed"),alert("AI Generation failed. Credits have been refunded.")):alert("AI Failed. No credits deducted (Trial mode).")}finally{X(!1)}},re=async()=>{const r=await v.getExamsForClass(h);l(r)},be=async()=>{if(!M||!D||!_)return alert("Please fill all details");f(!0);const r=await v.createExam({classId:h,title:M,subject:Z,examType:de,description:ue,startTime:new Date(D).toISOString(),endTime:new Date(_).toISOString(),durationMinutes:q,questions:N,settings:ge});if(f(!1),r.success){try{const s=new Date(D).toLocaleDateString(),i=new Date(D).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=`New Exam Scheduled: ${M} (${Z||"General"}) on ${s} at ${i}. Duration: ${q} mins.`,u=await v.getSchoolConfig();u&&u.id&&await v.createCampusPost(u.id,"Exam Controller",d,"TEACHER","NOTICE",`Exam Alert: ${M}`)}catch(s){console.error("Failed to send auto-notification",s)}p(!1),re(),ne(""),le(""),S([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}]),alert("Exam Scheduled & Students Notified!")}else alert(r.message)};if(O){const r=b.ai!==void 0?b.ai:5;return e.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create Exam"}),e.jsx(R,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"})]}),e.jsxs(W,{className:"mb-6 border-t-4 border-t-blue-600",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block uppercase",children:"Exam Title"}),e.jsx(C,{placeholder:"e.g. Unit Test 1",value:M,onChange:s=>ne(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block uppercase",children:"Subject"}),e.jsxs(Ne,{value:Z,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"",children:"-- General / All --"}),$.map((s,i)=>e.jsx("option",{value:s.name,children:s.name},i))]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Start Time"}),e.jsx(C,{type:"datetime-local",value:D,onChange:s=>xe(s.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"End Time"}),e.jsx(C,{type:"datetime-local",value:_,onChange:s=>he(s.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Duration (Mins)"}),e.jsx(C,{type:"number",value:q,onChange:s=>me(parseInt(s.target.value))})]})]}),e.jsxs("p",{className:"text-[10px] text-orange-500 mt-2 flex items-center gap-1 font-bold",children:[e.jsx(ve,{className:"w-3 h-3"})," Warning: V9 System prevents scheduling two exams at the same time."]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-slate-300",children:["Questions (",N.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>w(!0),className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition-transform",children:[e.jsx(ie,{className:"w-4 h-4 text-yellow-300"})," AI Generator ",e.jsx("span",{className:"bg-white/20 px-1 rounded text-[9px]",children:"Try Free"})]})})]}),e.jsx("div",{className:"space-y-4 mb-6",children:N.map((s,i)=>e.jsxs(W,{className:"relative",children:[e.jsx("button",{onClick:()=>{const d=[...N];d.splice(i,1),S(d)},className:"absolute top-2 right-2 text-slate-300 hover:text-red-500",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-1 block",children:["Question ",i+1]}),e.jsx(C,{className:"mb-3 font-bold",value:s.text,onChange:d=>{const u=[...N];u[i].text=d.target.value,S(u)},placeholder:"Question Text"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.options.map((d,u)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"radio",name:`q-${s.id}`,checked:s.correctOptionIndex===u,onChange:()=>{const I=[...N];I[i].correctOptionIndex=u,S(I)},className:"w-4 h-4 accent-green-600 cursor-pointer"}),e.jsx(C,{className:"text-sm h-9",value:d,onChange:I=>{const E=[...N];E[i].options[u]=I.target.value,S(E)},placeholder:`Option ${u+1}`})]},u))})]},s.id))}),e.jsxs("div",{className:"flex gap-4 sticky bottom-4 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur p-2 rounded-2xl border shadow-xl",children:[e.jsx("button",{onClick:()=>S([...N,{id:Date.now().toString(),text:"",options:["","","",""],correctOptionIndex:0,marks:1}]),className:"flex-1 py-3 border-2 border-dashed rounded-xl font-bold text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:"Add Question"}),e.jsx(R,{onClick:be,disabled:t,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/30",children:t?"Processing...":"Review & Schedule"})]}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4",children:e.jsxs(W,{className:"max-w-md w-full",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-purple-500"})," AI Question Generator"]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg border border-purple-200 dark:border-purple-800 mb-4 flex items-center gap-3",children:[e.jsx(ye,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-purple-800 dark:text-purple-200",children:"Try Before You Pay"}),e.jsxs("p",{className:"text-[10px] text-purple-700 dark:text-purple-300",children:["First ",j," generations are FREE. Then ",r," Credits/use."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>m("SCAN"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${x==="SCAN"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Scan Page"}),e.jsx("button",{onClick:()=>m("TOPIC"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${x==="TOPIC"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Topic"})]}),x==="TOPIC"&&e.jsx(C,{placeholder:"Enter Topic (e.g. Photosynthesis)",value:g,onChange:s=>T(s.target.value)}),x==="SCAN"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block p-4 border-2 border-dashed rounded-xl text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors",children:[e.jsx(Se,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),e.jsx("span",{className:"text-xs text-slate-500 font-bold block",children:"Take Photo / Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:pe})]}),U.length>0&&e.jsxs("p",{className:"text-center text-xs text-green-500 font-bold",children:[U.length," images scanned"]})]}),e.jsx(R,{onClick:fe,disabled:se,className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-xl",children:se?"Processing...":"Generate Now"}),e.jsx("button",{onClick:()=>w(!1),className:"w-full text-xs text-slate-500 mt-2 hover:text-slate-700",children:"Cancel"})]})]})}),ae&&e.jsx(Ge,{imageSrc:ae,onCancel:()=>{J(null),w(!0)},onCrop:s=>{const i=new FileReader;i.readAsDataURL(s),i.onloadend=()=>{i.result&&(te(d=>[...d,i.result]),J(null),w(!0))}}})]})}return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Exams"}),e.jsxs(R,{onClick:()=>p(!0),className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"})," New Exam"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.map(r=>{const s=new Date,i=new Date(r.startTime),d=new Date(r.endTime);let u="UPCOMING";return s>d?u="EXPIRED":s>=i&&(u="LIVE"),e.jsxs(W,{className:"relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(Ce,{className:"w-16 h-16"})}),e.jsx("h4",{className:"font-bold text-lg text-slate-800 dark:text-white",children:r.title}),e.jsxs("div",{className:"flex gap-2 text-xs text-slate-500 mb-3",children:[r.subject&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-1.5 rounded font-bold",children:r.subject}),e.jsxs("span",{children:[r.questions.length," Questions â€¢ ",r.durationMinutes," Mins"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 text-slate-500",children:u==="UPCOMING"?new Date(r.startTime).toLocaleString():u}),u==="UPCOMING"&&e.jsx(De,{targetDate:r.startTime})]})]},r.id)}),c.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-slate-400",children:"No exams created yet."})]})]})};export{He as default};
