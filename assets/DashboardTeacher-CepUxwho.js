import{c as X,r as s,j as e,G as _,U as je,S as es,C as ss,L as Be,a as W,b as Ie,d as D,e as q,f as ts,g as Ue,X as Fe,h as Oe,i as x,A as as,R as ls,M as rs,k as ns,Z as _e,l as ds,m as os,B as He,n as Ye,o as is,p as Ge,q as qe,u as cs,s as xs,H as ms,F as hs,W as us}from"./index-DTK6V_wT.js";import bs from"./ExamsTab-610GsDuf.js";import{P as ps}from"./printer-C135XOqO.js";import{T as ze}from"./trash-2-W_nNfUXu.js";import{P as gs}from"./pen-square-CF8oQgHZ.js";import{C as Ve}from"./calendar-days-TCZ-7xlO.js";import{S as We}from"./save-DCFH4iOI.js";import{P as fs}from"./plus-DWqlxpEn.js";import{S as js,M as Ns,T as ws,a as vs}from"./thumbs-up-C71m0Oa0.js";import{F as ks}from"./frown-Cgh2Vrdq.js";import{B as $e}from"./bell-D2QATelh.js";import{L as ys}from"./layout-grid-BPy_zqOB.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=X("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=X("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=X("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=X("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=X("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=X("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),Ms=({user:n,students:f,pendingAdmissions:m,stats:w,sortingMethod:j,onRefresh:p,onDeleteStudent:C,onAdmissionAction:k,onCleanJunk:g})=>{const[y,S]=s.useState(!1),[o,i]=s.useState({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),[P,T]=s.useState(!1),[R,c]=s.useState({name:!1,dob:!1,gender:!1}),[u,A]=s.useState(""),[F,b]=s.useState(""),[r,l]=s.useState(!1),[d,h]=s.useState(!1),[L,O]=s.useState(!1),[re,Qe]=s.useState("UPLOAD"),[Ne,Ze]=s.useState(null),[we,ve]=s.useState([]),[ke,ne]=s.useState([]),[ye,Se]=s.useState(!1),[Ce,Te]=s.useState([]),[Ae,de]=s.useState(0),[oe,Ee]=s.useState({name:"",regNo:"",rollNo:"",gender:"",dob:"",phone:"",fatherName:"",motherName:"",address:""}),[$,ee]=s.useState(null),[V,se]=s.useState(!1),[N,H]=s.useState({}),[J,te]=s.useState(""),[ie,ce]=s.useState([]),[z,ae]=s.useState(!1),G=n.submissionStatus==="SUBMITTED"||n.submissionStatus==="APPROVED";s.useEffect(()=>{(async()=>{const E=await x.getClasses();ce(E.filter(M=>M.id!==n.id))})()},[n.id]);const xe=s.useMemo(()=>{const t=j||"BOYS_FIRST";if(t==="BOYS_FIRST"||t==="GIRLS_FIRST"){const E=f.filter(U=>U.gender==="Male").sort((U,I)=>(U.rollNo||9999)-(I.rollNo||9999)),M=f.filter(U=>U.gender!=="Male").sort((U,I)=>(U.rollNo||9999)-(I.rollNo||9999));return t==="BOYS_FIRST"?[...E,...M]:[...M,...E]}return[...f].sort((E,M)=>t==="ROLL_ONLY"?(E.rollNo||9999)-(M.rollNo||9999):t==="NAME_ONLY"?E.name.localeCompare(M.name):0)},[f,j]),me=t=>{o[t]?c(E=>({...E,[t]:!1})):c(E=>({...E,[t]:!0}))},he=async t=>{if(!t.target.files||!t.target.files[0])return;if(!n.isPro){alert("Photo upload is an Elite/Pro feature.");return}h(!0);const E=t.target.files[0],M=await x.uploadImage(E,"students");h(!1),M.success&&M.publicUrl?(i(U=>({...U,photoUrl:M.publicUrl})),l(!1)):alert("Upload failed: "+M.message)},ue=async t=>{if(t.preventDefault(),G){alert("Class is locked/submitted. Ask admin to unlock before adding students.");return}b(""),A(""),c({name:!1,dob:!1,gender:!1});let E=!1;if(o.name||(c(I=>({...I,name:!0})),E=!0),o.dob||(c(I=>({...I,dob:!0})),E=!0),o.gender||(c(I=>({...I,gender:!0})),E=!0),E){b("âš ï¸ Please fill Name, DOB & Gender!");return}T(!0);const M={...o,fatherName:o.fatherName||"Not Entered",motherName:o.motherName||"Not Entered",addedBy:n.teacherName||"Class Teacher"};if(!M.photoUrl){const I=M.name||"Felix";M.photoUrl=`https://api.dicebear.com/7.x/avataaars/svg?seed=${I}&gender=${M.gender==="Female"?"female":"male"}`}const U=await x.createStudent(n.id,M);T(!1),U.success?(A(`âœ… ${o.name} Added!`),i({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),p(),setTimeout(()=>A(""),2500)):alert("Failed: "+U.message)},be=t=>{ee(t),H({...t}),se(!1),te("")},pe=async()=>{if(G)return alert("Class is locked.");await x.updateStudentDetails($.id,N),k($.id,"APPROVE"),le(null)},ge=async()=>{if(!J||!$)return;ae(!0);const t=await x.transferStudentAdmission($.id,J);ae(!1),t.success?(alert("Student Transferred Successfully!"),ee(null),p()):alert("Transfer failed: "+t.message)},le=t=>{ee(t),se(!1),H({})},Q=`${window.location.href.split("#")[0]}#/register?schoolId=${n.schoolId}&classId=${n.id}`,Pe=`Dear Parents,

Admission for *${n.name}* is now open.
Please register your child using the link below:

ðŸ”— ${Q}

Thank you,
${n.teacherName||"Class Teacher"}`;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(_,{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white border-none relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:e.jsx(je,{className:"w-24 h-24"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Smart Invite"}),e.jsx("p",{className:"text-xs text-indigo-200 mb-4",children:"Share this link with parents for self-registration."}),e.jsx("div",{className:"bg-black/20 p-2 rounded-lg text-[10px] font-mono mb-4 break-all truncate border border-white/10 select-all cursor-pointer",onClick:()=>navigator.clipboard.writeText(Q),children:Q}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`https://wa.me/?text=${encodeURIComponent(Pe)}`,"_blank"),className:"flex-1 bg-[#25D366] hover:bg-[#20bd5a] text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 shadow-lg transition-transform hover:scale-105",children:[e.jsx(es,{className:"w-4 h-4"})," WhatsApp"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(Q),alert("Link copied!")},className:"flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-transform hover:scale-105",children:[e.jsx(ss,{className:"w-4 h-4"})," Copy"]})]})]}),e.jsxs(_,{className:`border-t-4 ${G?"border-t-slate-400 opacity-80":"border-t-blue-500"} relative overflow-hidden`,children:[G&&e.jsxs("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-950/60 backdrop-blur-[1px] z-10 flex flex-col items-center justify-center text-center",children:[e.jsx(Be,{className:"w-8 h-8 text-slate-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Class Locked"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Results submitted. Cannot add students."})]}),u&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(W,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:u})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(Ie,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Add Student"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Manual Entry"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"mb-4 flex gap-4 items-center bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"relative w-16 h-16 shrink-0 rounded-full overflow-hidden border-2 border-slate-200 shadow-sm",children:o.photoUrl?e.jsx("img",{src:o.photoUrl,className:"w-full h-full object-cover"}):e.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.name||"Felix"}&gender=${o.gender==="Female"?"female":"male"}`,className:"w-full h-full opacity-80"})}),e.jsx("div",{className:"flex-1 space-y-2",children:r?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"cursor-pointer bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded text-[10px] font-bold text-center block",children:[d?"Uploading...":"Choose File",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:he,disabled:d})]}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"text-[10px] text-red-500",children:"Cancel"})]}):e.jsxs("div",{children:[e.jsx(D,{className:"text-xs h-8",placeholder:"Paste Image URL...",value:o.photoUrl,onChange:t=>i({...o,photoUrl:t.target.value})}),n.isPro&&e.jsx("button",{type:"button",onClick:()=>l(!0),className:"text-[10px] text-blue-600 font-bold underline mt-1 block",children:"Or Upload File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"FULL NAME *"}),e.jsx("input",{value:o.name,onChange:t=>i({...o,name:t.target.value.toUpperCase()}),onBlur:()=>me("name"),className:`w-full bg-white dark:bg-slate-800 font-bold rounded-lg px-4 py-2.5 outline-none border-2 ${R.name?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"Gender *"}),e.jsxs("select",{className:"w-full bg-white dark:bg-slate-800 px-3 py-2.5 outline-none font-medium border-2 rounded-lg",value:o.gender,onChange:t=>i({...o,gender:t.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"DOB *"}),e.jsx("input",{type:"date",value:o.dob,onChange:t=>i({...o,dob:t.target.value}),className:`w-full bg-white dark:bg-slate-800 font-medium rounded-lg px-3 py-2 outline-none border-2 ${R.dob?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(D,{className:"text-sm font-mono",placeholder:"Admission No (Reg)",value:o.regNo,onChange:t=>i({...o,regNo:t.target.value})}),e.jsx(D,{type:"number",className:"text-sm font-mono",placeholder:"Roll No",value:o.rollNo,onChange:t=>i({...o,rollNo:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(D,{className:"text-sm",placeholder:"Father",value:o.fatherName,onChange:t=>i({...o,fatherName:t.target.value})}),e.jsx(D,{className:"text-sm",placeholder:"Mother",value:o.motherName,onChange:t=>i({...o,motherName:t.target.value})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{onClick:ue,disabled:P,className:"w-full py-3 text-sm font-bold",children:P?"Saving...":"Save & Add Next"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[m.length>0&&e.jsxs(_,{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"})," Pending Admissions (",m.length,")"]}),e.jsx("span",{className:"text-[10px] bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-2 py-1 rounded",children:"Action Required"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:m.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center justify-between group hover:border-orange-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.name}`,className:"w-10 h-10 rounded-full object-cover bg-slate-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["Applied: ",new Date().toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>be(t),className:"bg-white dark:bg-slate-800 border border-blue-200 dark:border-blue-800 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors",children:"Review"})]},t.id))})]}),e.jsxs(_,{className:"p-0 overflow-hidden min-h-[400px] relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500"})," Class List (",f.length,")"]}),e.jsxs(q,{variant:"secondary",onClick:()=>S(!0),className:"text-xs flex items-center gap-1",disabled:G,children:[e.jsx(ps,{className:"w-3 h-3"})," Register"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:"Roll"}),e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3 w-24",children:"Reg No"}),e.jsx("th",{className:"p-3 w-24",children:"DOB"}),e.jsx("th",{className:"p-3 w-20 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:xe.map(t=>e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-center text-slate-500",children:t.rollNo||"-"}),e.jsx("td",{className:"p-3 text-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[t.photoUrl&&e.jsx("img",{src:t.photoUrl,className:"w-6 h-6 rounded-full object-cover"}),t.name,t.isPremium&&e.jsx(ts,{className:"w-3 h-3 text-yellow-500"})]})}),e.jsx("td",{className:"p-3 font-mono text-slate-600 dark:text-slate-300",children:t.regNo}),e.jsx("td",{className:"p-3 text-slate-500 font-mono",children:Ue(t.dob)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>C(t.id,t.name),disabled:G,className:"p-2 text-slate-400 hover:text-red-500 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(ze,{className:"w-4 h-4"})})})]},t.id))})]})})]})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(_,{className:"w-full max-w-2xl bg-white dark:bg-slate-900 border-t-4 border-t-blue-600 max-h-[90vh] overflow-y-auto flex flex-col p-0",children:[e.jsxs("div",{className:"p-6 pb-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Review Application"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Verify details before approving."})]}),e.jsx("button",{onClick:()=>le(null),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Fe,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"p-6 grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:$.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${$.name}`,className:"w-32 h-32 rounded-full object-cover mx-auto border-4 border-white dark:border-slate-800 shadow-lg bg-slate-100"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Applicant Photo"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm",children:"Student Details"}),e.jsxs("button",{onClick:()=>se(!V),className:"text-xs text-blue-600 underline flex items-center gap-1",children:[e.jsx(gs,{className:"w-3 h-3"})," ",V?"Cancel Edit":"Edit"]})]}),e.jsx("div",{className:"space-y-2 text-sm",children:V?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-8 text-xs",value:N.name,onChange:t=>H({...N,name:t.target.value.toUpperCase()}),placeholder:"Name"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(D,{className:"h-8 text-xs",value:N.regNo,onChange:t=>H({...N,regNo:t.target.value}),placeholder:"Reg No"}),e.jsx("input",{type:"date",className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:N.dob,onChange:t=>H({...N,dob:t.target.value})})]}),e.jsxs("select",{className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:N.gender,onChange:t=>H({...N,gender:t.target.value}),children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Name:"})," ",e.jsx("span",{className:"font-bold",children:N.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Reg No:"})," ",e.jsx("span",{className:"font-mono",children:N.regNo||"-"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"DOB:"})," ",e.jsx("span",{children:Ue(N.dob)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Gender:"})," ",e.jsx("span",{children:N.gender})]})]})})]})]}),e.jsxs("div",{className:"space-y-6 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm mb-3",children:"Parent Information"}),e.jsx("div",{className:"space-y-2 text-sm",children:V?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-8 text-xs",value:N.fatherName,onChange:t=>H({...N,fatherName:t.target.value}),placeholder:"Father's Name"}),e.jsx(D,{className:"h-8 text-xs",value:N.motherName,onChange:t=>H({...N,motherName:t.target.value}),placeholder:"Mother's Name"}),e.jsx(D,{className:"h-8 text-xs",value:N.phone,onChange:t=>H({...N,phone:t.target.value}),placeholder:"Phone"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Father:"})," ",e.jsx("span",{className:"font-bold",children:N.fatherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Mother:"})," ",e.jsx("span",{children:N.motherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Phone:"})," ",e.jsx("span",{children:N.phone})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Address:"})," ",e.jsx("span",{className:"text-xs",children:N.address||"-"})]})]})})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Wrong Class? Transfer Request"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Oe,{className:"h-9 text-xs py-0",value:J,onChange:t=>te(t.target.value),children:[e.jsx("option",{value:"",children:"Select Target Class"}),ie.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{onClick:ge,disabled:!J||z,className:"bg-purple-100 text-purple-700 px-3 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors whitespace-nowrap",children:z?"Moving...":e.jsxs(e.Fragment,{children:[e.jsx(Ss,{className:"w-3 h-3 inline mr-1"})," Move"]})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>k($.id,"REJECT"),className:"flex-1 py-3 border border-red-200 text-red-600 rounded-xl font-bold text-sm hover:bg-red-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"})," Reject"]}),e.jsxs("button",{onClick:pe,disabled:G,className:"flex-[2] py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 shadow-lg shadow-green-500/30 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"})," Approve Admission"]})]})]})]})]})]})})]})},Ps=({students:n,marks:f,subjects:m,isSubmitted:w,loading:j,onMarkChange:p,onSaveAll:C,onSubmitResults:k})=>{const g=[...n].sort((b,r)=>(b.rollNo||9999)-(r.rollNo||9999)),[y,S]=s.useState("TERM"),[o,i]=s.useState(!1),[P,T]=s.useState(!1),[R,c]=s.useState(null);s.useEffect(()=>{(async()=>{const r=await x.getSchoolConfig();r!=null&&r.allowTeacherDirectPublish&&i(!0)})()},[]);const u=["CLASS_TEST","REVISION"].includes(y),A=async()=>{if(u&&o){if(!confirm(`Directly publish ${y} results? Parents will see this immediately.`))return;T(!0),k()}else k()},F=(b,r,l)=>{if(c(null),l===""||l.toUpperCase()==="AB"||l.toUpperCase()==="A"){p(b,r,l);return}const d=parseFloat(l);if(isNaN(d))return;const h=m.find(L=>L.name===r);if(h){if(d>h.maxMarks){c(`Cannot enter ${d} for ${r}. Max is ${h.maxMarks}.`);return}if(d<0)return}p(b,r,l)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm relative",children:[R&&e.jsxs("div",{className:"absolute top-full left-0 right-0 bg-red-100 text-red-700 text-xs font-bold p-2 text-center border-b border-red-200 z-20 animate-fade-in-up",children:[e.jsx(as,{className:"w-3 h-3 inline mr-1"})," ",R]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Assessment Type"}),e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>S("TERM"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${y==="TERM"?"bg-white dark:bg-slate-800 text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Ve,{className:"w-4 h-4"})," Term Exam"]}),e.jsxs("button",{onClick:()=>S("CLASS_TEST"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${y==="CLASS_TEST"?"bg-white dark:bg-slate-800 text-purple-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Je,{className:"w-4 h-4"})," Class Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white hidden md:block",children:"Marks Entry"}),w&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"})," Locked"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(q,{onClick:C,variant:"secondary",disabled:j||w,className:"flex-1 md:flex-none",children:[e.jsx(We,{className:"w-4 h-4 mr-2 inline"})," Save Draft"]}),u&&o?e.jsxs(q,{onClick:A,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-500/20 flex-1 md:flex-none",disabled:w,children:[e.jsx(ls,{className:"w-4 h-4 mr-2 inline"})," Publish Result"]}):e.jsx(q,{onClick:k,className:w?"bg-orange-500 hover:bg-orange-600 flex-1 md:flex-none":"bg-blue-600 hover:bg-blue-700 flex-1 md:flex-none",children:w?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 mr-2 inline"})," Request Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 inline"})," Submit to Admin"]})})]})]}),e.jsx(_,{className:"overflow-hidden p-0 relative",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left whitespace-nowrap",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-xs uppercase font-bold text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-3 w-48 sticky left-0 bg-slate-100 dark:bg-slate-800 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"Student Name"}),m.map(b=>e.jsxs("th",{className:"p-3 text-center min-w-[100px]",children:[b.name.substring(0,15),e.jsxs("span",{className:"block text-[9px] opacity-60",children:["Max: ",b.maxMarks]})]},b.name)),e.jsx("th",{className:"p-3 w-24 text-center font-black",children:"Total"}),e.jsx("th",{className:"p-3 w-16 text-center",children:"Grade"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:g.map(b=>{const r=f[b.id];return r?e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-3 text-center font-mono text-slate-500",children:b.rollNo||"-"}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-slate-200 sticky left-0 bg-white dark:bg-slate-900 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:b.name}),m.map(l=>e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"text",className:`w-16 text-center p-2 rounded border outline-none font-bold transition-all focus:ring-2 focus:ring-blue-500 ${w?"bg-slate-100 text-slate-500 cursor-not-allowed":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700"}`,value:r.subjects[l.name]||"",onChange:d=>F(b.id,l.name,d.target.value),disabled:w,placeholder:"-",inputMode:"decimal"})},l.name)),e.jsx("td",{className:"p-3 text-center font-black text-blue-600 dark:text-blue-400",children:r.total}),e.jsx("td",{className:`p-3 text-center font-bold ${r.grade==="F"?"text-red-500":"text-green-600"}`,children:r.grade})]},b.id):null})})]})})})]})},Ds=({onPostNotice:n})=>{const[f,m]=s.useState(""),[w,j]=s.useState(""),[p,C]=s.useState(""),[k,g]=s.useState(!1),[y,S]=s.useState(!1);s.useEffect(()=>{if(k){const i=setTimeout(()=>g(!1),2e3);return()=>clearTimeout(i)}},[k]);const o=async()=>{if(!f||!w){alert("Please enter title and message");return}S(!0);const i=await n(f,w,p);S(!1),i&&(m(""),j(""),C(""),g(!0))};return e.jsx("div",{className:"max-w-md mx-auto animate-fade-in-up",children:e.jsxs(_,{className:"border-t-4 border-t-blue-500 relative overflow-hidden",children:[k&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(W,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:p?"Scheduled!":"Notice Posted!"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(rs,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Post Notice"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Inform students & parents"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Title"}),e.jsx(D,{placeholder:"e.g. Exam Schedule",value:f,onChange:i=>m(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Message"}),e.jsx("textarea",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-sm h-32 resize-none",placeholder:"Type here...",value:w,onChange:i=>j(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Schedule for Later (Optional)"}),e.jsx(D,{type:"datetime-local",value:p,onChange:i=>C(i.target.value)})]}),e.jsxs(q,{onClick:o,disabled:y,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),y?"Posting...":p?"Schedule Post":"Post Notice"]})]})]})})},Rs=({subjects:n,onAddSubject:f,onDeleteSubject:m,canEdit:w})=>{const[j,p]=s.useState("50"),[C,k]=s.useState("18"),[g,y]=s.useState(!1),[S,o]=s.useState(""),[i,P]=s.useState(!1),T=["English","Malayalam","Hindi","Arabic","Urdu","Maths","Physics","Chemistry","Biology","Science","Social Science","History","Geography","IT","GK","Moral Science","Drawing"],R=async c=>{if(!c)return;if(n.some(b=>b.name.toLowerCase()===c.toLowerCase())){alert(`${c} already exists!`);return}P(!0);const u=parseInt(j)||50,A=parseInt(C)||18,F=await f(c,u,A);P(!1),F&&o("")};return e.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in-up space-y-6",children:[w&&e.jsxs(_,{className:"border-t-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"})," Quick Add"]}),e.jsxs("button",{onClick:()=>y(!g),className:"text-xs font-bold text-slate-500 flex items-center gap-1 hover:text-blue-600 bg-slate-100 dark:bg-slate-800 px-3 py-1.5 rounded-lg transition-colors",children:[e.jsx(ds,{className:"w-3 h-3"})," ",g?"Hide Settings":`Default: ${j}/${C}`]})]}),g&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-800 mb-4 grid grid-cols-2 gap-4 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Default Max Marks"}),e.jsx(D,{type:"number",value:j,onChange:c=>p(c.target.value),className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Default Pass Marks"}),e.jsx(D,{type:"number",value:C,onChange:c=>k(c.target.value),className:"h-8 text-sm"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:T.map(c=>{const u=n.some(A=>A.name===c);return e.jsxs("button",{onClick:()=>!u&&R(c),disabled:u||i,className:`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all flex items-center gap-1 ${u?"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-600 cursor-default":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:border-blue-400 hover:text-blue-600 shadow-sm"}`,children:[u&&e.jsx(os,{className:"w-3 h-3"})," ",c]},c)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{placeholder:"Type Custom Subject...",value:S,onChange:c=>o(c.target.value),onKeyDown:c=>{c.key==="Enter"&&R(S)},className:"text-sm"}),e.jsx(q,{onClick:()=>R(S),disabled:i||!S,className:"w-auto px-6 bg-blue-600 hover:bg-blue-700",children:e.jsx(fs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm ml-1 flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"})," Added Subjects (",n.length,")"]}),n.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:n.map((c,u)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm group hover:border-blue-300 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 font-bold text-xs",children:u+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-sm",children:c.name}),e.jsxs("p",{className:"text-[10px] text-slate-500 font-medium",children:["Max: ",c.maxMarks," â€¢ Pass: ",c.passMarks]})]})]}),w&&e.jsx("button",{onClick:()=>m(u),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(ze,{className:"w-4 h-4"})})]},u))}):e.jsxs("div",{className:"text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"No subjects added yet."}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Use the Quick Add buttons above."})]})]})]})},Ls=({students:n,classId:f})=>{const[m,w]=s.useState("DAILY"),[j,p]=s.useState(new Date().toISOString().split("T")[0]),[C,k]=s.useState("Term 1"),[g,y]=s.useState({}),[S,o]=s.useState(!1),[i,P]=s.useState(!1),[T,R]=s.useState(50);s.useEffect(()=>{c()},[m,j,C]);const c=async()=>{o(!0);const r={};m==="DAILY"?((await x.getAttendanceByDate(f,j)).forEach(d=>{r[d.studentId]=d.status}),n.forEach(d=>{r[d.id]||(r[d.id]="PRESENT")})):((await x.getAttendanceByTerm(f,C)).forEach(d=>{r[d.studentId]={present:d.presentDays,total:d.workingDays},d.workingDays&&R(d.workingDays)}),n.forEach(d=>{r[d.id]||(r[d.id]={present:0,total:T})})),y(r),o(!1)},u=r=>{y(l=>{const d=l[r],h=d==="PRESENT"?"ABSENT":d==="ABSENT"?"LATE":"PRESENT";return{...l,[r]:h}})},A=(r,l)=>{const d=parseInt(l)||0;y(h=>({...h,[r]:{present:d,total:T}}))},F=async()=>{P(!0);const r=n.map(d=>({studentId:d.id,classId:f,date:j,status:g[d.id],type:"DAILY"})),l=await x.markDailyAttendance(r);P(!1),l.success?alert("Daily Attendance Saved!"):alert("Failed to save.")},b=async()=>{P(!0);const r=n.map(d=>{var h;return{studentId:d.id,classId:f,term:C,workingDays:T,presentDays:((h=g[d.id])==null?void 0:h.present)||0,status:"PRESENT",type:"SUMMARY"}}),l=await x.saveSummaryAttendance(r);P(!1),l.success?alert("Term Attendance Saved!"):alert("Failed to save.")};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 gap-4",children:[e.jsxs("div",{className:"flex items-center bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("button",{onClick:()=>w("DAILY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${m==="DAILY"?"bg-white dark:bg-slate-800 shadow text-blue-600 dark:text-blue-400":"text-slate-500"}`,children:[e.jsx(Ye,{className:"w-4 h-4"})," Daily Tracker"]}),e.jsxs("button",{onClick:()=>w("SUMMARY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${m==="SUMMARY"?"bg-white dark:bg-slate-800 shadow text-purple-600 dark:text-purple-400":"text-slate-500"}`,children:[e.jsx(Cs,{className:"w-4 h-4"})," Term Summary"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[m==="DAILY"?e.jsx(D,{type:"date",value:j,onChange:r=>p(r.target.value),className:"font-bold text-sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{value:C,onChange:r=>k(r.target.value),className:"w-32 text-sm py-2",children:[e.jsx("option",{children:"Term 1"}),e.jsx("option",{children:"Term 2"}),e.jsx("option",{children:"Finals"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase whitespace-nowrap",children:"Total Days:"}),e.jsx("input",{type:"number",className:"w-12 bg-transparent text-sm font-bold text-center outline-none",value:T,onChange:r=>R(parseInt(r.target.value)||0)})]})]}),e.jsx(q,{onClick:m==="DAILY"?F:b,disabled:i,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:i?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2"})," Save"]})})]})]}),e.jsx(_,{className:"p-0 overflow-hidden min-h-[400px]",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Status / Days Present"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:n.map(r=>{var l,d,h;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center text-slate-500 font-mono",children:r.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700 dark:text-slate-200",children:r.name}),e.jsx("td",{className:"p-4 text-center",children:S?e.jsx("div",{className:"h-8 w-24 bg-slate-100 dark:bg-slate-800 rounded animate-pulse mx-auto"}):m==="DAILY"?e.jsxs("button",{onClick:()=>u(r.id),className:`w-32 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${g[r.id]==="PRESENT"?"bg-green-100 text-green-700 border border-green-200":g[r.id]==="ABSENT"?"bg-red-100 text-red-700 border border-red-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[g[r.id]==="PRESENT"&&e.jsx(W,{className:"w-4 h-4"}),g[r.id]==="ABSENT"&&e.jsx(is,{className:"w-4 h-4"}),g[r.id]==="LATE"&&e.jsx(Ge,{className:"w-4 h-4"}),g[r.id]||"PRESENT"]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",className:"w-16 p-2 text-center font-bold bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none",value:((l=g[r.id])==null?void 0:l.present)||0,onChange:L=>A(r.id,L.target.value)})}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["/ ",T]}),e.jsxs("span",{className:`text-xs font-bold ml-2 ${((d=g[r.id])==null?void 0:d.present)/T<.75?"text-red-500":"text-green-500"}`,children:[T>0?Math.round(((h=g[r.id])==null?void 0:h.present)/T*100):0,"%"]})]})})]},r.id)})})]})})]})},Is=({classId:n})=>{var r;const[f,m]=s.useState([]),[w,j]=s.useState([]),[p,C]=s.useState(null),[k,g]=s.useState(new Date().toISOString().split("T")[0]),[y,S]=s.useState({}),[o,i]=s.useState(!1),[P,T]=s.useState(!1);s.useEffect(()=>{R()},[n]);const R=async()=>{i(!0);const l=await x.getAssessmentPrograms("TEACHER",n);m(l);const d=await x.getStudentsByClass(n);j(d),l.length>0&&C(l[0].id),i(!1)};s.useEffect(()=>{p&&c()},[p,k]);const c=async()=>{if(!p)return;const l=await x.getAssessmentLogs(p,k),d={};l.forEach(h=>{d[h.studentId]=h.totalScore}),S(d)},u=(l,d)=>{S(h=>({...h,[l]:d}))},A=async()=>{if(!p)return;T(!0);const l=w.map(d=>{const h=y[d.id];return h===void 0?Promise.resolve():x.logAssessmentEntry({programId:p,studentId:d.id,date:k,data:{score:h}})});await Promise.all(l),T(!1),alert("Assessment Data Saved!")},F=()=>f.find(l=>l.id===p),b=(l,d,h=5)=>{const L=y[l]||0;return d==="STAR"?e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(O=>e.jsx(qe,{className:`w-6 h-6 cursor-pointer transition-colors ${O<=L?"fill-yellow-400 text-yellow-400":"text-slate-300"}`,onClick:()=>u(l,O)},O))}):d==="EMOJI"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(js,{className:`w-6 h-6 cursor-pointer ${L===3?"text-green-500 scale-125":"text-slate-300"}`,onClick:()=>u(l,3)}),e.jsx(Ns,{className:`w-6 h-6 cursor-pointer ${L===2?"text-yellow-500 scale-125":"text-slate-300"}`,onClick:()=>u(l,2)}),e.jsx(ks,{className:`w-6 h-6 cursor-pointer ${L===1?"text-red-500 scale-125":"text-slate-300"}`,onClick:()=>u(l,1)})]}):d==="YESNO"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(l,10),className:`p-2 rounded ${L===10?"bg-green-500 text-white":"bg-slate-100 text-slate-400"}`,children:e.jsx(ws,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(l,0),className:`p-2 rounded ${L===0&&y[l]!==void 0?"bg-red-500 text-white":"bg-slate-100 text-slate-400"}`,children:e.jsx(vs,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{type:"number",className:"w-16 text-center h-8",value:L,onChange:O=>u(l,parseInt(O.target.value)||0)}),e.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",h]})]})};return o?e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Loading Assessments..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx(Ge,{className:"w-5 h-5 text-purple-500"}),e.jsxs("select",{className:"bg-transparent font-bold text-slate-700 dark:text-white outline-none cursor-pointer",value:p||"",onChange:l=>C(l.target.value),children:[f.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id)),f.length===0&&e.jsx("option",{children:"No Active Programs"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-1.5 rounded-lg",children:[e.jsx(Ve,{className:"w-4 h-4 text-slate-500"}),e.jsx("input",{type:"date",className:"bg-transparent text-xs font-bold outline-none dark:text-white",value:k,onChange:l=>g(l.target.value)})]}),e.jsx(q,{onClick:A,disabled:P,className:"bg-purple-600 hover:bg-purple-700 text-white shadow-lg shadow-purple-500/20",children:P?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"})," Save Data"]})})]})]}),p&&f.length>0?e.jsxs(_,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/10 p-3 text-center border-b border-purple-100 dark:border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 font-bold uppercase tracking-wider",children:["Evaluating: ",((r=F())==null?void 0:r.questions[0].text)||"General Performance"]})}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Performance"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:w.map(l=>{var d,h;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center font-mono text-slate-500",children:l.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-800 dark:text-white",children:l.name}),e.jsx("td",{className:"p-4 flex justify-center",children:b(l.id,((d=F())==null?void 0:d.type)||"STAR",(h=F())==null?void 0:h.questions[0].maxVal)})]},l.id)})})]})})]}):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("p",{className:"text-slate-400",children:"No assessment programs available."}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Ask Admin to create programs in 'Academics > Assessments'."})]})]})},Ws=({user:n})=>{const f=cs(),[m,w]=s.useState("attendance"),[j,p]=s.useState([]),[C,k]=s.useState([]),[g,y]=s.useState({}),[S,o]=s.useState(!1),[i,P]=s.useState(n.subjects),[T,R]=s.useState(n.submissionStatus==="SUBMITTED"),[c,u]=s.useState(!1),[A,F]=s.useState({name:n.teacherName||"",photo:n.teacherPhoto||""}),[b,r]=s.useState(!1),[l,d]=s.useState(null),[h,L]=s.useState(!1),[O,re]=s.useState(""),[Qe,Ne]=s.useState([]),[Ze,we]=s.useState([]),[ve,ke]=s.useState(!1),[ne,ye]=s.useState({fees:!1,assessments:!1}),[Se,Ce]=s.useState({ai:5,results:1}),[Te,Ae]=s.useState(2),[de,oe]=s.useState([]),[Ee,$]=s.useState(!1),[ee,V]=s.useState(0),[se,N]=s.useState(!1),[H,J]=s.useState([]);s.useEffect(()=>{z(),ae(),te()},[]);const te=async()=>{const a=await x.getNotifications(n.id,"TEACHER");oe(a),V(a.filter(v=>!v.isRead).length)},ie=async a=>{await x.markNotificationRead(a),oe(v=>v.map(B=>B.id===a?{...B,isRead:!0}:B)),V(v=>Math.max(0,v-1))},ce=async()=>{const a=await x.getTeacherTransactionHistory(n.id);J(a),N(!0)},z=async()=>{o(!0);const[a,v]=await Promise.all([x.getSchoolConfig(),x.getGlobalSettings()]);if(d(a),u((a==null?void 0:a.allowTeacherSubjectEdit)??!1),ye({fees:v.MODULE_FEES!=="FALSE",assessments:v.MODULE_ASSESSMENTS!=="FALSE"}),v.FEATURE_COSTS)try{const Y=JSON.parse(v.FEATURE_COSTS);Ce(Y)}catch{}v.AI_TRIAL_LIMIT&&Ae(parseInt(v.AI_TRIAL_LIMIT)||2);const B=(a==null?void 0:a.feeManagerRole)||"ADMIN",K=(await x.getFeeStructures(n.id)).filter(Y=>Y.collectedBy==="TEACHER"||Y.collectedBy==="BOTH"||B==="TEACHER"||B==="HYBRID");we(K),ke(K.length>0);const De=await x.getStudentsByClass(n.id);p(De);const fe={};for(const Y of De){const Le=await x.getMarks(Y.id,"Term 1");Le?fe[Y.id]=Le:fe[Y.id]={studentId:Y.id,subjects:i.reduce((Ke,Xe)=>({...Ke,[Xe.name]:0}),{}),total:0,grade:"F",term:"Term 1"}}y(fe);const Re=await x.getPendingAdmissions(n.id);k(Re),Re.length>0&&((a==null?void 0:a.admissionApprover)==="TEACHER"||(a==null?void 0:a.admissionApprover)==="BOTH"||!(a!=null&&a.admissionApprover))&&w("students"),o(!1)},ae=async()=>{const a=await x.getAssessmentPrograms("TEACHER",n.id);Ne(a)},G=(a,v,B)=>{y(Z=>{const K={...Z[a]};return K.subjects={...K.subjects,[v]:B},{...Z,[a]:K}})},xe=async()=>{for(const a of Object.values(g))await x.saveMarks(a);alert("Saved!")},me=async()=>{(await x.toggleClassSubmission(n.id,!0)).success&&R(!0)},he=async(a,v)=>{v==="APPROVE"?await x.verifyStudent(a,n.teacherName):await x.rejectAdmission(a),z()},ue=async a=>{await x.deleteStudent(a),z()},be=async()=>{await x.deleteUnverifiedStudents(n.id),z()},pe=async(a,v,B)=>{const Z=[...i,{name:a,maxMarks:v,passMarks:B}];return await x.updateClassSubjects(n.id,Z),P(Z),!0},ge=async a=>{const v=[...i];v.splice(a,1),await x.updateClassSubjects(n.id,v),P(v)},le=async(a,v,B)=>(await x.createCampusPost(n.schoolId,n.teacherName||"Teacher",v,"TEACHER","NOTICE",a,B),!0),Me=async()=>{await x.updateClassDetails(n.id,{teacherName:A.name}),r(!1)},Q=async a=>{},t={total:j.length,male:j.filter(a=>a.gender==="Male").length,female:j.filter(a=>a.gender==="Female").length},E=async()=>{if(!O||O.length<4)return alert("Password must be at least 4 characters.");o(!0);const a=await x.changeClassPassword(n.id,O);o(!1),a.success?(alert("Password updated successfully!"),L(!1),re("")):alert("Update Failed: "+a.message)},M=()=>m==="students"?e.jsxs("div",{className:"flex items-center gap-2 mt-2 sm:mt-0",children:[e.jsx("div",{className:"flex items-center gap-1 bg-blue-50 dark:bg-blue-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[t.male," B"]})}),e.jsx("div",{className:"flex items-center gap-1 bg-pink-50 dark:bg-pink-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-pink-700 dark:text-pink-300",children:[t.female," G"]})})]}):null,U=()=>{const a=l==null?void 0:l.teacherQuota;return!a||a.frequency==="UNLIMITED"?null:e.jsxs("div",{className:"flex items-center gap-2 text-[10px] bg-purple-50 dark:bg-purple-900/20 text-purple-700 px-3 py-1 rounded border border-purple-100 dark:border-purple-800 cursor-pointer hover:bg-purple-100",onClick:ce,children:[e.jsx(_e,{className:"w-3 h-3 fill-current"}),e.jsxs("span",{children:["Limit: ",a.limit]})]})},I=[{id:"attendance",label:"Attendance",icon:Ye},{id:"students",label:"Students",icon:je},{id:"marks",label:"Marks",icon:hs},{id:"exams",label:"Exams",icon:Je},{id:"subjects",label:"Subjects",icon:He},{id:"reports",label:"Reports",icon:ys}];return ne.assessments&&I.push({id:"assessments",label:"Skills",icon:qe}),ne.fees&&ve&&I.push({id:"fees",label:"Fees",icon:us}),e.jsxs("div",{className:"pb-20 relative animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-4 mb-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group shrink-0",children:[A.photo?e.jsx("img",{src:A.photo,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900 rounded-lg flex items-center justify-center text-blue-600 dark:text-blue-300",children:e.jsx(Es,{className:"w-6 h-6"})}),b&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Q}),e.jsx(xs,{className:"w-4 h-4 text-white"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-black text-blue-600 dark:text-blue-400",children:n.name}),b?e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{className:"bg-slate-50 border rounded px-1 text-xs",value:A.name,onChange:a=>F({...A,name:a.target.value})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:Me,className:"text-[10px] bg-green-100 text-green-700 px-2 rounded",children:"Save"}),e.jsx("button",{onClick:()=>L(!0),className:"text-[10px] bg-yellow-100 text-yellow-700 px-2 rounded",children:"Pass"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500",children:A.name||"Class Teacher"}),e.jsx("button",{onClick:()=>r(!0),className:"text-slate-400",children:e.jsx(Ts,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-center sm:justify-end w-full sm:w-auto",children:[U(),e.jsxs("button",{onClick:()=>$(!0),className:"relative p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600 hover:bg-slate-200",children:[e.jsx($e,{className:"w-4 h-4"}),ee>0&&e.jsx("span",{className:"absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"})]}),e.jsx("button",{onClick:()=>f(`/school/${n.schoolId}`),className:"p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600",title:"Visit School Home",children:e.jsx(ms,{className:"w-4 h-4"})}),M()]})]}),e.jsx("div",{className:"flex justify-between items-center mb-6 overflow-x-auto pb-2 no-scrollbar",children:e.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl max-w-full gap-1 border border-slate-200 dark:border-slate-700",children:I.map(a=>e.jsxs("button",{onClick:()=>w(a.id),className:`px-4 py-2 rounded-lg text-xs font-bold capitalize whitespace-nowrap flex items-center gap-2 transition-all ${m===a.id?"bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm ring-1 ring-black/5":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(a.icon,{className:"w-3 h-3"})," ",a.label]},a.id))})}),e.jsxs("div",{className:"mt-4 min-h-[50vh]",children:[m==="students"&&e.jsx(Ms,{user:n,students:j,pendingAdmissions:C,stats:t,sortingMethod:l==null?void 0:l.sortingMethod,onRefresh:z,onDeleteStudent:ue,onAdmissionAction:he,onCleanJunk:be}),m==="subjects"&&e.jsx(Rs,{subjects:i,onAddSubject:pe,onDeleteSubject:ge,canEdit:c}),m==="marks"&&e.jsx(Ps,{students:j,marks:g,subjects:i,isSubmitted:T,loading:S,onMarkChange:G,onSaveAll:xe,onSubmitResults:me}),m==="attendance"&&e.jsx(Ls,{students:j,classId:n.id}),m==="exams"&&e.jsx(bs,{classId:n.id,featureCosts:Se,aiTrialLimit:Te}),m==="reports"&&e.jsx(Ds,{onPostNotice:le}),m==="assessments"&&e.jsx(Is,{classId:n.id}),m==="fees"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Fees Module coming soon."})]}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(_,{className:"w-full max-w-sm bg-white dark:bg-slate-900 border-t-4 border-yellow-500",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-white",children:"Change Access Password"}),e.jsx("p",{className:"text-xs text-slate-500 mb-4",children:"Set a new password for this class login."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-yellow-500 text-slate-900 dark:text-white",placeholder:"New Password",value:O,onChange:a=>re(a.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(!1),className:"flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold text-sm hover:bg-slate-200",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:S,className:"flex-1 py-3 bg-yellow-600 text-white rounded-xl font-bold text-sm hover:bg-yellow-700",children:S?"Saving...":"Update Password"})]})]})]})}),Ee&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in-up",onClick:()=>$(!1),children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative",onClick:a=>a.stopPropagation(),children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 dark:text-white flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-blue-500"})," Notifications"]}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto custom-scrollbar",children:de.length>0?de.map(a=>e.jsxs("div",{onClick:()=>!a.isRead&&ie(a.id),className:`p-3 rounded-xl border transition-all cursor-pointer ${a.isRead?"bg-slate-50 dark:bg-slate-800 border-slate-100 dark:border-slate-700":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${a.type==="ALERT"?"bg-red-100 text-red-600":"bg-slate-200 text-slate-600"}`,children:a.type}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:a.message}),!a.isRead&&e.jsxs("div",{className:"mt-2 text-[10px] text-blue-500 font-bold flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Mark Read"]})]},a.id)):e.jsx("p",{className:"text-center text-slate-400 text-sm py-8",children:"No notifications."})}),e.jsx("button",{onClick:()=>$(!1),className:"w-full mt-4 py-3 bg-slate-100 dark:bg-slate-800 rounded-xl font-bold text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-200",children:"Close"})]})})]})};export{Ws as default};
