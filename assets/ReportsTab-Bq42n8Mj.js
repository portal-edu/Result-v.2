import{r as d,i as x,j as e,h as P,l as A,D as G,G as z,K as B,g as j}from"./index-DTK6V_wT.js";import{P as M}from"./printer-C135XOqO.js";const T=()=>{const[w,m]=d.useState(!1),[h,S]=d.useState([]),[N,v]=d.useState([]),[g,C]=d.useState("ALL"),[s,k]=d.useState({rollNo:!0,regNo:!0,name:!0,gender:!0,dob:!0,fatherName:!0,motherName:!1,className:!0,status:!0}),[f,y]=d.useState(!1);d.useEffect(()=>{L()},[]);const L=async()=>{m(!0);const t=await x.getClasses();v(t),await b("ALL"),m(!1)},b=async t=>{var c;let a=[];if(t==="ALL"){const r=await x.getClasses();for(const l of r){const p=(await x.getStudentsByClass(l.id)).map(u=>({...u,className:l.name}));a=[...a,...p]}}else{const r=await x.getStudentsByClass(t),l=((c=N.find(i=>i.id===t))==null?void 0:c.name)||"";a=r.map(i=>({...i,className:l}))}a.sort((r,l)=>r.className!==l.className?(r.className||"").localeCompare(l.className||""):(r.rollNo||0)-(l.rollNo||0)),S(a)},D=async t=>{const a=t.target.value;C(a),m(!0),await b(a),m(!1)},F=t=>{k(a=>({...a,[t]:!a[t]}))},R=async()=>{var p,u;const t=(p=window.jspdf)==null?void 0:p.jsPDF;if(!t)return alert("PDF Library not ready.");const a=new t,c=await x.getSchoolConfig(),r=(c==null?void 0:c.schoolName)||"Student Report";a.setFontSize(16),a.text(r,105,15,{align:"center"}),a.setFontSize(12),a.text(`Student List - ${g==="ALL"?"All Classes":(u=N.find(n=>n.id===g))==null?void 0:u.name}`,105,22,{align:"center"});const l=[];s.rollNo&&l.push("Roll"),s.regNo&&l.push("Reg No"),s.name&&l.push("Name"),s.gender&&l.push("Gender"),s.dob&&l.push("DOB"),s.className&&l.push("Class"),s.fatherName&&l.push("Father");const i=h.map(n=>{const o=[];return s.rollNo&&o.push(n.rollNo||""),s.regNo&&o.push(n.regNo),s.name&&o.push(n.name),s.gender&&o.push(n.gender),s.dob&&o.push(j(n.dob)),s.className&&o.push(n.className),s.fatherName&&o.push(n.fatherName),o});a.autoTable({head:[l],body:i,startY:30,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[66,66,66]}}),a.save(`Student_Report_${new Date().toISOString().slice(0,10)}.pdf`)};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm print:hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("h2",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Master Register"}),e.jsxs(P,{value:g,onChange:D,className:"w-40 py-1.5 text-sm",children:[e.jsx("option",{value:"ALL",children:"All Classes"}),N.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs font-bold text-slate-700 dark:text-slate-300 hover:bg-slate-200 transition-colors",children:[e.jsx(A,{className:"w-4 h-4"})," Columns"]}),f&&e.jsxs("div",{className:"absolute top-10 right-0 w-48 bg-white dark:bg-slate-800 shadow-xl rounded-xl border border-slate-200 dark:border-slate-700 p-2 z-50",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400 mb-2 px-2",children:"Toggle Fields"}),Object.keys(s).map(t=>e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-slate-50 dark:hover:bg-slate-700 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s[t],onChange:()=>F(t),className:"accent-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-300 capitalize",children:t.replace(/([A-Z])/g," $1").trim()})]},t))]})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-2 bg-red-50 text-red-700 border border-red-200 rounded-lg text-xs font-bold hover:bg-red-100 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"})," PDF"]}),e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-3 py-2 bg-slate-800 text-white rounded-lg text-xs font-bold hover:bg-slate-900 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"})," Print"]})]})]}),e.jsx(z,{className:"p-0 overflow-hidden min-h-[500px]",children:w?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(B,{}),e.jsx("div",{className:"mt-4 text-slate-500 text-sm",children:"Loading Register..."})]}):e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left text-sm border-collapse whitespace-nowrap",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-[10px] tracking-wider border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10 text-center",children:"#"}),s.rollNo&&e.jsx("th",{className:"p-3",children:"Roll"}),s.regNo&&e.jsx("th",{className:"p-3",children:"Reg No"}),s.name&&e.jsx("th",{className:"p-3",children:"Student Name"}),s.gender&&e.jsx("th",{className:"p-3",children:"Gender"}),s.dob&&e.jsx("th",{className:"p-3",children:"DOB"}),s.className&&e.jsx("th",{className:"p-3",children:"Class"}),s.fatherName&&e.jsx("th",{className:"p-3",children:"Father"}),s.motherName&&e.jsx("th",{className:"p-3",children:"Mother"}),s.status&&e.jsx("th",{className:"p-3 text-center",children:"Status"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[h.map((t,a)=>e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-center text-slate-400 text-xs",children:a+1}),s.rollNo&&e.jsx("td",{className:"p-3 font-mono text-slate-600 dark:text-slate-400",children:t.rollNo||"-"}),s.regNo&&e.jsx("td",{className:"p-3 font-mono font-bold text-slate-700 dark:text-slate-300",children:t.regNo}),s.name&&e.jsx("td",{className:"p-3 font-bold text-slate-800 dark:text-white uppercase",children:t.name}),s.gender&&e.jsx("td",{className:"p-3 text-xs",children:t.gender}),s.dob&&e.jsx("td",{className:"p-3 text-xs font-mono",children:j(t.dob)}),s.className&&e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase",children:t.className})}),s.fatherName&&e.jsx("td",{className:"p-3 text-xs text-slate-500",children:t.fatherName}),s.motherName&&e.jsx("td",{className:"p-3 text-xs text-slate-500",children:t.motherName}),s.status&&e.jsx("td",{className:"p-3 text-center",children:t.isVerified?e.jsx("span",{className:"text-[10px] text-green-600 bg-green-50 px-2 py-0.5 rounded-full font-bold",children:"Active"}):e.jsx("span",{className:"text-[10px] text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full font-bold",children:"Pending"})})]},t.id)),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center text-slate-400 italic",children:"No records found."})})]})]})})}),e.jsxs("div",{className:"text-center text-[10px] text-slate-400 print:hidden",children:["Showing ",h.length," Records â€¢ Generated on ",new Date().toLocaleDateString()]})]})};export{T as default};
