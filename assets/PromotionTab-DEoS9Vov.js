import{c as S,r as m,j as e,g as E,G as w,b as y,ad as F,K as G,a as M}from"./index-CGGgVCBT.js";import{L as z}from"./layout-grid-DNuuoMbe.js";import{S as H}from"./save-C8bWBG82.js";import{P as O}from"./printer-u7CTVqWj.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=S("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=S("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=S("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),X=({classes:h,onRefresh:A})=>{const[C,p]=m.useState(1),[u,g]=m.useState(!1),[i,f]=m.useState([]),[d,j]=m.useState([]),[N,P]=m.useState(!0),[x,b]=m.useState([]),[Y,D]=m.useState(!1);m.useEffect(()=>{const t=localStorage.getItem("promotion_draft_v1");if(t)if(confirm("Found an unsaved promotion draft. Do you want to resume it?"))try{const s=JSON.parse(t);b(s.pool),f(s.source),j(s.target),p(2),D(!0)}catch{console.error("Draft corrupted"),localStorage.removeItem("promotion_draft_v1")}else localStorage.removeItem("promotion_draft_v1")},[]);const L=async()=>{var t;if(i.length===0||d.length===0)return alert("Please select Source and Target classes.");g(!0);try{let s=[];for(const n of i){const c=await M.getStudentsByClass(n),v=((t=h.find(k=>k.id===n))==null?void 0:t.name)||"Unknown",B=c.map(k=>({...k,currentClassName:v,score:Math.floor(Math.random()*50)+50,targetClassId:""}));s=[...s,...B]}N?s.sort((n,c)=>c.score-n.score):s.sort(()=>Math.random()-.5);const a=d;let r=0,o=1;const l=s.map(n=>{const c=a[r];return N?(r+=o,r>=a.length?(r=a.length-1,o=-1):r<0&&(r=0,o=1)):r=(r+1)%a.length,{...n,targetClassId:c}});b(l),p(2)}catch{alert("Simulation failed.")}finally{g(!1)}},I=(t,s)=>{b(a=>a.map(r=>r.id===t?{...r,targetClassId:s}:r))},_=()=>{const t={pool:x,source:i,target:d,date:new Date().toISOString()};localStorage.setItem("promotion_draft_v1",JSON.stringify(t)),alert("Draft Saved! You can close and resume later.")},T=()=>{confirm("Discard current progress?")&&(localStorage.removeItem("promotion_draft_v1"),p(1),b([]))},R=async()=>{if(!confirm("This will permanently move students to the new classes. Are you sure?"))return;g(!0);const t=x.map(a=>({studentId:a.id,targetClassId:a.targetClassId,currentClassId:a.classId})),s=await M.promoteStudentsBatch(t);g(!1),s.success?(localStorage.removeItem("promotion_draft_v1"),p(3),A()):alert("Promotion Failed: "+s.message)},U=t=>{const s=x.filter(n=>n.targetClassId===t),a=s.length,r=a>0?Math.round(s.reduce((n,c)=>n+c.score,0)/a):0,o=s.filter(n=>n.gender==="Male").length,l=a-o;return{count:a,avgScore:r,boys:o,girls:l}};return C===3?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-6 border-4 border-green-200 dark:border-green-800",children:e.jsx(E,{className:"w-12 h-12 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white mb-2",children:"Promotion Completed!"}),e.jsx("p",{className:"text-slate-500 mb-8",children:"All students have been moved to their new classes."}),e.jsx(w,{onClick:()=>{p(1),b([])},className:"px-8",children:"Back to Start"})]}):C===2?e.jsxs("div",{className:"space-y-6 h-[calc(100vh-180px)] flex flex-col animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600"})," Promotion Workbench"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[x.length," Students Pending Move"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,className:"px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 rounded-lg transition-colors border border-transparent hover:border-red-200",children:"Discard"}),e.jsxs("button",{onClick:_,className:"px-4 py-2 text-xs font-bold text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center gap-1 border border-blue-200 bg-blue-50/50",children:[e.jsx(H,{className:"w-3 h-3"})," Save Draft"]}),e.jsxs("button",{onClick:()=>window.print(),className:"px-4 py-2 text-xs font-bold text-slate-600 hover:bg-slate-100 rounded-lg transition-colors flex items-center gap-1 border border-slate-200",children:[e.jsx(O,{className:"w-3 h-3"})," Print List"]}),e.jsx(w,{onClick:R,disabled:u,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg",children:u?"Finalizing...":"Commit & Promote"})]})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden pb-4",children:e.jsxs("div",{className:"flex gap-4 h-full min-w-max px-1",children:[d.map(t=>{var o;const s=(o=h.find(l=>l.id===t))==null?void 0:o.name,a=U(t),r=x.filter(l=>l.targetClassId===t);return e.jsxs("div",{className:"w-80 flex flex-col bg-slate-100 dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-950 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-black text-lg text-slate-800 dark:text-white",children:s}),e.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs font-bold px-2 py-0.5 rounded-full",children:a.count})]}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-500 uppercase",children:[e.jsxs("span",{title:"Average Merit Score",children:["Avg: ",a.avgScore]}),e.jsxs("span",{title:"Gender Ratio",children:["B: ",a.boys," / G: ",a.girls]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:r.map(l=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-3 group hover:border-blue-400 transition-colors",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${l.gender==="Male"?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"}`,children:l.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-slate-800 dark:text-white truncate",children:l.name}),e.jsxs("p",{className:"text-[10px] text-slate-400 truncate",children:["From: ",l.currentClassName," â€¢ Score: ",l.score]})]}),e.jsxs("select",{className:"w-6 h-6 opacity-0 group-hover:opacity-100 cursor-pointer absolute right-2",value:l.targetClassId,onChange:n=>I(l.id,n.target.value),children:[d.map(n=>{var c;return e.jsx("option",{value:n,children:(c=h.find(v=>v.id===n))==null?void 0:c.name},n)}),e.jsx("option",{value:"RETAIN",children:"Retain"}),e.jsx("option",{value:"ALUMNI",children:"Alumni"})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 pointer-events-none text-slate-400",children:e.jsx(W,{className:"w-4 h-4"})})]},l.id))})]},t)}),e.jsxs("div",{className:"w-72 flex flex-col bg-slate-200 dark:bg-slate-900/50 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700 overflow-hidden opacity-80 hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"p-4 border-b border-slate-300 dark:border-slate-700",children:e.jsx("h4",{className:"font-bold text-sm text-slate-600 dark:text-slate-400 uppercase",children:"Exceptions"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:[x.filter(t=>["RETAIN","ALUMNI"].includes(t.targetClassId)).map(t=>e.jsxs("div",{className:"bg-white/50 dark:bg-slate-800/50 p-2 rounded-lg border border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold",children:t.name}),e.jsx("span",{className:"text-[9px] font-bold bg-slate-300 dark:bg-slate-700 px-1.5 rounded",children:t.targetClassId}),e.jsx("select",{className:"w-4 h-4 opacity-0 absolute right-4",onChange:s=>I(t.id,s.target.value),children:d.map(s=>{var a;return e.jsx("option",{value:s,children:(a=h.find(r=>r.id===s))==null?void 0:a.name},s)})})]},t.id)),x.filter(t=>["RETAIN","ALUMNI"].includes(t.targetClassId)).length===0&&e.jsx("p",{className:"text-center text-[10px] text-slate-400 py-10",children:"Drag (Move) students here via dropdown if they are failing or leaving."})]})]})]})}),e.jsxs("div",{className:"hidden print:block fixed inset-0 bg-white z-[9999] p-8 overflow-y-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Proposed Promotion List"}),d.map(t=>{var r;const s=x.filter(o=>o.targetClassId===t),a=(r=h.find(o=>o.id===t))==null?void 0:r.name;return e.jsxs("div",{className:"mb-8 break-inside-avoid",children:[e.jsxs("h3",{className:"font-bold text-lg border-b-2 border-black mb-2",children:[a," (",s.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-x-8 text-xs",children:s.map((o,l)=>e.jsxs("div",{className:"border-b border-gray-300 py-1 flex justify-between",children:[e.jsxs("span",{children:[l+1,". ",o.name]}),e.jsx("span",{children:o.currentClassName})]},o.id))})]},t)})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-black text-slate-900 dark:text-white mb-2",children:"Academic Promotion Wizard"}),e.jsx("p",{className:"text-slate-500",children:"Intelligent class shuffling and bulk promotion tool."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:[e.jsxs(y,{className:"h-96 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-orange-500"})," From (Current Classes)"]}),e.jsxs("span",{className:"text-xs font-bold bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:[i.length," Selected"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2",children:h.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${i.includes(t.id)?"bg-orange-50 border-orange-500 dark:bg-orange-900/20":"bg-slate-50 border-transparent dark:bg-slate-800"}`,children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-orange-500 rounded",checked:i.includes(t.id),onChange:s=>{s.target.checked?f([...i,t.id]):f(i.filter(a=>a!==t.id))}}),e.jsx("span",{className:"font-bold text-sm dark:text-white flex-1",children:t.name}),e.jsxs("span",{className:"text-xs text-slate-400",children:[t.studentCount," Students"]})]},t.id))})]}),e.jsxs(y,{className:"h-96 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-green-500"})," To (Next Academic Year)"]}),e.jsxs("span",{className:"text-xs font-bold bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:[d.length," Selected"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2",children:h.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${d.includes(t.id)?"bg-green-50 border-green-500 dark:bg-green-900/20":"bg-slate-50 border-transparent dark:bg-slate-800"}`,children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-green-500 rounded",checked:d.includes(t.id),onChange:s=>{s.target.checked?j([...d,t.id]):j(d.filter(a=>a!==t.id))}}),e.jsx("span",{className:"font-bold text-sm dark:text-white flex-1",children:t.name}),e.jsx("span",{className:"text-[10px] bg-slate-200 dark:bg-slate-700 px-1.5 rounded text-slate-600 dark:text-slate-300",children:"Target"})]},t.id))})]})]}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx(y,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-800 border-blue-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-slate-900 rounded-xl shadow-sm",children:e.jsx(G,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:"Smart Distribution"}),e.jsx("p",{className:"text-xs text-slate-500 max-w-xs mt-1",children:"The system will attempt to balance students based on academic performance and gender ratio across the selected target classes."})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:t=>P(t.target.checked),className:"w-5 h-5 accent-purple-600"}),e.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Use Merit Balancing"})]}),e.jsx(w,{onClick:L,disabled:u,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/20",children:u?"Analyzing Data...":e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Simulate & Review"]})})]})]})})})]})};export{X as default};
