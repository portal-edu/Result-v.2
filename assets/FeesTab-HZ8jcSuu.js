import{c as ae,r as i,j as e,b as k,g as le,W as X,d as g,G as J,X as ne,a as j}from"./index-CGGgVCBT.js";import{P as re}from"./plus-BxNUQjGg.js";import{P as de}from"./printer-u7CTVqWj.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ae("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]),he=({feeStructures:o,classes:F,schoolConfig:P,onRefresh:D,onShowReceipt:ie})=>{var _,q,z,B,G;const[c,C]=i.useState(""),[h,N]=i.useState([]),[r,p]=i.useState({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),[S,f]=i.useState(!1),[oe,I]=i.useState(!1),[A,R]=i.useState(""),[K,y]=i.useState(!1),[x,Q]=i.useState(null),[M,T]=i.useState(""),[L,$]=i.useState(!1),U=async t=>{t.preventDefault(),f(!0);const a=parseFloat(r.amount);if(!r.name||isNaN(a))return f(!1),alert("Invalid Input. Please check Name and Amount.");const d=await j.createFeeStructure(r.name,a,r.dueDate,r.targetClassIds,r.collectedBy,r.isRecurring?{frequency:r.recurrenceFrequency,count:r.recurrenceCount}:void 0);f(!1),d.success?(R("Fee Category Created!"),p({name:"",amount:"",dueDate:"",targetClassIds:[],collectedBy:"ADMIN",isRecurring:!1,recurrenceFrequency:"MONTHLY",recurrenceCount:1}),D(),setTimeout(()=>R(""),2e3)):alert("Error: "+d.message)},E=async t=>{C(t),N([]);const a=o.find(n=>n.id===t);if(!a)return;const d=!a.targetClassIds||a.targetClassIds.length===0?F.map(n=>n.id):a.targetClassIds;let s=[];I(!0);for(const n of d){const m=F.find(u=>u.id===n);if(!m)continue;const w=(await j.getFeeCollectionStats(t,n)).map(u=>({...u,className:m.name}));s=[...s,...w]}N(s),I(!1)},V=t=>{var n;Q(t);const a=o.find(m=>m.id===c),d=(a==null?void 0:a.amount)||0,s=((n=t.paymentDetails)==null?void 0:n.amount_paid)||0;T((d-s).toString()),y(!0)},Z=async t=>{if(t.preventDefault(),!c||!x)return;const a=parseFloat(M);if(isNaN(a)||a<=0)return alert("Please enter valid amount");$(!0);const d=o.find(n=>n.id===c),s=await j.recordFeePayment(c,x.student.id,a,(d==null?void 0:d.amount)||0,"Admin");$(!1),y(!1),s.success?E(c):alert("Failed to record payment: "+s.message)},ee=t=>{var W,H,O,Y;const a=o.find(se=>se.id===c),d=(W=window.jspdf)==null?void 0:W.jsPDF;if(!a||!d){alert("PDF Library not loaded");return}const s=new d,n=((H=t.paymentDetails)==null?void 0:H.amount_paid)||0,m=a.amount||0,v=Math.max(0,m-n),w=new Date((O=t.paymentDetails)==null?void 0:O.paid_date).toLocaleDateString(),u=((Y=t.paymentDetails)==null?void 0:Y.transaction_id)||"N/A";s.setFontSize(18),s.text(P.schoolName,105,20,{align:"center"}),s.setFontSize(10),s.text(P.place||"",105,26,{align:"center"}),s.setLineWidth(.5),s.line(20,32,190,32),s.setFontSize(14),s.text("FEE RECEIPT",105,42,{align:"center"}),s.setFontSize(12);let l=60;s.text(`Receipt No: ${u}`,20,l),s.text(`Date: ${w}`,140,l),l+=10,s.text(`Student Name: ${t.student.name}`,20,l),l+=10,s.text(`Class: ${t.className}`,20,l),s.text(`Reg No: ${t.student.regNo}`,140,l),l+=20,s.setFillColor(230,230,230),s.rect(20,l,170,10,"F"),s.setFont("helvetica","bold"),s.text("Description",25,l+7),s.text("Amount (Rs)",160,l+7),l+=10,s.setFont("helvetica","normal"),s.text(a.name,25,l+7),s.text(n.toFixed(2),160,l+7),s.rect(20,l,170,10),l+=20,s.setFont("helvetica","bold"),s.text(`Total Paid: Rs. ${n.toFixed(2)}`,140,l),v>0&&(l+=7,s.text(`Balance Due: Rs. ${v.toFixed(2)}`,140,l)),l+=30,s.setFontSize(10),s.setFont("helvetica","italic"),s.text("This is a computer generated receipt.",105,l,{align:"center"}),s.save(`Receipt_${t.student.name}_${a.name}.pdf`)},te=async t=>{if(!window.confirm("Delete this fee structure? Payments will be unlinked."))return;(await j.deleteFeeStructure(t)).success&&(D(),c===t&&(C(""),N([])))},b=()=>o.find(t=>t.id===c);return e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsx("div",{className:"md:col-span-1 space-y-6",children:e.jsxs(k,{className:"border-t-4 border-t-green-500 relative overflow-hidden",children:[A&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(le,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:A})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(X,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"New Fee"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Define amount & due date"})]})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Fee Name"}),e.jsx(g,{placeholder:"e.g. Bus Fee / Term 1",value:r.name,onChange:t=>p({...r,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount (₹)"}),e.jsx(g,{type:"number",placeholder:"0.00",value:r.amount,onChange:t=>p({...r,amount:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Due Date"}),e.jsx(g,{type:"date",value:r.dueDate,onChange:t=>p({...r,dueDate:t.target.value})})]}),e.jsx(J,{type:"submit",disabled:S,className:"w-full flex items-center justify-center gap-2",children:S?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"})," Create Fee"]})})]})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:[o.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>E(t.id),className:`px-4 py-2 rounded-lg border text-sm font-bold whitespace-nowrap transition-all ${c===t.id?"bg-green-100 border-green-500 text-green-800":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[t.name," (₹",t.amount,")"]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),te(t.id)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm",children:e.jsx(ne,{className:"w-3 h-3"})})]},t.id)),o.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No fees created yet."})]}),c?e.jsxs(k,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-white",children:"Collection Status"}),e.jsxs("div",{className:"flex gap-4 text-xs",children:[e.jsxs("span",{className:"text-green-600 font-bold",children:["Paid: ",h.filter(t=>t.status==="PAID").length]}),e.jsxs("span",{className:"text-red-500 font-bold",children:["Pending: ",h.filter(t=>t.status==="PENDING").length]})]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 text-xs uppercase sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Student"}),e.jsx("th",{className:"p-3",children:"Class"}),e.jsx("th",{className:"p-3 text-right",children:"Paid / Total"}),e.jsx("th",{className:"p-3 text-center",children:"Status"}),e.jsx("th",{className:"p-3 text-center",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[h.map(t=>{var s,n;const a=((s=t.paymentDetails)==null?void 0:s.amount_paid)||0,d=((n=b())==null?void 0:n.amount)||0;return e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"p-3 font-bold text-slate-800 dark:text-white",children:t.student.name}),e.jsx("td",{className:"p-3 text-slate-500",children:t.className}),e.jsxs("td",{className:"p-3 text-right font-mono",children:[e.jsxs("span",{className:a>0?"text-green-600 font-bold":"text-slate-400",children:["₹",a]})," ",e.jsxs("span",{className:"text-slate-400",children:[" / ₹",d]})]}),e.jsx("td",{className:"p-3 text-center",children:t.status==="PAID"?e.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded font-bold",children:"PAID"}):t.status==="PARTIAL"?e.jsx("span",{className:"text-[10px] bg-orange-100 text-orange-700 px-2 py-1 rounded font-bold",children:"PARTIAL"}):e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded font-bold",children:"PENDING"})}),e.jsxs("td",{className:"p-3 text-center flex justify-center gap-2",children:[t.status!=="PAID"&&e.jsx("button",{onClick:()=>V(t),className:"text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded font-bold shadow-sm",children:"Pay"}),(t.status==="PAID"||t.status==="PARTIAL")&&e.jsx("button",{onClick:()=>ee(t),className:"text-xs bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 px-2 py-1.5 rounded font-bold flex items-center gap-1",title:"Download PDF",children:e.jsx(de,{className:"w-3 h-3"})})]})]},t.student.id)}),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-400",children:"No students found."})})]})]})})]}):e.jsxs("div",{className:"text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-xl border-2 border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx(X,{className:"w-12 h-12 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Select a fee category above."})]})]}),K&&x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(k,{className:"w-full max-w-sm relative border-t-4 border-t-blue-500 bg-white dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>y(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:"✕"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[x.student.name," - ",(_=b())==null?void 0:_.name]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl mb-6 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Total Fee:"}),e.jsxs("span",{className:"font-bold",children:["₹",(q=b())==null?void 0:q.amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Already Paid:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["₹",((z=x.paymentDetails)==null?void 0:z.amount_paid)||0]})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 my-2"}),e.jsxs("div",{className:"flex justify-between font-black text-slate-800 dark:text-white",children:[e.jsx("span",{children:"Balance Due:"}),e.jsxs("span",{children:["₹",(((B=b())==null?void 0:B.amount)||0)-(((G=x.paymentDetails)==null?void 0:G.amount_paid)||0)]})]})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount Paying Now"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-3 w-4 h-4 text-slate-400"}),e.jsx(g,{type:"number",className:"pl-9 font-bold text-lg",placeholder:"0.00",value:M,onChange:t=>T(t.target.value),autoFocus:!0,required:!0})]})]}),e.jsx(J,{type:"submit",disabled:L,className:"w-full bg-blue-600 hover:bg-blue-700",children:L?"Processing...":"Confirm Payment"})]})]})})]})};export{he as default};
